# Task ID: 4
# Title: Implement Groups System - Discussion and Content Sharing
# Status: done
# Dependencies: 3
# Priority: medium
# Description: Develop the group discussion and content sharing features, allowing members to communicate and share resources within groups.
# Details:
Implement the following features for group discussions and content sharing:
1. Threaded conversation areas specific to each group
2. Ability to create posts with text, images, and file attachments
3. Comment and reply functionality on group posts
4. Content moderation tools for group admins and moderators

API endpoints to implement:
- `createGroupPost(groupId, content, attachments)`
- `updateGroupPost(postId, updates)`
- `deleteGroupPost(postId)`
- `getGroupPosts(groupId, pagination)`
- `createGroupPostComment(postId, content)`
- `moderateContent(contentId, action)` // for hiding/removing inappropriate content

UI components to implement:
- GroupFeed
- PostCreationForm
- PostCard
- CommentSection
- ContentModerationTools

# Test Strategy:
1. Unit tests for all API endpoints
2. Test post creation with various content types (text, images, files)
3. Verify comment threading works correctly
4. Test moderation actions and ensure they respect user roles
5. Validate real-time updates using Convex's live queries
6. Performance testing with large numbers of posts and comments

# Subtasks:
## 1. Implement Post Creation with Attachments [done]
### Dependencies: None
### Description: Create the backend and frontend components for users to create posts with text content and file attachments within groups
### Details:
1. Create Convex schema for posts with fields for content, authorId, groupId, createdAt, and attachments array
2. Implement Convex mutation for creating posts with proper validation and authorization
3. Build file upload functionality using Convex file storage
4. Create a PostForm component using Shadcn UI form elements with rich text editor and file upload
5. Implement optimistic updates for immediate UI feedback
6. Add proper error handling and loading states
7. Create PostCard component to display posts with author info, timestamp, and attachments

## 2. Develop Threaded Conversations System [done]
### Dependencies: 4.1
### Description: Build a threaded conversation system that allows for hierarchical comments and replies on posts
### Details:
1. Extend Convex schema to support comment threading with parentId references
2. Create Convex queries to fetch comments with proper pagination and sorting
3. Implement mutations for adding, editing, and deleting comments with proper authorization
4. Build CommentThread and CommentCard components using Shadcn UI
5. Create a recursive comment rendering system to display nested replies
6. Add collapse/expand functionality for comment threads
7. Implement real-time updates for comments using Convex subscriptions
8. Add reply forms with proper UX for nested conversations

## 3. Create Content Moderation Tools [done]
### Dependencies: 4.1, 4.2
### Description: Implement moderation tools for group administrators to manage content and enforce community guidelines
### Details:
1. Add moderation fields to post and comment schemas (isHidden, moderatedBy, moderationReason, etc.)
2. Create Convex mutations for hiding/showing content, with proper authorization checks
3. Implement reporting system for users to flag inappropriate content
4. Build ModeratorDashboard component for group admins to view and handle reports
5. Create ModerateContentDialog component for reviewing and taking action on content
6. Add notification system for moderators when content is reported
7. Implement content filters for automatic detection of inappropriate content
8. Add audit logs for moderation actions

## 4. Implement Group Activity Feed and Notifications [done]
### Dependencies: 4.1, 4.2, 4.3
### Description: Create a real-time activity feed for groups and notification system for users to stay updated on discussions
### Details:
1. Design and implement Convex schema for activity events and notifications
2. Create hooks to trigger notifications on relevant actions (new posts, comments, mentions)
3. Build ActivityFeed component to display recent group activity
4. Implement NotificationCenter component with read/unread status
5. Create subscription queries for real-time updates to activity and notifications
6. Add filters and sorting options for the activity feed
7. Implement email notification system for important updates
8. Create user preference settings for notification management
9. Add pagination and infinite scrolling for activity feeds

