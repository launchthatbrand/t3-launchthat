# Product Requirements Document: Enhanced Portal Platform

## 1. Introduction

This document outlines the requirements for enhancing the existing Portal application with advanced social, organizational, and e-commerce capabilities. The enhanced platform will build upon the existing NextJS and Convex infrastructure to deliver a comprehensive suite of features including social groups, notifications, downloads management, e-commerce functionality, contact management (CRM), and a calendar/events system. These additions will transform the platform into a complete solution for online communities, businesses, and educational institutions.

## 2. Goals

- Expand the existing Portal application with social and community features through a BuddyPress-like groups system
- Implement a comprehensive notification system to keep users informed of relevant activities
- Create a structured downloads section for managing and distributing digital assets
- Enhance the e-commerce capabilities with a complete shop/cart/checkout flow
- Develop a contacts management system with CRM-like functionality
- Build a calendar and events system for scheduling and managing activities

## 3. Core Features

### 3.1. Groups System

#### 3.1.1. Group Structure

- **Group Creation:** Users can create groups with customizable settings (public, private, or hidden)
- **Group Profiles:** Each group has a dedicated profile page with:
  - Description/About section
  - Member listing
  - Activity feed
  - Group-specific content areas
- **Group Roles:** Hierarchical permissions system with roles like admin, moderator, and member
- **Group Discovery:** Directory of public groups with search and filter functionality

#### 3.1.2. Group Functionality

- **Group Discussions:** Threaded conversation areas specific to each group
- **Group Content Sharing:** Ability to share posts, files, and links within groups
- **Group Events:** Calendar integration for scheduling group-specific events
- **Group Settings:** Configuration options for notifications, privacy, and content visibility
- **Group Invitations:** Mechanisms for inviting users and requesting to join groups

### 3.2. Notification System

#### 3.2.1. Notification Types

- **Activity Notifications:** Alerts for mentions, replies, and interactions
- **Group Notifications:** Updates for group activities, new members, and posts
- **System Notifications:** Information about platform updates, maintenance, etc.
- **E-commerce Notifications:** Order status changes, shipping updates, etc.
- **Event Notifications:** Reminders for upcoming events, changes to scheduled events

#### 3.2.2. Notification Management

- **Delivery Channels:** In-app, email, and optional push notifications
- **Notification Preferences:** User-configurable settings for each notification type
- **Notification Center:** Centralized interface for viewing all notifications
- **Read/Unread States:** Tracking of viewed notifications
- **Notification Grouping:** Intelligent bundling of similar notifications

### 3.3. Downloads Management

#### 3.3.1. Download Structure

- **Resource Categories:** Hierarchical organization of downloadable assets
- **File Types Support:** Documents, images, videos, software, etc.
- **Metadata:** Detailed information including version, size, author, and description
- **Permissions:** Access control based on user roles, purchases, or group membership

#### 3.3.2. Downloads Functionality

- **Search & Filter:** Advanced search capabilities with filtering by type, size, date, etc.
- **Version Control:** Tracking of file versions with update history
- **Download Tracking:** Analytics on download frequency and user engagement
- **Preview Capabilities:** In-browser preview for compatible file types
- **Bulk Downloads:** Ability to download multiple files as a package

### 3.4. Enhanced E-commerce

#### 3.4.1. Shop Structure

- **Product Catalog:** Comprehensive listing of all available products
- **Categories & Tags:** Hierarchical organization of products
- **Product Variations:** Support for attributes like size, color, etc.
- **Digital & Physical Products:** Handling of both downloadable and shippable items

#### 3.4.2. Cart & Checkout Flow

- **Shopping Cart:** Persistent cart across sessions with real-time updates
- **Checkout Process:** Streamlined, multi-step checkout with address and payment collection
- **Payment Processing:** Integration with multiple payment gateways (expanding beyond Authorize.Net)
- **Order Confirmation:** Detailed confirmation with order summary and next steps
- **Guest Checkout:** Option to purchase without creating an account

#### 3.4.3. Order Management

- **Order History:** Complete record of user purchases
- **Order Status Tracking:** Real-time updates on order processing
- **Digital Fulfillment:** Immediate access to purchased digital products
- **Shipping Integration:** Options for physical product delivery tracking

### 3.5. Contacts & CRM System

#### 3.5.1. Contact Management

- **Contact Profiles:** Comprehensive user information with custom fields
- **Contact Groups:** Categorization and tagging of contacts
- **Relationship Tracking:** Connection history and relationship status
- **Activity Timeline:** Chronological history of interactions and engagements

#### 3.5.2. CRM Functionality

- **Interaction Logging:** Record of communications, purchases, and engagements
- **Notes & Tasks:** Ability to add context and follow-up items to contacts
- **Segmentation:** Grouping contacts based on behavior, interests, or demographics
- **Export & Import:** Data migration capabilities for contact information
- **Integration:** Connection with notification and calendar systems

### 3.6. Calendar & Events System

#### 3.6.1. Calendar Structure

- **Multiple Calendar Views:** Month, week, day, and agenda views
- **Calendar Categories:** Color-coded event types for visual organization
- **Private & Public Calendars:** Individual and shared calendar options
- **Group Calendars:** Dedicated calendars for groups

#### 3.6.2. Events Functionality

- **Event Creation:** Comprehensive event creation with title, description, location, time
- **Recurring Events:** Support for repeating events with customizable patterns
- **Event Registration:** RSVP capability with attendance tracking
- **Event Reminders:** Notification integration for upcoming events
- **Virtual Event Support:** Integration with video conferencing platforms

## 4. Technical Requirements

### 4.1. Architecture & Integration

- **Next.js Framework:** Continue building on the existing Next.js application structure
- **Convex Backend:** Leverage Convex for real-time database, functions, and authentication
- **Schema Extensions:** Extend the current schema to support new features
- **API Structure:** Organized API endpoints for each major feature area
- **Component Library:** Continue using Shadcn UI for consistent user interface

### 4.2. Data Model Extensions

#### 4.2.1. Groups Schema

```typescript
// Groups table
groups: defineTable({
  name: v.string(),
  description: v.string(),
  privacy: v.union(v.literal("public"), v.literal("private"), v.literal("hidden")),
  creatorId: v.id("users"),
  createdAt: v.number(),
  updatedAt: v.number(),
  avatar: v.optional(v.string()),
  coverImage: v.optional(v.string()),
  settings: v.optional(v.object({
    allowMemberInvites: v.boolean(),
    allowContentSharing: v.boolean(),
    // other settings
  })),
})
  .index("by_creator", ["creatorId"])
  .searchIndex("search_groups", { searchField: "name" }),

// Group membership table
groupMembers: defineTable({
  groupId: v.id("groups"),
  userId: v.id("users"),
  role: v.union(v.literal("admin"), v.literal("moderator"), v.literal("member")),
  joinedAt: v.number(),
})
  .index("by_group", ["groupId"])
  .index("by_user", ["userId"])
  .index("by_group_user", ["groupId", "userId"]),

// Group content/posts table
groupPosts: defineTable({
  groupId: v.id("groups"),
  authorId: v.id("users"),
  content: v.string(),
  attachments: v.optional(v.array(v.id("downloads"))),
  createdAt: v.number(),
  updatedAt: v.optional(v.number()),
})
  .index("by_group_time", ["groupId", "createdAt"])
  .index("by_author", ["authorId"]),
```

#### 4.2.2. Notifications Schema

```typescript
notifications: defineTable({
  userId: v.id("users"),
  type: v.union(
    v.literal("activity"),
    v.literal("group"),
    v.literal("system"),
    v.literal("ecommerce"),
    v.literal("event")
  ),
  title: v.string(),
  content: v.string(),
  read: v.boolean(),
  createdAt: v.number(),
  sourceId: v.optional(v.string()), // ID of the related entity (e.g., group, event)
  sourceType: v.optional(v.string()), // Type of the related entity
  actionUrl: v.optional(v.string()), // URL to navigate to when clicking notification
})
  .index("by_user_read", ["userId", "read"])
  .index("by_user_time", ["userId", "createdAt"])
  .index("by_user_type", ["userId", "type"]),

notificationPreferences: defineTable({
  userId: v.id("users"),
  preferences: v.object({
    activity: v.object({
      inApp: v.boolean(),
      email: v.boolean(),
      push: v.boolean(),
    }),
    group: v.object({
      inApp: v.boolean(),
      email: v.boolean(),
      push: v.boolean(),
    }),
    // preferences for other notification types
  }),
})
  .index("by_user", ["userId"]),
```

#### 4.2.3. Downloads Schema

```typescript
downloads: defineTable({
  title: v.string(),
  description: v.optional(v.string()),
  fileUrl: v.string(),
  fileType: v.string(),
  fileSize: v.number(),
  category: v.optional(v.string()),
  version: v.optional(v.string()),
  uploaderId: v.id("users"),
  visibility: v.union(v.literal("public"), v.literal("private"), v.literal("group")),
  groupId: v.optional(v.id("groups")),
  requiredPurchaseId: v.optional(v.id("products")),
  uploadedAt: v.number(),
  downloadCount: v.number(),
})
  .index("by_uploader", ["uploaderId"])
  .index("by_visibility", ["visibility"])
  .index("by_group", ["groupId"])
  .index("by_category", ["category"])
  .searchIndex("search_downloads", { searchField: "title" }),
```

#### 4.2.4. Enhanced E-commerce Schema

```typescript
// Extend existing products table with additional fields
products: defineTable({
  // existing fields
  category: v.optional(v.string()),
  tags: v.optional(v.array(v.string())),
  images: v.optional(v.array(v.string())),
  inventoryCount: v.optional(v.number()),
  isDigital: v.boolean(),
  downloadId: v.optional(v.id("downloads")),
  variations: v.optional(v.array(v.object({
    id: v.string(),
    name: v.string(),
    priceAdjustment: v.number(),
    inventoryCount: v.optional(v.number()),
  }))),
}),

// Shopping cart table
carts: defineTable({
  userId: v.id("users"),
  items: v.array(v.object({
    productId: v.id("products"),
    quantity: v.number(),
    variationId: v.optional(v.string()),
    addedAt: v.number(),
  })),
  updatedAt: v.number(),
})
  .index("by_user", ["userId"]),

// Enhanced orders/transactions table
orders: defineTable({
  userId: v.id("users"),
  status: v.union(
    v.literal("pending"),
    v.literal("processing"),
    v.literal("completed"),
    v.literal("shipped"),
    v.literal("cancelled"),
    v.literal("refunded")
  ),
  items: v.array(v.object({
    productId: v.id("products"),
    productName: v.string(),
    quantity: v.number(),
    unitPrice: v.number(),
    variationId: v.optional(v.string()),
    variationName: v.optional(v.string()),
  })),
  subtotal: v.number(),
  tax: v.number(),
  shipping: v.number(),
  total: v.number(),
  paymentMethod: v.string(),
  paymentId: v.optional(v.string()),
  shippingAddress: v.optional(v.object({
    name: v.string(),
    street: v.string(),
    city: v.string(),
    state: v.string(),
    zipCode: v.string(),
    country: v.string(),
  })),
  billingAddress: v.optional(v.object({
    name: v.string(),
    street: v.string(),
    city: v.string(),
    state: v.string(),
    zipCode: v.string(),
    country: v.string(),
  })),
  createdAt: v.number(),
  updatedAt: v.number(),
})
  .index("by_user", ["userId"])
  .index("by_status", ["status"])
  .index("by_user_status", ["userId", "status"]),
```

#### 4.2.5. Contacts/CRM Schema

```typescript
contacts: defineTable({
  userId: v.id("users"), // owner of the contact
  firstName: v.string(),
  lastName: v.string(),
  email: v.string(),
  phone: v.optional(v.string()),
  company: v.optional(v.string()),
  jobTitle: v.optional(v.string()),
  category: v.optional(v.string()),
  tags: v.optional(v.array(v.string())),
  notes: v.optional(v.string()),
  customFields: v.optional(v.map(v.string(), v.string())),
  createdAt: v.number(),
  updatedAt: v.number(),
})
  .index("by_user", ["userId"])
  .index("by_email", ["email"])
  .index("by_category", ["userId", "category"])
  .searchIndex("search_contacts", { 
    searchField: "lastName",
    filterFields: ["userId"] 
  }),

contactInteractions: defineTable({
  contactId: v.id("contacts"),
  userId: v.id("users"), // user who created the interaction
  type: v.union(
    v.literal("note"),
    v.literal("email"),
    v.literal("call"),
    v.literal("meeting"),
    v.literal("purchase")
  ),
  summary: v.string(),
  details: v.optional(v.string()),
  date: v.number(),
  relatedEntityId: v.optional(v.string()), // e.g., orderId
  relatedEntityType: v.optional(v.string()), // e.g., "order"
})
  .index("by_contact", ["contactId"])
  .index("by_contact_date", ["contactId", "date"]),
```

#### 4.2.6. Calendar & Events Schema

```typescript
calendars: defineTable({
  userId: v.id("users"),
  name: v.string(),
  color: v.string(),
  isDefault: v.boolean(),
  isPublic: v.boolean(),
  groupId: v.optional(v.id("groups")),
})
  .index("by_user", ["userId"])
  .index("by_group", ["groupId"]),

events: defineTable({
  calendarId: v.id("calendars"),
  title: v.string(),
  description: v.optional(v.string()),
  location: v.optional(v.string()),
  isVirtual: v.boolean(),
  meetingUrl: v.optional(v.string()),
  startTime: v.number(),
  endTime: v.number(),
  isAllDay: v.boolean(),
  recurrence: v.optional(v.object({
    pattern: v.union(
      v.literal("daily"),
      v.literal("weekly"),
      v.literal("monthly"),
      v.literal("yearly")
    ),
    interval: v.number(),
    endDate: v.optional(v.number()),
    endOccurrences: v.optional(v.number()),
  })),
  reminderMinutes: v.optional(v.array(v.number())),
  creatorId: v.id("users"),
  visibility: v.union(
    v.literal("public"),
    v.literal("private"),
    v.literal("group")
  ),
  createdAt: v.number(),
  updatedAt: v.number(),
})
  .index("by_calendar", ["calendarId"])
  .index("by_date_range", ["startTime"])
  .index("by_creator", ["creatorId"]),

eventAttendees: defineTable({
  eventId: v.id("events"),
  userId: v.id("users"),
  status: v.union(
    v.literal("invited"),
    v.literal("accepted"),
    v.literal("declined"),
    v.literal("tentative")
  ),
  notified: v.boolean(),
})
  .index("by_event", ["eventId"])
  .index("by_user", ["userId"])
  .index("by_event_user", ["eventId", "userId"]),
```

## 5. User Interface Requirements

### 5.1. Groups Interface

- **Groups Directory:** Searchable listing of available groups
- **Group Creation Flow:** Multi-step form for creating new groups
- **Group Home Page:** Central hub for each group with activity feed
- **Group Navigation:** Consistent sub-navigation within group context
- **Member Management Interface:** Tools for admins to manage group membership

### 5.2. Notifications Interface

- **Notifications Icon:** Persistent indicator showing unread notification count
- **Notifications Dropdown:** Quick access to recent notifications
- **Notifications Page:** Complete listing of all notifications with filtering
- **Settings Interface:** Comprehensive controls for notification preferences

### 5.3. Downloads Interface

- **Downloads Library:** Organized presentation of available downloads
- **Upload Interface:** Streamlined process for adding new downloads
- **Download Details Page:** Comprehensive information about each resource
- **Download Management:** Admin tools for organizing and tracking downloads

### 5.4. E-commerce Interface

- **Product Catalog:** Grid and list views with filtering options
- **Product Detail Pages:** Comprehensive presentation of product information
- **Shopping Cart:** Slide-in panel and dedicated page
- **Checkout Flow:** Multi-step, responsive checkout process
- **Order Management:** Interface for viewing and managing orders

### 5.5. Contacts/CRM Interface

- **Contact Directory:** Searchable, filterable listing of contacts
- **Contact Profile:** Detailed view of contact information and history
- **Interaction Logging:** Forms for recording contact interactions
- **Contact Import/Export:** Tools for bulk data management

### 5.6. Calendar & Events Interface

- **Calendar Views:** Month, week, day, and agenda layouts
- **Event Creation:** Modal interface for creating and editing events
- **Event Detail Page:** Comprehensive information about each event
- **RSVP Interface:** Tools for responding to event invitations

## 6. Integration Requirements

### 6.1. Cross-Feature Integration

- **Unified Navigation:** Consistent access to all features through main navigation
- **Contextual Relationships:** Links between related items across features
- **Shared Components:** Reusable UI elements across features
- **Consistent Styling:** Adherence to design system throughout all new features

### 6.2. External Integrations

- **Email Service:** Integration for notification delivery
- **Payment Processors:** Multiple options beyond Authorize.Net
- **File Storage:** Scalable solution for download management
- **Video Conferencing:** Integration for virtual events

## 7. Performance & Scalability

- **Real-time Updates:** Leverage Convex for instant data synchronization
- **Lazy Loading:** Implement for large data sets and media content
- **Pagination:** Apply to all listings of potentially large collections
- **Caching Strategy:** Implement for frequently accessed data
- **Database Indexes:** Create for all common query patterns

## 8. Security Considerations

- **Role-based Access Control:** Comprehensive permissions system
- **Content Visibility Rules:** Enforced at database and API levels
- **Secure File Storage:** Protected access to downloaded content
- **Payment Security:** PCI-compliant handling of payment information
- **Privacy Controls:** User-configurable sharing and visibility settings

## 9. Accessibility

- **WCAG 2.1 AA Compliance:** Ensure all new features meet accessibility standards
- **Keyboard Navigation:** Full functionality without mouse interaction
- **Screen Reader Support:** Semantic markup and ARIA attributes
- **Color Contrast:** Sufficient contrast ratios throughout the interface
- **Responsive Design:** Functionality across all device sizes

## 10. Future Considerations

- **Advanced Analytics:** Comprehensive tracking of user engagement
- **Machine Learning:** Personalized recommendations and content
- **Mobile Applications:** Native apps for iOS and Android
- **Marketplace Functionality:** User-to-user selling capabilities
- **Integration API:** Public API for third-party integrations

## 11. Implementation Phases

### Phase 1: Foundation
- Extend database schema for all new features
- Implement Groups and Notifications systems
- Build core UI components for new features

### Phase 2: Content & Commerce
- Implement Downloads management system
- Enhance E-commerce functionality
- Build contacts/CRM basic functionality

### Phase 3: Scheduling & Refinement
- Implement Calendar and Events system
- Complete Contacts/CRM advanced features
- Refine cross-feature integration
- Comprehensive testing and optimization 