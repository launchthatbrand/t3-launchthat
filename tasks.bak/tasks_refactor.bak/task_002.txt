# Task ID: 2
# Title: Design New Directory Structure
# Status: done
# Dependencies: 1
# Priority: high
# Description: Create a detailed plan for the new feature-based directory structure
# Details:
1. Based on the analysis, create a comprehensive directory structure plan.
2. Include all feature-specific directories (e.g., ecommerce/, lms/, users/, permissions/, groups/, downloads/, calendar/, notifications/, cms/).
3. Define the structure for shared utilities (e.g., shared/ or utils/ directory).
4. Specify naming conventions for schema files, query files, mutation files, and action files.
5. Create a visual representation of the new structure (e.g., using a tool like draw.io).

# Test Strategy:
Review the proposed structure with the development team and stakeholders. Iterate based on feedback.

# Subtasks:
## 2.1. Completed Directory Structure Design [done]
### Dependencies: None
### Description: Detailed directory structure plan with naming conventions
### Details:
**I. Detailed Directory Structure Plan:**

```
apps/portal/convex/
├── admin/                  # Backend logic for admin panel features
│   ├── dashboardOps.ts     # Queries/mutations for dashboard data
│   ├── settingsAdmin.ts    # Functions for managing system-wide settings
│   └── schema.ts           # Schema for any admin-specific tables (if any)
├── auth/                   # Authentication related hooks, configs used by Convex
│   └── auth.config.ts      # (Existing file, likely stays here or is confirmed as central auth point)
├── calendar/
│   ├── calendar.ts         # Core calendar logic (queries, mutations)
│   ├── events.ts           # Event-specific logic
│   └── schema.ts           # Combined schema for calendar and events tables
├── cms/                    # Content Management System (ConvexCMS specific)
│   ├── pages.ts
│   ├── posts.ts            # e.g., Blog posts, articles if distinct from group posts
│   ├── media.ts            # If CMS has dedicated media handling
│   └── schema.ts
├── contacts/
│   ├── contacts.ts
│   └── schema.ts
├── core/                   # Core, cross-cutting concerns, formerly `permissions`, `users`
│   ├── permissions.ts      # Permission checking logic (hasPermission, requirePermission)
│   ├── roles.ts            # Role management logic
│   ├── users.ts            # User management logic (CRUD, profile updates)
│   ├── schema/
│   │   ├── permissionsSchema.ts
│   │   ├── rolesSchema.ts
│   │   ├── usersSchema.ts
│   │   └── index.ts        # Exports combined core schemas
│   └── lib/                # Helpers specific to core functionalities (e.g., permissionUtils)
├── downloads/
│   ├── downloads.ts        # Logic for managing digital downloads
│   ├── downloadsLibrary.ts # Potentially for user's library of downloads
│   └── schema.ts
├── ecommerce/
│   ├── cart.ts
│   ├── checkout.ts
│   ├── orders.ts
│   ├── payments.ts         # Payment processing related actions/mutations
│   ├── products.ts
│   ├── productCategories.ts
│   ├── productVariations.ts
│   ├── schema/
│   │   ├── cartSchema.ts
│   │   ├── checkoutSchema.ts
│   │   ├── ordersSchema.ts
│   │   ├── paymentsSchema.ts
│   │   ├── productsSchema.ts # Unified product schema
│   │   ├── categoriesSchema.ts
│   │   └── index.ts        # Exports combined ecommerce schemas
│   └── lib/                # Ecommerce specific helpers
├── groups/
│   ├── groups.ts           # Group management logic
│   ├── groupMemberships.ts
│   ├── groupPosts.ts       # Posts within groups
│   └── schema.ts
├── lms/                    # Learning Management System
│   ├── courses.ts
│   ├── lessons.ts
│   ├── enrollments.ts
│   ├── progress.ts
│   ├── topics.ts
│   └── schema.ts
├── notifications/
│   ├── notifications.ts
│   └── schema.ts
├── shared/                 # Global utilities, shared components, constants
│   ├── constants.ts        # e.g., Global status literals, entity types
│   ├── pagination.ts       # Reusable pagination helpers for queries
│   ├── schemaUtils.ts      # Common schema snippets (e.g. addressObject from current schema.ts)
│   ├── validationUtils.ts  # Common complex validation helpers
│   └── index.ts            # Entry point for shared utilities
├── actions/                # Top-level/global actions (if any not fitting into features)
│   └── generalActions.ts
├── _generated/             # (Auto-generated by Convex)
├── schema.ts               # Main schema aggregator (imports from feature/core schemas)
├── http.ts                 # Root HTTP actions (e.g., webhooks not tied to a feature)
├── crons.ts                # Cron job definitions
├── env.ts                  # (Existing file)
├── convex.json             # (Existing file)
└── tsconfig.json           # (Existing file)
```

**II. Naming Conventions:**

*   **Directories**: Lowercase, kebab-case if multiple words (prefer single). Example: `ecommerce`, `product-categories`.
*   **Files**:
    *   Logic: `camelCase.ts` (e.g., `products.ts`).
    *   Schema: `featureNameSchema.ts` or `schema.ts` (in feature dir). Example: `productsSchema.ts`.
    *   Utils: `camelCaseUtils.ts` or `camelCase.ts`. Example: `permissionUtils.ts`.
*   **Convex Functions**: `verbNoun` or `verbResource`. Example: `getProduct`, `createCourse`.
*   **Variables & Constants**: `camelCase` for vars, `UPPER_SNAKE_CASE` for consts.
*   **Types/Interfaces**: `PascalCase`. Example: `Product`, `OrderDetails`.

## 2.2. Prepare for Structure Review [done]
### Dependencies: None
### Description: Prepare the directory structure design for team and stakeholder review
### Details:
1. Schedule a review meeting with the development team and key stakeholders.
2. Prepare a presentation of the directory structure highlighting key design decisions.
3. Document potential questions and considerations for discussion.
4. Be prepared to explain how this structure addresses current pain points and supports future scalability.

