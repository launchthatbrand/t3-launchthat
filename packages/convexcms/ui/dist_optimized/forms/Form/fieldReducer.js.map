{"version":3,"file":"fieldReducer.js","names":["deepCopyObjectSimpleWithoutReactComponents","ObjectIdImport","dequal","flattenRows","separateRows","ObjectId","default","fieldReducer","state","action","type","blockType","path","rowIndex","rowIndexFromArgs","subFieldState","rows","length","withNewRow","newRow","id","value","toHexString","undefined","collapsed","isLoading","splice","initialValue","valid","remainingFields","siblingRows","newState","passesCondition","disableFormData","errorPaths","errors","forEach","message","fieldPath","errorMessage","segments","split","push","fieldErrorPath","parentPath","slice","join","Object","entries","reduce","acc","fieldState","fieldErrorPaths","errorACC","startsWith","changed","newErrorPaths","Array","isArray","includes","rowsMetadata","duplicateRowMetadata","duplicateRowState","key","keys","filter","endsWith","idState","isValid","moveFromIndex","moveToIndex","topLevelRows","copyOfMovingRow","rowsWithinField","copyOfMovingRow2","rowIndexArg","Math","max","min","optimize","newField","oldField","sanitize","field","values","updatedRows","formState"],"sources":["../../../src/forms/Form/fieldReducer.ts"],"sourcesContent":["\"use client\";\n\nimport type { FormField, FormState, Row } from \"@convexcms/core\";\nimport {\n  deepCopyObjectSimple,\n  deepCopyObjectSimpleWithoutReactComponents,\n} from \"@convexcms/core/shared\";\nimport ObjectIdImport from \"bson-objectid\";\nimport { dequal } from \"dequal/lite\"; // lite: no need for Map and Set support\n\nimport type { FieldAction } from \"./types.js\";\nimport { flattenRows, separateRows } from \"./rows.js\";\n\nconst ObjectId = (ObjectIdImport.default ||\n  ObjectIdImport) as unknown as typeof ObjectIdImport.default;\n\n/**\n * Reducer which modifies the form field state (all the current data of the fields in the form). When called using dispatch, it will return a new state object.\n */\nexport function fieldReducer(state: FormState, action: FieldAction): FormState {\n  switch (action.type) {\n    case \"ADD_ROW\": {\n      const {\n        blockType,\n        path,\n        rowIndex: rowIndexFromArgs,\n        subFieldState = {},\n      } = action;\n\n      const rowIndex =\n        typeof rowIndexFromArgs === \"number\"\n          ? rowIndexFromArgs\n          : state[path]?.rows?.length || 0;\n\n      const withNewRow = [...(state[path]?.rows || [])];\n\n      const newRow: Row = {\n        id:\n          (subFieldState?.id?.value as string) || new ObjectId().toHexString(),\n        blockType: blockType || undefined,\n        collapsed: false,\n        isLoading: true,\n      };\n\n      withNewRow.splice(rowIndex, 0, newRow);\n\n      if (blockType) {\n        subFieldState.blockType = {\n          initialValue: blockType,\n          valid: true,\n          value: blockType,\n        };\n      }\n\n      // add new row to array _field state_\n      const { remainingFields, rows: siblingRows } = separateRows(path, state);\n\n      siblingRows.splice(rowIndex, 0, subFieldState);\n\n      const newState: FormState = {\n        ...remainingFields,\n        ...flattenRows(path, siblingRows),\n        [`${path}.${rowIndex}.id`]: {\n          initialValue: newRow.id,\n          passesCondition: true,\n          valid: true,\n          value: newRow.id,\n        },\n        [path]: {\n          ...state[path],\n          disableFormData: true,\n          rows: withNewRow,\n          value: siblingRows.length,\n        },\n      };\n\n      return newState;\n    }\n\n    case \"ADD_SERVER_ERRORS\": {\n      let newState = { ...state };\n\n      const errorPaths: { fieldErrorPath: string; parentPath: string }[] = [];\n\n      action.errors.forEach(({ message, path: fieldPath }) => {\n        newState[fieldPath] = {\n          ...(newState[fieldPath] || {\n            initialValue: null,\n            value: null,\n          }),\n          errorMessage: message,\n          valid: false,\n        };\n\n        const segments = fieldPath.split(\".\");\n        if (segments.length > 1) {\n          errorPaths.push({\n            fieldErrorPath: fieldPath,\n            parentPath: segments.slice(0, segments.length - 1).join(\".\"),\n          });\n        }\n      });\n\n      newState = Object.entries(newState).reduce((acc, [path, fieldState]) => {\n        const fieldErrorPaths = errorPaths.reduce(\n          (errorACC, { fieldErrorPath, parentPath }) => {\n            if (parentPath.startsWith(path)) {\n              errorACC.push(fieldErrorPath);\n            }\n            return errorACC;\n          },\n          [],\n        );\n\n        let changed = false;\n\n        if (fieldErrorPaths.length > 0) {\n          const newErrorPaths = Array.isArray(fieldState.errorPaths)\n            ? fieldState.errorPaths\n            : [];\n\n          fieldErrorPaths.forEach((fieldErrorPath) => {\n            if (!newErrorPaths.includes(fieldErrorPath)) {\n              newErrorPaths.push(fieldErrorPath);\n              changed = true;\n            }\n          });\n\n          if (changed) {\n            acc[path] = {\n              ...fieldState,\n              errorPaths: newErrorPaths,\n            };\n          }\n        }\n\n        if (!changed) {\n          acc[path] = fieldState;\n        }\n\n        return acc;\n      }, {});\n\n      return newState;\n    }\n\n    case \"DUPLICATE_ROW\": {\n      const { path, rowIndex } = action;\n      const { remainingFields, rows } = separateRows(path, state);\n      const rowsMetadata = [...(state[path].rows || [])];\n\n      const duplicateRowMetadata = deepCopyObjectSimpleWithoutReactComponents(\n        rowsMetadata[rowIndex],\n      );\n\n      if (duplicateRowMetadata.id) {\n        duplicateRowMetadata.id = new ObjectId().toHexString();\n      }\n\n      const duplicateRowState = deepCopyObjectSimpleWithoutReactComponents(\n        rows[rowIndex],\n      );\n\n      if (duplicateRowState.id) {\n        duplicateRowState.id.value = new ObjectId().toHexString();\n        duplicateRowState.id.initialValue = new ObjectId().toHexString();\n      }\n\n      for (const key of Object.keys(duplicateRowState).filter((key) =>\n        key.endsWith(\".id\"),\n      )) {\n        const idState = duplicateRowState[key];\n\n        if (\n          idState &&\n          typeof idState.value === \"string\" &&\n          ObjectId.isValid(idState.value)\n        ) {\n          duplicateRowState[key].value = new ObjectId().toHexString();\n          duplicateRowState[key].initialValue = new ObjectId().toHexString();\n        }\n      }\n\n      // If there are subfields\n      if (Object.keys(duplicateRowState).length > 0) {\n        // Add new object containing subfield names to unflattenedRows array\n        rows.splice(rowIndex + 1, 0, duplicateRowState);\n        rowsMetadata.splice(rowIndex + 1, 0, duplicateRowMetadata);\n      }\n\n      const newState = {\n        ...remainingFields,\n        ...flattenRows(path, rows),\n        [path]: {\n          ...state[path],\n          disableFormData: true,\n          rows: rowsMetadata,\n          value: rows.length,\n        },\n      };\n\n      return newState;\n    }\n\n    case \"MOVE_ROW\": {\n      const { moveFromIndex, moveToIndex, path } = action;\n\n      // Handle moving rows on the top-level, i.e. `array.0.text` -> `array.1.text`\n      const { remainingFields, rows: topLevelRows } = separateRows(path, state);\n      const copyOfMovingRow = topLevelRows[moveFromIndex];\n      topLevelRows.splice(moveFromIndex, 1);\n      topLevelRows.splice(moveToIndex, 0, copyOfMovingRow);\n\n      // modify array/block internal row state (i.e. collapsed, blockType)\n      const rowsWithinField = [...(state[path]?.rows || [])];\n      const copyOfMovingRow2 = { ...rowsWithinField[moveFromIndex] };\n      rowsWithinField.splice(moveFromIndex, 1);\n      rowsWithinField.splice(moveToIndex, 0, copyOfMovingRow2);\n\n      const newState = {\n        ...remainingFields,\n        ...flattenRows(path, topLevelRows),\n        [path]: {\n          ...state[path],\n          rows: rowsWithinField,\n        },\n      };\n\n      return newState;\n    }\n\n    case \"REMOVE\": {\n      const newState = { ...state };\n      if (newState[action.path]) {\n        delete newState[action.path];\n      }\n      return newState;\n    }\n\n    case \"REMOVE_ROW\": {\n      const { path, rowIndex } = action;\n      const { remainingFields, rows } = separateRows(path, state);\n      const rowsMetadata = [...(state[path]?.rows || [])];\n\n      rows.splice(rowIndex, 1);\n      rowsMetadata.splice(rowIndex, 1);\n\n      const newState: FormState = {\n        ...remainingFields,\n        [path]: {\n          ...state[path],\n          disableFormData: rows.length > 0,\n          rows: rowsMetadata,\n          value: rows.length,\n        },\n        ...flattenRows(path, rows),\n      };\n\n      return newState;\n    }\n\n    case \"REPLACE_ROW\": {\n      const {\n        blockType,\n        path,\n        rowIndex: rowIndexArg,\n        subFieldState = {},\n      } = action;\n\n      const { remainingFields, rows: siblingRows } = separateRows(path, state);\n      const rowIndex = Math.max(\n        0,\n        Math.min(rowIndexArg, siblingRows?.length - 1 || 0),\n      );\n\n      const rowsMetadata = [...(state[path]?.rows || [])];\n      rowsMetadata[rowIndex] = {\n        id: new ObjectId().toHexString(),\n        blockType: blockType || undefined,\n        collapsed: false,\n      };\n\n      if (blockType) {\n        subFieldState.blockType = {\n          initialValue: blockType,\n          valid: true,\n          value: blockType,\n        };\n      }\n\n      // replace form _field state_\n      siblingRows[rowIndex] = subFieldState;\n\n      const newState: FormState = {\n        ...remainingFields,\n        ...flattenRows(path, siblingRows),\n        [path]: {\n          ...state[path],\n          disableFormData: true,\n          rows: rowsMetadata,\n          value: siblingRows.length,\n        },\n      };\n\n      return newState;\n    }\n\n    case \"REPLACE_STATE\": {\n      if (action.optimize !== false) {\n        // Only update fields that have changed\n        // by comparing old value / initialValue to new\n        // ..\n        // This is a performance enhancement for saving\n        // large documents with hundreds of fields\n        const newState: FormState = {};\n\n        for (const [path, newField] of Object.entries(action.state)) {\n          const oldField = state[path];\n\n          if (newField.valid !== false) {\n            newField.valid = true;\n          }\n          if (newField.passesCondition !== false) {\n            newField.passesCondition = true;\n          }\n\n          if (!dequal(oldField, newField)) {\n            newState[path] = newField;\n          } else if (oldField) {\n            newState[path] = oldField;\n          }\n        }\n\n        return newState;\n      }\n\n      // TODO: Remove this in 4.0 - this is a temporary fix to prevent a breaking change\n      if (action.sanitize) {\n        for (const field of Object.values(action.state)) {\n          if (field.valid !== false) {\n            field.valid = true;\n          }\n          if (field.passesCondition !== false) {\n            field.passesCondition = true;\n          }\n        }\n      }\n      // If we're not optimizing, just set the state to the new state\n      return action.state;\n    }\n\n    case \"SET_ALL_ROWS_COLLAPSED\": {\n      const { path, updatedRows } = action;\n\n      return {\n        ...state,\n        [path]: {\n          ...state[path],\n          rows: updatedRows,\n        },\n      };\n    }\n\n    case \"SET_ROW_COLLAPSED\": {\n      const { path, updatedRows } = action;\n\n      const newState = {\n        ...state,\n        [path]: {\n          ...state[path],\n          rows: updatedRows,\n        },\n      };\n\n      return newState;\n    }\n\n    case \"UPDATE\": {\n      const newField = Object.entries(action).reduce(\n        (field, [key, value]) => {\n          if (\n            [\n              \"disableFormData\",\n              \"errorMessage\",\n              \"initialValue\",\n              \"rows\",\n              \"valid\",\n              \"validate\",\n              \"value\",\n            ].includes(key)\n          ) {\n            return {\n              ...field,\n              [key]: value,\n            };\n          }\n\n          return field;\n        },\n        state?.[action.path] || ({} as FormField),\n      );\n\n      const newState = {\n        ...state,\n        [action.path]: newField,\n      };\n\n      return newState;\n    }\n\n    case \"UPDATE_MANY\": {\n      const newState = { ...state };\n\n      Object.entries(action.formState).forEach(([path, field]) => {\n        newState[path] = field;\n      });\n\n      return newState;\n    }\n\n    default: {\n      return state;\n    }\n  }\n}\n"],"mappings":"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","ignoreList":[]}