{"version":3,"file":"index.js","names":["React","useCallback","useEffect","useReducer","useRef","useState","useRouter","deepCopyObjectSimpleWithoutReactComponents","getDataByPath","getDataByPathFunc","getSiblingData","getSiblingDataFunc","reduceFieldsToValues","wait","dequal","serialize","toast","FieldErrorsToast","useDebouncedEffect","useEffectEvent","useQueues","useThrottledEffect","useAuth","useConfig","useDocumentInfo","useLocale","useOperation","useRouteTransition","useServerFunctions","useTranslation","useUploadHandlers","abortAndIgnore","handleAbortRef","requests","BackgroundProcessingContext","DocumentFormContext","FormContext","FormFieldsContext","FormWatchContext","InitializingContext","ModifiedContext","ProcessingContext","SubmittedContext","useDocumentForm","errorMessages","fieldReducer","initContextState","mergeServerFormState","baseClass","Form","props","id","collectionSlug","docPermissions","getDocPreferences","globalSlug","action","beforeSubmit","children","className","disabled","disabledFromProps","disableSuccessStatus","disableValidationOnSubmit","el","handleResponse","initialState","isDocumentForm","isInitializing","initializingFromProps","onChange","onSubmit","onSuccess","redirect","submitted","submittedFromProps","uuid","waitForAutocomplete","method","undefined","router","documentForm","code","locale","i18n","t","refreshCookie","user","operation","queueTask","getFormState","startRouteTransition","getUploadHandler","config","setDisabled","isMounted","setIsMounted","modified","setModified","isValid","setIsValid","initializing","setInitializing","processing","setProcessing","backgroundProcessing","setBackgroundProcessing","setSubmitted","formRef","contextRef","abortResetFormRef","isFirstRenderRef","fieldsReducer","formState","dispatchFields","current","fields","prevFormState","validateForm","validatedFieldState","data","getData","validationPromises","Object","entries","map","path","field","validatedField","pathSegments","split","passesCondition","validationResult","valid","validate","valueToValidate","value","rows","Array","isArray","blockData","event","preferences","req","payload","siblingData","errorMessage","Promise","all","type","state","submit","options","e","actionArg","methodToUse","overrides","overridesFromArgs","skipValidation","preventDefault","errorToast","successToast","promise","resolve","reject","hasFormSubmitAction","success","error","loading","stopPropagation","revalidatedFormState","serializableFields","reduce","priorOnChange","beforeSubmitFn","result","every","key","formData","createFormData","mergeOverrideData","Boolean","res","toLowerCase","body","headers","language","contentType","get","isJSON","indexOf","json","status","newFormState","newState","mergedFormState","acceptValues","existingState","incomingState","optimize","push","message","errors","fieldErrors","nonFieldErrors","fieldErrs","nonFieldErrs","err","newFieldErrs","newNonFieldErrs","forEach","dataError","_jsx","statusText","console","getFields","getField","file","handler","filename","name","clientUploadContext","updateFilename","JSON","stringify","mimeType","size","dataToSerialize","_payload","indices","nullsAsUndefineds","reset","controller","docPreferences","renderAllFields","schemaPath","signal","replaceState","addFieldRow","blockType","rowIndex","rowIndexArg","subFieldState","newRows","length","moveFieldRow","moveFromIndex","moveToIndex","removeFieldRow","replaceFieldRow","currentRows","abortOnChange","sanitize","classes","filter","join","executeOnChange","onChangeFn","changed","DocumentFormContextComponent","Fragment","documentFormContextProps","El","noValidate","ref","Provider","useAllFormFields","useForm","useFormFields","useFormModified","useFormProcessing","useFormSubmitted","useWatchForm"],"sources":["../../../src/forms/Form/index.tsx"],"sourcesContent":["\"use client\";\n\nimport React, {\n  useCallback,\n  useEffect,\n  useReducer,\n  useRef,\n  useState,\n} from \"react\";\nimport { useRouter } from \"next/navigation.js\";\nimport { type FormState, type PayloadRequest } from \"@convexcms/core\";\nimport {\n  deepCopyObjectSimpleWithoutReactComponents,\n  getDataByPath as getDataByPathFunc,\n  getSiblingData as getSiblingDataFunc,\n  reduceFieldsToValues,\n  wait,\n} from \"@convexcms/core/shared\";\nimport { dequal } from \"dequal/lite\"; // lite: no need for Map and Set support\n\nimport { serialize } from \"object-to-formdata\";\nimport { toast } from \"sonner\";\n\nimport type {\n  CreateFormData,\n  Context as FormContextType,\n  FormProps,\n  GetDataByPath,\n  SubmitOptions,\n} from \"./types.js\";\nimport { FieldErrorsToast } from \"../../elements/Toasts/fieldErrors.js\";\nimport { useDebouncedEffect } from \"../../hooks/useDebouncedEffect.js\";\nimport { useEffectEvent } from \"../../hooks/useEffectEvent.js\";\nimport { useQueues } from \"../../hooks/useQueues.js\";\nimport { useThrottledEffect } from \"../../hooks/useThrottledEffect.js\";\nimport { useAuth } from \"../../providers/Auth/index.js\";\nimport { useConfig } from \"../../providers/Config/index.js\";\nimport { useDocumentInfo } from \"../../providers/DocumentInfo/index.js\";\nimport { useLocale } from \"../../providers/Locale/index.js\";\nimport { useOperation } from \"../../providers/Operation/index.js\";\nimport { useRouteTransition } from \"../../providers/RouteTransition/index.js\";\nimport { useServerFunctions } from \"../../providers/ServerFunctions/index.js\";\nimport { useTranslation } from \"../../providers/Translation/index.js\";\nimport { useUploadHandlers } from \"../../providers/UploadHandlers/index.js\";\nimport {\n  abortAndIgnore,\n  handleAbortRef,\n} from \"../../utilities/abortAndIgnore.js\";\nimport { requests } from \"../../utilities/api.js\";\nimport {\n  BackgroundProcessingContext,\n  DocumentFormContext,\n  FormContext,\n  FormFieldsContext,\n  FormWatchContext,\n  InitializingContext,\n  ModifiedContext,\n  ProcessingContext,\n  SubmittedContext,\n  useDocumentForm,\n} from \"./context.js\";\nimport { errorMessages } from \"./errorMessages.js\";\nimport { fieldReducer } from \"./fieldReducer.js\";\nimport { initContextState } from \"./initContextState.js\";\nimport { mergeServerFormState } from \"./mergeServerFormState.js\";\n\nconst baseClass = \"form\";\n\nexport const Form: React.FC<FormProps> = (props) => {\n  const { id, collectionSlug, docPermissions, getDocPreferences, globalSlug } =\n    useDocumentInfo();\n\n  const {\n    action,\n    beforeSubmit,\n    children,\n    className,\n    disabled: disabledFromProps,\n    disableSuccessStatus,\n    disableValidationOnSubmit,\n    // fields: fieldsFromProps = collection?.fields || global?.fields,\n    el,\n    handleResponse,\n    initialState, // fully formed initial field state\n    isDocumentForm,\n    isInitializing: initializingFromProps,\n    onChange,\n    onSubmit,\n    onSuccess,\n    redirect,\n    submitted: submittedFromProps,\n    uuid,\n    waitForAutocomplete,\n  } = props;\n\n  const method = \"method\" in props ? props?.method : undefined;\n\n  const router = useRouter();\n\n  const documentForm = useDocumentForm();\n\n  const { code: locale } = useLocale();\n  const { i18n, t } = useTranslation();\n  const { refreshCookie, user } = useAuth();\n  const operation = useOperation();\n  const { queueTask } = useQueues();\n\n  const { getFormState } = useServerFunctions();\n  const { startRouteTransition } = useRouteTransition();\n  const { getUploadHandler } = useUploadHandlers();\n\n  const { config } = useConfig();\n\n  const [disabled, setDisabled] = useState(disabledFromProps || false);\n  const [isMounted, setIsMounted] = useState(false);\n  const [modified, setModified] = useState(false);\n\n  /**\n   * Tracks wether the form state passes validation.\n   * For example the state could be submitted but invalid as field errors have been returned.\n   */\n  const [isValid, setIsValid] = useState(true);\n  const [initializing, setInitializing] = useState(initializingFromProps);\n  const [processing, setProcessing] = useState(false);\n  const [backgroundProcessing, setBackgroundProcessing] = useState(false);\n\n  const [submitted, setSubmitted] = useState(false);\n  const formRef = useRef<HTMLFormElement>(null);\n  const contextRef = useRef({} as FormContextType);\n  const abortResetFormRef = useRef<AbortController>(null);\n  const isFirstRenderRef = useRef(true);\n\n  const fieldsReducer = useReducer(fieldReducer, {}, () => initialState);\n\n  const [formState, dispatchFields] = fieldsReducer;\n\n  contextRef.current.fields = formState;\n\n  const prevFormState = useRef(formState);\n\n  const validateForm = useCallback(async () => {\n    const validatedFieldState = {};\n    let isValid = true;\n\n    const data = contextRef.current.getData();\n\n    const validationPromises = Object.entries(contextRef.current.fields).map(\n      async ([path, field]) => {\n        const validatedField = field;\n        const pathSegments = path ? path.split(\".\") : [];\n\n        if (field.passesCondition !== false) {\n          let validationResult: boolean | string = validatedField.valid;\n\n          if (\"validate\" in field && typeof field.validate === \"function\") {\n            let valueToValidate = field.value;\n\n            if (field?.rows && Array.isArray(field.rows)) {\n              valueToValidate = contextRef.current.getDataByPath(path);\n            }\n\n            validationResult = await field.validate(valueToValidate, {\n              ...field,\n              id,\n              collectionSlug,\n              // If there is a parent document form, we can get the data from that form\n              blockData: undefined, // Will be expensive to get - not worth to pass to client-side validation, as this can be obtained by the user using `useFormFields()`\n              data: documentForm?.getData ? documentForm.getData() : data,\n              event: \"submit\",\n              operation,\n              path: pathSegments,\n              preferences: {} as any,\n              req: {\n                payload: {\n                  config,\n                },\n                t,\n                user,\n              } as unknown as PayloadRequest,\n              siblingData: contextRef.current.getSiblingData(path),\n            });\n\n            if (typeof validationResult === \"string\") {\n              validatedField.errorMessage = validationResult;\n              validatedField.valid = false;\n            } else {\n              validatedField.valid = true;\n              validatedField.errorMessage = undefined;\n            }\n          }\n\n          if (validatedField.valid === false) {\n            isValid = false;\n          }\n        }\n\n        validatedFieldState[path] = validatedField;\n      },\n    );\n\n    await Promise.all(validationPromises);\n\n    if (!dequal(contextRef.current.fields, validatedFieldState)) {\n      dispatchFields({ type: \"REPLACE_STATE\", state: validatedFieldState });\n    }\n\n    setIsValid(isValid);\n\n    return isValid;\n  }, [\n    collectionSlug,\n    config,\n    dispatchFields,\n    id,\n    operation,\n    t,\n    user,\n    documentForm,\n  ]);\n\n  const submit = useCallback(\n    async (options: SubmitOptions = {}, e): Promise<void> => {\n      const {\n        action: actionArg = action,\n        method: methodToUse = method,\n        overrides: overridesFromArgs = {},\n        skipValidation,\n      } = options;\n\n      if (disabled) {\n        if (e) {\n          e.preventDefault();\n        }\n        return;\n      }\n\n      // create new toast promise which will resolve manually later\n      let errorToast, successToast;\n      const promise = new Promise((resolve, reject) => {\n        successToast = resolve;\n        errorToast = reject;\n      });\n\n      const hasFormSubmitAction =\n        actionArg || typeof action === \"string\" || typeof action === \"function\";\n\n      if (redirect || disableSuccessStatus || !hasFormSubmitAction) {\n        // Do not show submitting toast, as the promise toast may never disappear under these conditions.\n        // Instead, make successToast() or errorToast() throw toast.success / toast.error\n        successToast = (data) => toast.success(data);\n        errorToast = (data) => toast.error(data);\n      } else {\n        toast.promise(promise, {\n          error: (data) => {\n            return data as string;\n          },\n          loading: t(\"general:submitting\"),\n          success: (data) => {\n            return data as string;\n          },\n        });\n      }\n\n      if (e) {\n        e.stopPropagation();\n        e.preventDefault();\n      }\n\n      setProcessing(true);\n      setDisabled(true);\n\n      if (waitForAutocomplete) {\n        await wait(100);\n      }\n\n      // Execute server side validations\n      if (Array.isArray(beforeSubmit)) {\n        let revalidatedFormState: FormState;\n\n        const serializableFields = deepCopyObjectSimpleWithoutReactComponents(\n          contextRef.current.fields,\n        );\n\n        await beforeSubmit.reduce(async (priorOnChange, beforeSubmitFn) => {\n          await priorOnChange;\n\n          const result = await beforeSubmitFn({\n            formState: serializableFields,\n          });\n\n          revalidatedFormState = result;\n        }, Promise.resolve());\n\n        const isValid = Object.entries(revalidatedFormState).every(\n          ([, field]) => field.valid !== false,\n        );\n\n        setIsValid(isValid);\n\n        if (!isValid) {\n          setProcessing(false);\n          setSubmitted(true);\n          setDisabled(false);\n          return dispatchFields({\n            type: \"REPLACE_STATE\",\n            state: revalidatedFormState,\n          });\n        }\n      }\n\n      const isValid =\n        skipValidation || disableValidationOnSubmit\n          ? true\n          : await contextRef.current.validateForm();\n\n      setIsValid(isValid);\n      // If not valid, prevent submission\n      if (!isValid) {\n        errorToast(t(\"error:correctInvalidFields\"));\n        setProcessing(false);\n        setSubmitted(true);\n        setDisabled(false);\n        return;\n      }\n\n      let overrides = {};\n\n      if (typeof overridesFromArgs === \"function\") {\n        overrides = overridesFromArgs(contextRef.current.fields);\n      } else if (typeof overridesFromArgs === \"object\") {\n        overrides = overridesFromArgs;\n      }\n\n      // If submit handler comes through via props, run that\n      if (onSubmit) {\n        const serializableFields = deepCopyObjectSimpleWithoutReactComponents(\n          contextRef.current.fields,\n        );\n\n        const data = reduceFieldsToValues(serializableFields, true);\n\n        for (const [key, value] of Object.entries(overrides)) {\n          data[key] = value;\n        }\n\n        onSubmit(serializableFields, data);\n      }\n\n      if (!hasFormSubmitAction) {\n        // No action provided, so we should return. An example where this happens are lexical link drawers. Upon submitting the drawer, we\n        // want to close it without submitting the form. Stuff like validation would be handled by lexical before this, through beforeSubmit\n        setProcessing(false);\n        setSubmitted(true);\n        setDisabled(false);\n        return;\n      }\n\n      const formData = await contextRef.current.createFormData(overrides, {\n        mergeOverrideData: Boolean(typeof overridesFromArgs !== \"function\"),\n      });\n\n      try {\n        let res;\n\n        if (typeof actionArg === \"string\") {\n          res = await requests[methodToUse.toLowerCase()](actionArg, {\n            body: formData,\n            headers: {\n              \"Accept-Language\": i18n.language,\n            },\n          });\n        } else if (typeof action === \"function\") {\n          res = await action(formData);\n        }\n\n        setModified(false);\n        setDisabled(false);\n\n        if (typeof handleResponse === \"function\") {\n          handleResponse(res, successToast, errorToast);\n          return;\n        }\n\n        const contentType = res.headers.get(\"content-type\");\n        const isJSON =\n          contentType && contentType.indexOf(\"application/json\") !== -1;\n\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        let json: Record<string, any> = {};\n\n        if (isJSON) {\n          json = await res.json();\n        }\n        if (res.status < 400) {\n          if (typeof onSuccess === \"function\") {\n            const newFormState = await onSuccess(json);\n            if (newFormState) {\n              const { newState: mergedFormState } = mergeServerFormState({\n                acceptValues: true,\n                existingState: contextRef.current.fields || {},\n                incomingState: newFormState,\n              });\n\n              dispatchFields({\n                type: \"REPLACE_STATE\",\n                optimize: false,\n                state: mergedFormState,\n              });\n            }\n          }\n          setSubmitted(false);\n          setProcessing(false);\n\n          if (redirect) {\n            startRouteTransition(() => router.push(redirect));\n          } else if (!disableSuccessStatus) {\n            successToast(json.message || t(\"general:submissionSuccessful\"));\n          }\n        } else {\n          setProcessing(false);\n          setSubmitted(true);\n\n          contextRef.current = { ...contextRef.current }; // triggers rerender of all components that subscribe to form\n          if (json.message) {\n            errorToast(json.message);\n            return;\n          }\n\n          if (Array.isArray(json.errors)) {\n            const [fieldErrors, nonFieldErrors] = json.errors.reduce(\n              ([fieldErrs, nonFieldErrs], err) => {\n                const newFieldErrs = [];\n                const newNonFieldErrs = [];\n\n                if (err?.message) {\n                  newNonFieldErrs.push(err);\n                }\n\n                if (Array.isArray(err?.data?.errors)) {\n                  err.data?.errors.forEach((dataError) => {\n                    if (dataError?.path) {\n                      newFieldErrs.push(dataError);\n                    } else {\n                      newNonFieldErrs.push(dataError);\n                    }\n                  });\n                }\n\n                return [\n                  [...fieldErrs, ...newFieldErrs],\n                  [...nonFieldErrs, ...newNonFieldErrs],\n                ];\n              },\n              [[], []],\n            );\n\n            setIsValid(false);\n\n            dispatchFields({\n              type: \"ADD_SERVER_ERRORS\",\n              errors: fieldErrors,\n            });\n\n            nonFieldErrors.forEach((err) => {\n              errorToast(\n                <FieldErrorsToast\n                  errorMessage={err.message || t(\"error:unknown\")}\n                />,\n              );\n            });\n\n            return;\n          }\n\n          const message =\n            errorMessages?.[res.status] ||\n            res?.statusText ||\n            t(\"error:unknown\");\n\n          errorToast(message);\n        }\n      } catch (err) {\n        console.error(\"Error submitting form\", err); // eslint-disable-line no-console\n        setProcessing(false);\n        setSubmitted(true);\n        setDisabled(false);\n        errorToast(err.message);\n      }\n    },\n    [\n      beforeSubmit,\n      startRouteTransition,\n      action,\n      disableSuccessStatus,\n      disableValidationOnSubmit,\n      disabled,\n      dispatchFields,\n      handleResponse,\n      method,\n      onSubmit,\n      onSuccess,\n      redirect,\n      router,\n      t,\n      i18n,\n      waitForAutocomplete,\n    ],\n  );\n\n  const getFields = useCallback(() => contextRef.current.fields, []);\n\n  const getField = useCallback(\n    (path: string) => contextRef.current.fields[path],\n    [],\n  );\n\n  const getData = useCallback(\n    () => reduceFieldsToValues(contextRef.current.fields, true),\n    [],\n  );\n\n  const getSiblingData = useCallback(\n    (path: string) => getSiblingDataFunc(contextRef.current.fields, path),\n    [],\n  );\n\n  const getDataByPath = useCallback<GetDataByPath>(\n    (path: string) => getDataByPathFunc(contextRef.current.fields, path),\n    [],\n  );\n\n  const createFormData = useCallback<CreateFormData>(\n    async (overrides, { mergeOverrideData = true }) => {\n      let data = reduceFieldsToValues(contextRef.current.fields, true);\n\n      let file = data?.file;\n\n      if (file) {\n        delete data.file;\n      }\n\n      if (mergeOverrideData) {\n        data = {\n          ...data,\n          ...overrides,\n        };\n      } else {\n        data = overrides;\n      }\n\n      const handler = getUploadHandler({ collectionSlug });\n\n      if (file && typeof handler === \"function\") {\n        let filename = file.name;\n        const clientUploadContext = await handler({\n          file,\n          updateFilename: (value) => {\n            filename = value;\n          },\n        });\n\n        file = JSON.stringify({\n          clientUploadContext,\n          collectionSlug,\n          filename,\n          mimeType: file.type,\n          size: file.size,\n        });\n      }\n\n      const dataToSerialize = {\n        _payload: JSON.stringify(data),\n        file,\n      };\n\n      // nullAsUndefineds is important to allow uploads and relationship fields to clear themselves\n      const formData = serialize(dataToSerialize, {\n        indices: true,\n        nullsAsUndefineds: false,\n      });\n\n      return formData;\n    },\n    [collectionSlug, getUploadHandler],\n  );\n\n  const reset = useCallback(\n    async (data: unknown) => {\n      const controller = handleAbortRef(abortResetFormRef);\n\n      const docPreferences = await getDocPreferences();\n\n      const { state: newState } = await getFormState({\n        id,\n        collectionSlug,\n        data,\n        docPermissions,\n        docPreferences,\n        globalSlug,\n        locale,\n        operation,\n        renderAllFields: true,\n        schemaPath: collectionSlug ? collectionSlug : globalSlug,\n        signal: controller.signal,\n        skipValidation: true,\n      });\n\n      contextRef.current = { ...initContextState } as FormContextType;\n      setModified(false);\n      dispatchFields({ type: \"REPLACE_STATE\", state: newState });\n\n      abortResetFormRef.current = null;\n    },\n    [\n      collectionSlug,\n      dispatchFields,\n      globalSlug,\n      id,\n      operation,\n      getFormState,\n      docPermissions,\n      getDocPreferences,\n      locale,\n    ],\n  );\n\n  const replaceState = useCallback(\n    (state: FormState) => {\n      contextRef.current = { ...initContextState } as FormContextType;\n      setModified(false);\n      dispatchFields({ type: \"REPLACE_STATE\", state });\n    },\n    [dispatchFields],\n  );\n\n  const addFieldRow: FormContextType[\"addFieldRow\"] = useCallback(\n    ({ blockType, path, rowIndex: rowIndexArg, subFieldState }) => {\n      const newRows: unknown[] = getDataByPath(path) || [];\n      const rowIndex = rowIndexArg === undefined ? newRows.length : rowIndexArg;\n\n      // dispatch ADD_ROW adds a blank row to local form state.\n      // This performs no form state request, as the debounced onChange effect will do that for us.\n      dispatchFields({\n        type: \"ADD_ROW\",\n        blockType,\n        path,\n        rowIndex,\n        subFieldState,\n      });\n\n      setModified(true);\n    },\n    [dispatchFields, getDataByPath],\n  );\n\n  const moveFieldRow: FormContextType[\"moveFieldRow\"] = useCallback(\n    ({ moveFromIndex, moveToIndex, path }) => {\n      dispatchFields({\n        type: \"MOVE_ROW\",\n        moveFromIndex,\n        moveToIndex,\n        path,\n      });\n\n      setModified(true);\n    },\n    [dispatchFields],\n  );\n\n  const removeFieldRow: FormContextType[\"removeFieldRow\"] = useCallback(\n    ({ path, rowIndex }) => {\n      dispatchFields({ type: \"REMOVE_ROW\", path, rowIndex });\n\n      setModified(true);\n    },\n    [dispatchFields],\n  );\n\n  const replaceFieldRow: FormContextType[\"replaceFieldRow\"] = useCallback(\n    ({ blockType, path, rowIndex: rowIndexArg, subFieldState }) => {\n      const currentRows: unknown[] = getDataByPath(path);\n      const rowIndex =\n        rowIndexArg === undefined ? currentRows.length : rowIndexArg;\n\n      dispatchFields({\n        type: \"REPLACE_ROW\",\n        blockType,\n        path,\n        rowIndex,\n        subFieldState,\n      });\n\n      setModified(true);\n    },\n    [dispatchFields, getDataByPath],\n  );\n\n  useEffect(() => {\n    const abortOnChange = abortResetFormRef.current;\n\n    return () => {\n      abortAndIgnore(abortOnChange);\n    };\n  }, []);\n\n  useEffect(() => {\n    if (initializingFromProps !== undefined) {\n      setInitializing(initializingFromProps);\n    }\n  }, [initializingFromProps]);\n\n  contextRef.current.submit = submit;\n  contextRef.current.getFields = getFields;\n  contextRef.current.getField = getField;\n  contextRef.current.getData = getData;\n  contextRef.current.getSiblingData = getSiblingData;\n  contextRef.current.getDataByPath = getDataByPath;\n  contextRef.current.validateForm = validateForm;\n  contextRef.current.createFormData = createFormData;\n  contextRef.current.setModified = setModified;\n  contextRef.current.setProcessing = setProcessing;\n  contextRef.current.setBackgroundProcessing = setBackgroundProcessing;\n\n  contextRef.current.setSubmitted = setSubmitted;\n  contextRef.current.setIsValid = setIsValid;\n  contextRef.current.disabled = disabled;\n  contextRef.current.setDisabled = setDisabled;\n  contextRef.current.formRef = formRef;\n  contextRef.current.reset = reset;\n  contextRef.current.replaceState = replaceState;\n  contextRef.current.dispatchFields = dispatchFields;\n  contextRef.current.addFieldRow = addFieldRow;\n  contextRef.current.removeFieldRow = removeFieldRow;\n  contextRef.current.moveFieldRow = moveFieldRow;\n  contextRef.current.replaceFieldRow = replaceFieldRow;\n  contextRef.current.uuid = uuid;\n  contextRef.current.initializing = initializing;\n  contextRef.current.isValid = isValid;\n\n  useEffect(() => {\n    setIsMounted(true);\n  }, []);\n\n  useEffect(() => {\n    if (typeof disabledFromProps === \"boolean\") {\n      setDisabled(disabledFromProps);\n    }\n  }, [disabledFromProps]);\n\n  useEffect(() => {\n    if (typeof submittedFromProps === \"boolean\") {\n      setSubmitted(submittedFromProps);\n    }\n  }, [submittedFromProps]);\n\n  useEffect(() => {\n    if (initialState) {\n      contextRef.current = { ...initContextState } as FormContextType;\n      dispatchFields({\n        type: \"REPLACE_STATE\",\n        optimize: false,\n        sanitize: true,\n        state: initialState,\n      });\n    }\n  }, [initialState, dispatchFields]);\n\n  useThrottledEffect(\n    () => {\n      refreshCookie();\n    },\n    15000,\n    [formState],\n  );\n\n  useEffect(() => {\n    contextRef.current = { ...contextRef.current }; // triggers rerender of all components that subscribe to form\n    setModified(false);\n  }, [locale]);\n\n  const classes = [className, baseClass].filter(Boolean).join(\" \");\n\n  const executeOnChange = useEffectEvent((submitted: boolean) => {\n    queueTask(async () => {\n      if (Array.isArray(onChange)) {\n        let revalidatedFormState: FormState = contextRef.current.fields;\n\n        for (const onChangeFn of onChange) {\n          // Edit view default onChange is in packages/ui/src/views/Edit/index.tsx. This onChange usually sends a form state request\n          revalidatedFormState = await onChangeFn({\n            formState: deepCopyObjectSimpleWithoutReactComponents(\n              contextRef.current.fields,\n            ),\n            submitted,\n          });\n        }\n\n        if (!revalidatedFormState) {\n          return;\n        }\n\n        const { changed, newState } = mergeServerFormState({\n          existingState: contextRef.current.fields || {},\n          incomingState: revalidatedFormState,\n        });\n\n        if (changed) {\n          prevFormState.current = newState;\n\n          dispatchFields({\n            type: \"REPLACE_STATE\",\n            optimize: false,\n            state: newState,\n          });\n        }\n      }\n    });\n  });\n\n  useDebouncedEffect(\n    () => {\n      if (\n        (isFirstRenderRef.current ||\n          !dequal(formState, prevFormState.current)) &&\n        modified\n      ) {\n        executeOnChange(submitted);\n      }\n\n      prevFormState.current = formState;\n      isFirstRenderRef.current = false;\n    },\n    [modified, submitted, formState],\n    250,\n  );\n\n  const DocumentFormContextComponent: React.FC<any> = isDocumentForm\n    ? DocumentFormContext\n    : React.Fragment;\n\n  const documentFormContextProps = isDocumentForm\n    ? {\n        value: contextRef.current,\n      }\n    : {};\n\n  const El: \"form\" = (el as unknown as \"form\") || \"form\";\n\n  return (\n    <El\n      action={typeof action === \"function\" ? void action : action}\n      className={classes}\n      method={method}\n      noValidate\n      onSubmit={(e) => void contextRef.current.submit({}, e)}\n      ref={formRef}\n    >\n      <DocumentFormContextComponent {...documentFormContextProps}>\n        <FormContext value={contextRef.current}>\n          <FormWatchContext\n            value={{\n              fields: formState,\n              ...contextRef.current,\n            }}\n          >\n            <SubmittedContext value={submitted}>\n              <InitializingContext\n                value={!isMounted || (isMounted && initializing)}\n              >\n                <ProcessingContext value={processing}>\n                  <BackgroundProcessingContext value={backgroundProcessing}>\n                    <ModifiedContext value={modified}>\n                      {/* eslint-disable-next-line @eslint-react/no-context-provider */}\n                      <FormFieldsContext.Provider value={fieldsReducer}>\n                        {children}\n                      </FormFieldsContext.Provider>\n                    </ModifiedContext>\n                  </BackgroundProcessingContext>\n                </ProcessingContext>\n              </InitializingContext>\n            </SubmittedContext>\n          </FormWatchContext>\n        </FormContext>\n      </DocumentFormContextComponent>\n    </El>\n  );\n};\n\nexport {\n  DocumentFormContext,\n  FormContext,\n  FormFieldsContext,\n  FormWatchContext,\n  ModifiedContext,\n  ProcessingContext,\n  SubmittedContext,\n  useAllFormFields,\n  useDocumentForm,\n  useForm,\n  useFormFields,\n  useFormModified,\n  useFormProcessing,\n  useFormSubmitted,\n  useWatchForm,\n} from \"./context.js\";\n\nexport { FormProps };\n"],"mappings":"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","ignoreList":[]}