{"version":3,"file":"index.js","names":["useThrottledEffect","useAllFormFields","useFormSubmitted","buildPathSegments","WatchChildErrors","fields","path","parentPath","setErrorCount","formState","hasSubmitted","segmentsToMatch","errorCount","Object","entries","forEach","key","matchingSegment","some","segment","segmentToMatch","join","endsWith","startsWith","pathState","valid"],"sources":["../../../src/forms/WatchChildErrors/index.tsx"],"sourcesContent":["\"use client\";\n\nimport type { ClientField } from \"@convexcms/core\";\nimport type React from \"react\";\n\nimport { useThrottledEffect } from \"../../hooks/useThrottledEffect.js\";\nimport { useAllFormFields, useFormSubmitted } from \"../Form/context.js\";\nimport { buildPathSegments } from \"./buildPathSegments.js\";\n\ntype TrackSubSchemaErrorCountProps = {\n  fields?: ClientField[];\n  /**\n   * This path should only include path segments that affect data\n   * i.e. it should not include _index-0 type segments\n   *\n   * For collapsibles and tabs you can simply pass their parent path\n   */\n  path: (number | string)[];\n  setErrorCount: (count: number) => void;\n};\nexport const WatchChildErrors: React.FC<TrackSubSchemaErrorCountProps> = ({\n  fields,\n  path: parentPath,\n  setErrorCount,\n}) => {\n  const [formState] = useAllFormFields();\n  const hasSubmitted = useFormSubmitted();\n\n  const segmentsToMatch = buildPathSegments(fields);\n\n  useThrottledEffect(\n    () => {\n      if (hasSubmitted) {\n        let errorCount = 0;\n        Object.entries(formState).forEach(([key]) => {\n          const matchingSegment = segmentsToMatch?.some((segment) => {\n            const segmentToMatch = [...parentPath, segment].join(\".\");\n            // match fields with same parent path\n            if (segmentToMatch.endsWith(\".\")) {\n              return key.startsWith(segmentToMatch);\n            }\n            // match fields with same path\n            return key === segmentToMatch;\n          });\n\n          if (matchingSegment) {\n            const pathState = formState[key];\n            if (\"valid\" in pathState && !pathState.valid) {\n              errorCount += 1;\n            }\n          }\n        });\n        setErrorCount(errorCount);\n      }\n    },\n    250,\n    [formState, hasSubmitted, fields],\n  );\n\n  return null;\n};\n"],"mappings":"AAAA;;AAKA,SAASA,kBAAkB,QAAQ;AACnC,SAASC,gBAAgB,EAAEC,gBAAgB,QAAQ;AACnD,SAASC,iBAAiB,QAAQ;AAalC,OAAO,MAAMC,gBAAA,GAA4DA,CAAC;EACxEC,MAAM;EACNC,IAAA,EAAMC,UAAU;EAChBC;AAAa,CACd;EACC,MAAM,CAACC,SAAA,CAAU,GAAGR,gBAAA;EACpB,MAAMS,YAAA,GAAeR,gBAAA;EAErB,MAAMS,eAAA,GAAkBR,iBAAA,CAAkBE,MAAA;EAE1CL,kBAAA,CACE;IACE,IAAIU,YAAA,EAAc;MAChB,IAAIE,UAAA,GAAa;MACjBC,MAAA,CAAOC,OAAO,CAACL,SAAA,EAAWM,OAAO,CAAC,CAAC,CAACC,GAAA,CAAI;QACtC,MAAMC,eAAA,GAAkBN,eAAA,EAAiBO,IAAA,CAAMC,OAAA;UAC7C,MAAMC,cAAA,GAAiB,C,GAAIb,UAAA,EAAYY,OAAA,CAAQ,CAACE,IAAI,CAAC;UACrD;UACA,IAAID,cAAA,CAAeE,QAAQ,CAAC,MAAM;YAChC,OAAON,GAAA,CAAIO,UAAU,CAACH,cAAA;UACxB;UACA;UACA,OAAOJ,GAAA,KAAQI,cAAA;QACjB;QAEA,IAAIH,eAAA,EAAiB;UACnB,MAAMO,SAAA,GAAYf,SAAS,CAACO,GAAA,CAAI;UAChC,IAAI,WAAWQ,SAAA,IAAa,CAACA,SAAA,CAAUC,KAAK,EAAE;YAC5Cb,UAAA,IAAc;UAChB;QACF;MACF;MACAJ,aAAA,CAAcI,UAAA;IAChB;EACF,GACA,KACA,CAACH,SAAA,EAAWC,YAAA,EAAcL,MAAA,CAAO;EAGnC,OAAO;AACT","ignoreList":[]}