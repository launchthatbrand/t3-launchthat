{"version":3,"file":"index.js","names":["React","fieldIsHiddenOrDisabled","getFieldPaths","getFieldPermissions","RenderIfInViewport","useOperation","RenderField","baseClass","RenderFields","props","className","fields","forceRender","margins","parentIndexPath","parentPath","parentSchemaPath","permissions","readOnly","readOnlyFromParent","operation","length","_jsx","filter","Boolean","join","map","field","i","hasOperationPermission","fieldPermissions","read","hasReadPermission","parentName","includes","split","isReadOnly","admin","indexPath","path","schemaPath","index","clientFieldConfig"],"sources":["../../../src/forms/RenderFields/index.tsx"],"sourcesContent":["\"use client\";\n\nimport \"./index.scss\";\n\nimport React from \"react\";\nimport {\n  fieldIsHiddenOrDisabled,\n  getFieldPaths,\n  getFieldPermissions,\n} from \"@convexcms/core/shared\";\n\nimport type { RenderFieldsProps } from \"./types.js\";\nimport { RenderIfInViewport } from \"../../elements/RenderIfInViewport/index.js\";\nimport { useOperation } from \"../../providers/Operation/index.js\";\nimport { RenderField } from \"./RenderField.js\";\n\nconst baseClass = \"render-fields\";\n\nexport { RenderFieldsProps as Props };\n\nexport const RenderFields: React.FC<RenderFieldsProps> = (props) => {\n  const {\n    className,\n    fields,\n    forceRender,\n    margins,\n    parentIndexPath,\n    parentPath,\n    parentSchemaPath,\n    permissions,\n    readOnly: readOnlyFromParent,\n  } = props;\n\n  const operation = useOperation();\n\n  if (fields && fields.length > 0) {\n    return (\n      <RenderIfInViewport\n        className={[\n          baseClass,\n          className,\n          margins && `${baseClass}--margins-${margins}`,\n          margins === false && `${baseClass}--margins-none`,\n        ]\n          .filter(Boolean)\n          .join(\" \")}\n        forceRender={forceRender}\n      >\n        {fields.map((field, i) => {\n          // For sidebar fields in the main fields array, `field` will be `null`, and visa versa\n          // This is to keep the order of the fields consistent and maintain the correct index paths for the main fields (i)\n          if (!field || fieldIsHiddenOrDisabled(field)) {\n            return null;\n          }\n\n          const {\n            operation: hasOperationPermission,\n            permissions: fieldPermissions,\n            read: hasReadPermission,\n          } = getFieldPermissions({\n            field,\n            operation,\n            parentName: parentPath?.includes(\".\")\n              ? parentPath.split(\".\")[parentPath.split(\".\").length - 1]\n              : parentPath,\n            permissions,\n          });\n\n          // If the user cannot read the field, then filter it out\n          // This is different from `admin.readOnly` which is executed based on `operation`\n          if (\"name\" in field && !hasReadPermission) {\n            return null;\n          }\n\n          // `admin.readOnly` displays the value but prevents the field from being edited\n          let isReadOnly = readOnlyFromParent || field?.admin?.readOnly;\n\n          // If parent field is `readOnly: true`, but this field is `readOnly: false`, the field should still be editable\n          if (isReadOnly && field.admin?.readOnly === false) {\n            isReadOnly = false;\n          }\n\n          // If the user does not have access at the operation level, to begin with, force it to be read-only\n          if (\"name\" in field && !hasOperationPermission) {\n            isReadOnly = true;\n          }\n\n          const { indexPath, path, schemaPath } = getFieldPaths({\n            field,\n            index: i,\n            parentIndexPath,\n            parentPath,\n            parentSchemaPath,\n          });\n\n          return (\n            <RenderField\n              clientFieldConfig={field}\n              forceRender={forceRender}\n              indexPath={indexPath}\n              key={`${path}-${i}`}\n              parentPath={parentPath}\n              parentSchemaPath={parentSchemaPath}\n              path={path}\n              permissions={fieldPermissions}\n              readOnly={isReadOnly}\n              schemaPath={schemaPath}\n            />\n          );\n        })}\n      </RenderIfInViewport>\n    );\n  }\n\n  return null;\n};\n"],"mappings":"AAAA;;;AAEA,OAAO;AAEP,OAAOA,KAAA,MAAW;AAClB,SACEC,uBAAuB,EACvBC,aAAa,EACbC,mBAAmB,QACd;AAGP,SAASC,kBAAkB,QAAQ;AACnC,SAASC,YAAY,QAAQ;AAC7B,SAASC,WAAW,QAAQ;AAE5B,MAAMC,SAAA,GAAY;AAIlB,OAAO,MAAMC,YAAA,GAA6CC,KAAA;EACxD,MAAM;IACJC,SAAS;IACTC,MAAM;IACNC,WAAW;IACXC,OAAO;IACPC,eAAe;IACfC,UAAU;IACVC,gBAAgB;IAChBC,WAAW;IACXC,QAAA,EAAUC;EAAkB,CAC7B,GAAGV,KAAA;EAEJ,MAAMW,SAAA,GAAYf,YAAA;EAElB,IAAIM,MAAA,IAAUA,MAAA,CAAOU,MAAM,GAAG,GAAG;IAC/B,oBACEC,IAAA,CAAClB,kBAAA;MACCM,SAAA,EAAW,CACTH,SAAA,EACAG,SAAA,EACAG,OAAA,IAAW,GAAGN,SAAA,aAAsBM,OAAA,EAAS,EAC7CA,OAAA,KAAY,SAAS,GAAGN,SAAA,gBAAyB,CAClD,CACEgB,MAAM,CAACC,OAAA,EACPC,IAAI,CAAC;MACRb,WAAA,EAAaA,WAAA;gBAEZD,MAAA,CAAOe,GAAG,CAAC,CAACC,KAAA,EAAOC,CAAA;QAClB;QACA;QACA,IAAI,CAACD,KAAA,IAAS1B,uBAAA,CAAwB0B,KAAA,GAAQ;UAC5C,OAAO;QACT;QAEA,MAAM;UACJP,SAAA,EAAWS,sBAAsB;UACjCZ,WAAA,EAAaa,gBAAgB;UAC7BC,IAAA,EAAMC;QAAiB,CACxB,GAAG7B,mBAAA,CAAoB;UACtBwB,KAAA;UACAP,SAAA;UACAa,UAAA,EAAYlB,UAAA,EAAYmB,QAAA,CAAS,OAC7BnB,UAAA,CAAWoB,KAAK,CAAC,IAAI,CAACpB,UAAA,CAAWoB,KAAK,CAAC,KAAKd,MAAM,GAAG,EAAE,GACvDN,UAAA;UACJE;QACF;QAEA;QACA;QACA,IAAI,UAAUU,KAAA,IAAS,CAACK,iBAAA,EAAmB;UACzC,OAAO;QACT;QAEA;QACA,IAAII,UAAA,GAAajB,kBAAA,IAAsBQ,KAAA,EAAOU,KAAA,EAAOnB,QAAA;QAErD;QACA,IAAIkB,UAAA,IAAcT,KAAA,CAAMU,KAAK,EAAEnB,QAAA,KAAa,OAAO;UACjDkB,UAAA,GAAa;QACf;QAEA;QACA,IAAI,UAAUT,KAAA,IAAS,CAACE,sBAAA,EAAwB;UAC9CO,UAAA,GAAa;QACf;QAEA,MAAM;UAAEE,SAAS;UAAEC,IAAI;UAAEC;QAAU,CAAE,GAAGtC,aAAA,CAAc;UACpDyB,KAAA;UACAc,KAAA,EAAOb,CAAA;UACPd,eAAA;UACAC,UAAA;UACAC;QACF;QAEA,oBACEM,IAAA,CAAChB,WAAA;UACCoC,iBAAA,EAAmBf,KAAA;UACnBf,WAAA,EAAaA,WAAA;UACb0B,SAAA,EAAWA,SAAA;UAEXvB,UAAA,EAAYA,UAAA;UACZC,gBAAA,EAAkBA,gBAAA;UAClBuB,IAAA,EAAMA,IAAA;UACNtB,WAAA,EAAaa,gBAAA;UACbZ,QAAA,EAAUkB,UAAA;UACVI,UAAA,EAAYA;WANP,GAAGD,IAAA,IAAQX,CAAA,EAAG;MASzB;;EAGN;EAEA,OAAO;AACT","ignoreList":[]}