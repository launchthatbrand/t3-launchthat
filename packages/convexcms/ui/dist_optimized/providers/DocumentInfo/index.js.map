{"version":3,"file":"index.js","names":["React","createContext","use","useCallback","useEffect","useMemo","useRef","useState","qs","useAuth","requests","formatDocTitle","useConfig","useLocale","useLocaleLoading","usePreferences","useTranslation","UploadEditsProvider","useUploadEdits","useGetDocPermissions","Context","useDocumentInfo","DocumentInfo","children","props","id","collectionSlug","currentEditor","currentEditorFromProps","docPermissions","docPermissionsFromProps","globalSlug","hasPublishedDoc","hasPublishedDocFromProps","hasPublishPermission","hasPublishPermissionFromProps","hasSavePermission","hasSavePermissionFromProps","initialData","initialState","isLocked","isLockedFromProps","lastUpdateTime","lastUpdateTimeFromProps","mostRecentVersionIsAutosaved","mostRecentVersionIsAutosavedFromProps","unpublishedVersionCount","unpublishedVersionCountFromProps","versionCount","versionCountFromProps","setDocPermissions","setHasSavePermission","setHasPublishPermission","permissions","config","admin","dateFormat","routes","api","serverURL","getEntityConfig","collectionConfig","globalConfig","abortControllerRef","AbortController","docConfig","i18n","uploadEdits","documentTitle","setDocumentTitle","data","fallback","toString","setMostRecentVersionIsAutosaved","setVersionCount","setHasPublishedDoc","setUnpublishedVersionCount","documentIsLocked","setDocumentIsLocked","setCurrentEditor","setLastUpdateTime","savedDocumentData","setSavedDocumentData","uploadStatus","setUploadStatus","updateUploadStatus","status","getPreference","setPreference","code","locale","localeIsLoading","isInitializing","undefined","baseURL","slug","pluralType","preferencesKey","unlockDocument","docID","isGlobal","query","request","get","docs","json","length","lockID","delete","headers","error","console","updateDocumentEditor","user","userData","relationTo","collection","value","patch","body","JSON","stringify","getDocPermissions","getDocPreferences","setDocFieldPreferences","path","fieldPreferences","allPreferences","fields","e","incrementVersionCount","newCount","versions","maxPerDoc","Math","min","max","updateSavedDocumentData","re1","current","abort","_err","action","docURL","params","depth","addQueryPrefix","title","_jsx","DocumentInfoProvider"],"sources":["../../../src/providers/DocumentInfo/index.tsx"],"sourcesContent":["\"use client\";\n\nimport type {\n  ClientUser,\n  DocumentPreferences,\n  SanitizedDocumentPermissions,\n} from \"@convexcms/core\";\nimport React, {\n  createContext,\n  use,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport * as qs from \"qs-esm\";\n\nimport type { DocumentInfoContext, DocumentInfoProps } from \"./types.js\";\nimport { useAuth } from \"../../providers/Auth/index.js\";\nimport { requests } from \"../../utilities/api.js\";\nimport { formatDocTitle } from \"../../utilities/formatDocTitle/index.js\";\nimport { useConfig } from \"../Config/index.js\";\nimport { useLocale, useLocaleLoading } from \"../Locale/index.js\";\nimport { usePreferences } from \"../Preferences/index.js\";\nimport { useTranslation } from \"../Translation/index.js\";\nimport { UploadEditsProvider, useUploadEdits } from \"../UploadEdits/index.js\";\nimport { useGetDocPermissions } from \"./useGetDocPermissions.js\";\n\nconst Context = createContext({} as DocumentInfoContext);\n\nexport type * from \"./types.js\";\n\nexport const useDocumentInfo = (): DocumentInfoContext => use(Context);\n\nconst DocumentInfo: React.FC<\n  {\n    readonly children: React.ReactNode;\n  } & DocumentInfoProps\n> = ({ children, ...props }) => {\n  const {\n    id,\n    collectionSlug,\n    currentEditor: currentEditorFromProps,\n    docPermissions: docPermissionsFromProps,\n    globalSlug,\n    hasPublishedDoc: hasPublishedDocFromProps,\n    hasPublishPermission: hasPublishPermissionFromProps,\n    hasSavePermission: hasSavePermissionFromProps,\n    initialData,\n    initialState,\n    isLocked: isLockedFromProps,\n    lastUpdateTime: lastUpdateTimeFromProps,\n    mostRecentVersionIsAutosaved: mostRecentVersionIsAutosavedFromProps,\n    unpublishedVersionCount: unpublishedVersionCountFromProps,\n    versionCount: versionCountFromProps,\n  } = props;\n\n  const [docPermissions, setDocPermissions] =\n    useState<SanitizedDocumentPermissions>(docPermissionsFromProps);\n\n  const [hasSavePermission, setHasSavePermission] = useState<boolean>(\n    hasSavePermissionFromProps,\n  );\n\n  const [hasPublishPermission, setHasPublishPermission] = useState<boolean>(\n    hasPublishPermissionFromProps,\n  );\n\n  const { permissions } = useAuth();\n\n  const {\n    config: {\n      admin: { dateFormat },\n      routes: { api },\n      serverURL,\n    },\n    getEntityConfig,\n  } = useConfig();\n\n  const collectionConfig = getEntityConfig({ collectionSlug });\n  const globalConfig = getEntityConfig({ globalSlug });\n\n  const abortControllerRef = useRef(new AbortController());\n  const docConfig = collectionConfig || globalConfig;\n\n  const { i18n } = useTranslation();\n\n  const { uploadEdits } = useUploadEdits();\n\n  const [documentTitle, setDocumentTitle] = useState(() =>\n    formatDocTitle({\n      collectionConfig,\n      data: { ...(initialData || {}), id },\n      dateFormat,\n      fallback: id?.toString(),\n      globalConfig,\n      i18n,\n    }),\n  );\n\n  const [mostRecentVersionIsAutosaved, setMostRecentVersionIsAutosaved] =\n    useState(mostRecentVersionIsAutosavedFromProps);\n\n  const [versionCount, setVersionCount] = useState(versionCountFromProps);\n\n  const [hasPublishedDoc, setHasPublishedDoc] = useState(\n    hasPublishedDocFromProps,\n  );\n  const [unpublishedVersionCount, setUnpublishedVersionCount] = useState(\n    unpublishedVersionCountFromProps,\n  );\n\n  const [documentIsLocked, setDocumentIsLocked] = useState<boolean | undefined>(\n    isLockedFromProps,\n  );\n  const [currentEditor, setCurrentEditor] = useState<ClientUser | null>(\n    currentEditorFromProps,\n  );\n  const [lastUpdateTime, setLastUpdateTime] = useState<number>(\n    lastUpdateTimeFromProps,\n  );\n  const [savedDocumentData, setSavedDocumentData] = useState(initialData);\n  const [uploadStatus, setUploadStatus] = useState<\n    \"failed\" | \"idle\" | \"uploading\"\n  >(\"idle\");\n\n  const updateUploadStatus = useCallback(\n    (status: \"failed\" | \"idle\" | \"uploading\") => {\n      setUploadStatus(status);\n    },\n    [],\n  );\n\n  const { getPreference, setPreference } = usePreferences();\n  const { code: locale } = useLocale();\n  const { localeIsLoading } = useLocaleLoading();\n\n  const isInitializing = useMemo(\n    () =>\n      initialState === undefined ||\n      initialData === undefined ||\n      localeIsLoading,\n    [initialData, initialState, localeIsLoading],\n  );\n\n  const baseURL = `${serverURL}${api}`;\n  let slug: string;\n  let pluralType: \"collections\" | \"globals\";\n  let preferencesKey: string;\n\n  if (globalSlug) {\n    slug = globalSlug;\n    pluralType = \"globals\";\n    preferencesKey = `global-${slug}`;\n  }\n\n  if (collectionSlug) {\n    slug = collectionSlug;\n    pluralType = \"collections\";\n\n    if (id) {\n      preferencesKey = `collection-${slug}-${id}`;\n    }\n  }\n\n  const unlockDocument = useCallback(\n    async (docID: number | string, slug: string) => {\n      try {\n        const isGlobal = slug === globalSlug;\n\n        const query = isGlobal\n          ? `where[globalSlug][equals]=${slug}`\n          : `where[document.value][equals]=${docID}&where[document.relationTo][equals]=${slug}`;\n\n        const request = await requests.get(\n          `${serverURL}${api}/payload-locked-documents?${query}`,\n        );\n\n        const { docs } = await request.json();\n\n        if (docs.length > 0) {\n          const lockID = docs[0].id;\n          await requests.delete(\n            `${serverURL}${api}/payload-locked-documents/${lockID}`,\n            {\n              headers: {\n                \"Content-Type\": \"application/json\",\n              },\n            },\n          );\n          setDocumentIsLocked(false);\n        }\n      } catch (error) {\n        // eslint-disable-next-line no-console\n        console.error(\"Failed to unlock the document\", error);\n      }\n    },\n    [serverURL, api, globalSlug],\n  );\n\n  const updateDocumentEditor = useCallback(\n    async (\n      docID: number | string,\n      slug: string,\n      user: ClientUser | number | string,\n    ) => {\n      try {\n        const isGlobal = slug === globalSlug;\n\n        const query = isGlobal\n          ? `where[globalSlug][equals]=${slug}`\n          : `where[document.value][equals]=${docID}&where[document.relationTo][equals]=${slug}`;\n\n        // Check if the document is already locked\n        const request = await requests.get(\n          `${serverURL}${api}/payload-locked-documents?${query}`,\n        );\n\n        const { docs } = await request.json();\n\n        if (docs.length > 0) {\n          const lockID = docs[0].id;\n\n          const userData =\n            typeof user === \"object\"\n              ? { relationTo: user.collection, value: user.id }\n              : { relationTo: \"users\", value: user };\n\n          // Send a patch request to update the _lastEdited info\n          await requests.patch(\n            `${serverURL}${api}/payload-locked-documents/${lockID}`,\n            {\n              body: JSON.stringify({\n                user: userData,\n              }),\n              headers: {\n                \"Content-Type\": \"application/json\",\n              },\n            },\n          );\n        }\n      } catch (error) {\n        // eslint-disable-next-line no-console\n        console.error(\"Failed to update the document editor\", error);\n      }\n    },\n    [serverURL, api, globalSlug],\n  );\n\n  const getDocPermissions = useGetDocPermissions({\n    id: id as string,\n    api,\n    collectionSlug,\n    globalSlug,\n    i18n,\n    locale,\n    permissions,\n    serverURL,\n    setDocPermissions,\n    setHasPublishPermission,\n    setHasSavePermission,\n  });\n\n  const getDocPreferences = useCallback(() => {\n    return getPreference<DocumentPreferences>(preferencesKey);\n  }, [getPreference, preferencesKey]);\n\n  const setDocFieldPreferences = useCallback<\n    DocumentInfoContext[\"setDocFieldPreferences\"]\n  >(\n    async (path, fieldPreferences) => {\n      const allPreferences = await getDocPreferences();\n\n      if (preferencesKey) {\n        try {\n          await setPreference(preferencesKey, {\n            ...allPreferences,\n            fields: {\n              ...(allPreferences?.fields || {}),\n              [path]: {\n                ...allPreferences?.fields?.[path],\n                ...fieldPreferences,\n              },\n            },\n          });\n        } catch (e) {\n          console.error(e); // eslint-disable-line no-console\n        }\n      }\n    },\n    [setPreference, preferencesKey, getDocPreferences],\n  );\n\n  const incrementVersionCount = useCallback(() => {\n    const newCount = versionCount + 1;\n    if (collectionConfig && collectionConfig.versions) {\n      if (collectionConfig.versions.maxPerDoc > 0) {\n        setVersionCount(\n          Math.min(newCount, collectionConfig.versions.maxPerDoc),\n        );\n      } else {\n        setVersionCount(newCount);\n      }\n    } else if (globalConfig && globalConfig.versions) {\n      if (globalConfig.versions.max > 0) {\n        setVersionCount(Math.min(newCount, globalConfig.versions.max));\n      } else {\n        setVersionCount(newCount);\n      }\n    }\n  }, [collectionConfig, globalConfig, versionCount]);\n\n  const updateSavedDocumentData = React.useCallback<\n    DocumentInfoContext[\"updateSavedDocumentData\"]\n  >((json) => {\n    setSavedDocumentData(json);\n  }, []);\n\n  useEffect(() => {\n    setDocumentTitle(\n      formatDocTitle({\n        collectionConfig,\n        data: { ...savedDocumentData, id },\n        dateFormat,\n        fallback: id?.toString(),\n        globalConfig,\n        i18n,\n      }),\n    );\n  }, [collectionConfig, globalConfig, savedDocumentData, dateFormat, i18n, id]);\n\n  // clean on unmount\n  useEffect(() => {\n    const re1 = abortControllerRef.current;\n\n    return () => {\n      if (re1) {\n        try {\n          re1.abort();\n        } catch (_err) {\n          // swallow error\n        }\n      }\n    };\n  }, []);\n\n  const action: string = React.useMemo(() => {\n    const docURL = `${baseURL}${pluralType === \"globals\" ? `/globals` : \"\"}/${slug}${id ? `/${id}` : \"\"}`;\n    const params = {\n      depth: 0,\n      \"fallback-locale\": \"null\",\n      locale,\n      uploadEdits: uploadEdits || undefined,\n    };\n\n    return `${docURL}${qs.stringify(params, {\n      addQueryPrefix: true,\n    })}`;\n  }, [baseURL, locale, pluralType, id, slug, uploadEdits]);\n\n  const value: DocumentInfoContext = {\n    ...props,\n    action,\n    currentEditor,\n    docConfig,\n    docPermissions,\n    documentIsLocked,\n    getDocPermissions,\n    getDocPreferences,\n    hasPublishedDoc,\n    hasPublishPermission,\n    hasSavePermission,\n    incrementVersionCount,\n    initialData,\n    initialState,\n    isInitializing,\n    lastUpdateTime,\n    mostRecentVersionIsAutosaved,\n    preferencesKey,\n    savedDocumentData,\n    setCurrentEditor,\n    setDocFieldPreferences,\n    setDocumentIsLocked,\n    setDocumentTitle,\n    setHasPublishedDoc,\n    setLastUpdateTime,\n    setMostRecentVersionIsAutosaved,\n    setUnpublishedVersionCount,\n    setUploadStatus: updateUploadStatus,\n    title: documentTitle,\n    unlockDocument,\n    unpublishedVersionCount,\n    updateDocumentEditor,\n    updateSavedDocumentData,\n    uploadStatus,\n    versionCount,\n  };\n\n  return <Context value={value}>{children}</Context>;\n};\n\nexport const DocumentInfoProvider: React.FC<\n  {\n    readonly children: React.ReactNode;\n  } & DocumentInfoProps\n> = (props) => {\n  return (\n    <UploadEditsProvider>\n      <DocumentInfo {...props} />\n    </UploadEditsProvider>\n  );\n};\n"],"mappings":"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","ignoreList":[]}