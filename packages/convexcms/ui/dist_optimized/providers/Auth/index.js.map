{"version":3,"file":"index.js","names":["React","createContext","use","useCallback","useEffect","useState","usePathname","useRouter","formatAdminURL","useModal","qs","toast","stayLoggedInModalSlug","useDebounce","useTranslation","requests","useConfig","useRouteTransition","Context","maxTimeoutTime","AuthProvider","children","permissions","initialPermissions","user","initialUser","setUserInMemory","tokenInMemory","setTokenInMemory","tokenExpiration","setTokenExpiration","pathname","router","config","admin","routes","inactivity","logoutInactivityRoute","userSlug","adminRoute","api","apiRoute","serverURL","setPermissions","i18n","closeAllModals","openModal","lastLocationChange","setLastLocationChange","debouncedLocationChange","refreshTokenTimeoutRef","useRef","startRouteTransition","id","redirectToInactivityRoute","replace","path","window","location","startsWith","encodeURIComponent","revokeTokenAndExpire","undefined","clearTimeout","current","setNewUser","userResponse","token","exp","refreshCookie","forceRefresh","now","Math","round","Date","getTime","remainingTime","setTimeout","refresh","request","post","headers","language","status","json","e","error","message","refreshCookieAsync","skipSetUser","logOut","collection","refreshPermissions","locale","params","stringify","addQueryPrefix","get","Error","fetchFullUser","credentials","reminder","forceLogOut","remindInTimeFromNow","max","min","forceLogOutInTimeFromNow","_jsx","value","setUser","useAuth"],"sources":["../../../src/providers/Auth/index.tsx"],"sourcesContent":["\"use client\";\n\nimport type { ClientUser, SanitizedPermissions, User } from \"@convexcms/core\";\nimport React, {\n  createContext,\n  use,\n  useCallback,\n  useEffect,\n  useState,\n} from \"react\";\nimport { usePathname, useRouter } from \"next/navigation.js\";\nimport { formatAdminURL } from \"@convexcms/core/shared\";\nimport { useModal } from \"@faceless-ui/modal\";\nimport * as qs from \"qs-esm\";\nimport { toast } from \"sonner\";\n\nimport { stayLoggedInModalSlug } from \"../../elements/StayLoggedIn/index.js\";\nimport { useDebounce } from \"../../hooks/useDebounce.js\";\nimport { useTranslation } from \"../../providers/Translation/index.js\";\nimport { requests } from \"../../utilities/api.js\";\nimport { useConfig } from \"../Config/index.js\";\nimport { useRouteTransition } from \"../RouteTransition/index.js\";\n\nexport type UserWithToken<T = ClientUser> = {\n  exp: number;\n  token: string;\n  user: T;\n};\n\nexport type AuthContext<T = ClientUser> = {\n  fetchFullUser: () => Promise<null | User>;\n  logOut: () => Promise<boolean>;\n  permissions?: SanitizedPermissions;\n  refreshCookie: (forceRefresh?: boolean) => void;\n  refreshCookieAsync: () => Promise<ClientUser>;\n  refreshPermissions: () => Promise<void>;\n  setPermissions: (permissions: SanitizedPermissions) => void;\n  setUser: (user: null | UserWithToken<T>) => void;\n  strategy?: string;\n  token?: string;\n  tokenExpiration?: number;\n  user?: null | T;\n};\n\nconst Context = createContext({} as AuthContext);\n\nconst maxTimeoutTime = 2147483647;\n\ntype Props = {\n  children: React.ReactNode;\n  permissions?: SanitizedPermissions;\n  user?: ClientUser | null;\n};\n\nexport function AuthProvider({\n  children,\n  permissions: initialPermissions,\n  user: initialUser,\n}: Props) {\n  const [user, setUserInMemory] = useState<ClientUser | null>(initialUser);\n  const [tokenInMemory, setTokenInMemory] = useState<string>();\n  const [tokenExpiration, setTokenExpiration] = useState<number>();\n  const pathname = usePathname();\n  const router = useRouter();\n\n  const { config } = useConfig();\n\n  const {\n    admin: {\n      routes: { inactivity: logoutInactivityRoute },\n      user: userSlug,\n    },\n    routes: { admin: adminRoute, api: apiRoute },\n    serverURL,\n  } = config;\n\n  const [permissions, setPermissions] =\n    useState<SanitizedPermissions>(initialPermissions);\n\n  const { i18n } = useTranslation();\n  const { closeAllModals, openModal } = useModal();\n  const [lastLocationChange, setLastLocationChange] = useState(0);\n  const debouncedLocationChange = useDebounce(lastLocationChange, 10000);\n  const refreshTokenTimeoutRef =\n    React.useRef<ReturnType<typeof setTimeout>>(null);\n  const { startRouteTransition } = useRouteTransition();\n\n  const id = user?.id;\n\n  const redirectToInactivityRoute = useCallback(() => {\n    startRouteTransition(() =>\n      router.replace(\n        formatAdminURL({\n          adminRoute,\n          path: `${logoutInactivityRoute}${window.location.pathname.startsWith(adminRoute) ? `?redirect=${encodeURIComponent(window.location.pathname)}` : \"\"}`,\n        }),\n      ),\n    );\n\n    closeAllModals();\n  }, [\n    router,\n    adminRoute,\n    logoutInactivityRoute,\n    closeAllModals,\n    startRouteTransition,\n  ]);\n\n  const revokeTokenAndExpire = useCallback(() => {\n    setTokenInMemory(undefined);\n    setTokenExpiration(undefined);\n    clearTimeout(refreshTokenTimeoutRef.current);\n  }, []);\n\n  const setNewUser = useCallback(\n    (userResponse: null | UserWithToken) => {\n      if (userResponse?.user) {\n        setUserInMemory(userResponse.user);\n        setTokenInMemory(userResponse.token);\n        setTokenExpiration(userResponse.exp);\n      } else {\n        setUserInMemory(null);\n        revokeTokenAndExpire();\n      }\n    },\n    [revokeTokenAndExpire],\n  );\n\n  const refreshCookie = useCallback(\n    (forceRefresh?: boolean) => {\n      const now = Math.round(new Date().getTime() / 1000);\n      const remainingTime =\n        (typeof tokenExpiration === \"number\" ? tokenExpiration : 0) - now;\n\n      if (forceRefresh || (tokenExpiration && remainingTime < 120)) {\n        refreshTokenTimeoutRef.current = setTimeout(() => {\n          async function refresh() {\n            try {\n              const request = await requests.post(\n                `${serverURL}${apiRoute}/${userSlug}/refresh-token?refresh`,\n                {\n                  headers: {\n                    \"Accept-Language\": i18n.language,\n                  },\n                },\n              );\n\n              if (request.status === 200) {\n                const json = await request.json();\n                setNewUser(json);\n              } else {\n                setNewUser(null);\n                redirectToInactivityRoute();\n              }\n            } catch (e) {\n              toast.error(e.message);\n            }\n          }\n\n          void refresh();\n        }, 1000);\n      }\n\n      return () => {\n        clearTimeout(refreshTokenTimeoutRef.current);\n      };\n    },\n    [\n      apiRoute,\n      i18n.language,\n      redirectToInactivityRoute,\n      serverURL,\n      setNewUser,\n      tokenExpiration,\n      userSlug,\n    ],\n  );\n\n  const refreshCookieAsync = useCallback(\n    async (skipSetUser?: boolean): Promise<ClientUser> => {\n      try {\n        const request = await requests.post(\n          `${serverURL}${apiRoute}/${userSlug}/refresh-token`,\n          {\n            headers: {\n              \"Accept-Language\": i18n.language,\n            },\n          },\n        );\n\n        if (request.status === 200) {\n          const json = await request.json();\n          if (!skipSetUser) {\n            setNewUser(json);\n          }\n          return json.user;\n        }\n\n        setNewUser(null);\n        redirectToInactivityRoute();\n        return null;\n      } catch (e) {\n        toast.error(`Refreshing token failed: ${e.message}`);\n        return null;\n      }\n    },\n    [\n      apiRoute,\n      i18n.language,\n      redirectToInactivityRoute,\n      serverURL,\n      setNewUser,\n      userSlug,\n    ],\n  );\n\n  const logOut = useCallback(async () => {\n    try {\n      await requests.post(`${serverURL}${apiRoute}/${user.collection}/logout`);\n      setNewUser(null);\n      revokeTokenAndExpire();\n      return true;\n    } catch (e) {\n      toast.error(`Logging out failed: ${e.message}`);\n      return false;\n    }\n  }, [apiRoute, revokeTokenAndExpire, serverURL, setNewUser, user]);\n\n  const refreshPermissions = useCallback(\n    async ({ locale }: { locale?: string } = {}) => {\n      const params = qs.stringify(\n        {\n          locale,\n        },\n        {\n          addQueryPrefix: true,\n        },\n      );\n\n      try {\n        const request = await requests.get(\n          `${serverURL}${apiRoute}/access${params}`,\n          {\n            headers: {\n              \"Accept-Language\": i18n.language,\n            },\n          },\n        );\n\n        if (request.status === 200) {\n          const json: SanitizedPermissions = await request.json();\n          setPermissions(json);\n        } else {\n          throw new Error(\n            `Fetching permissions failed with status code ${request.status}`,\n          );\n        }\n      } catch (e) {\n        toast.error(`Refreshing permissions failed: ${e.message}`);\n      }\n    },\n    [serverURL, apiRoute, i18n],\n  );\n\n  const fetchFullUser = React.useCallback(async () => {\n    try {\n      const request = await requests.get(\n        `${serverURL}${apiRoute}/${userSlug}/me`,\n        {\n          credentials: \"include\",\n          headers: {\n            \"Accept-Language\": i18n.language,\n          },\n        },\n      );\n\n      if (request.status === 200) {\n        const json: UserWithToken = await request.json();\n        const user = null;\n\n        setNewUser(json);\n        return user;\n      }\n    } catch (e) {\n      toast.error(`Fetching user failed: ${e.message}`);\n    }\n\n    return null;\n  }, [serverURL, apiRoute, userSlug, i18n.language, setNewUser]);\n\n  // On mount, get user and set\n  useEffect(() => {\n    void fetchFullUser();\n  }, [fetchFullUser]);\n\n  // When location changes, refresh cookie\n  useEffect(() => {\n    if (id) {\n      refreshCookie();\n    }\n  }, [debouncedLocationChange, refreshCookie, id]);\n\n  useEffect(() => {\n    setLastLocationChange(Date.now());\n  }, [pathname]);\n\n  useEffect(() => {\n    let reminder: ReturnType<typeof setTimeout>;\n    let forceLogOut: ReturnType<typeof setTimeout>;\n    const now = Math.round(new Date().getTime() / 1000);\n    const remainingTime =\n      typeof tokenExpiration === \"number\" ? tokenExpiration - now : 0;\n    const remindInTimeFromNow = Math.max(\n      Math.min((remainingTime - 60) * 1000, maxTimeoutTime),\n      0,\n    );\n    const forceLogOutInTimeFromNow = Math.max(\n      Math.min(remainingTime * 1000, maxTimeoutTime),\n      0,\n    );\n\n    if (!user) {\n      clearTimeout(reminder);\n      clearTimeout(forceLogOut);\n      return;\n    }\n\n    if (remainingTime > 0) {\n      reminder = setTimeout(() => {\n        openModal(stayLoggedInModalSlug);\n      }, remindInTimeFromNow);\n\n      forceLogOut = setTimeout(() => {\n        setNewUser(null);\n        redirectToInactivityRoute();\n      }, forceLogOutInTimeFromNow);\n    }\n\n    return () => {\n      if (reminder) {\n        clearTimeout(reminder);\n      }\n      if (forceLogOut) {\n        clearTimeout(forceLogOut);\n      }\n    };\n  }, [\n    tokenExpiration,\n    openModal,\n    i18n,\n    setNewUser,\n    user,\n    redirectToInactivityRoute,\n  ]);\n\n  return (\n    <Context\n      value={{\n        fetchFullUser,\n        logOut,\n        permissions,\n        refreshCookie,\n        refreshCookieAsync,\n        refreshPermissions,\n        setPermissions,\n        setUser: setNewUser,\n        token: tokenInMemory,\n        user,\n      }}\n    >\n      {children}\n    </Context>\n  );\n}\n\nexport const useAuth = <T = ClientUser,>(): AuthContext<T> =>\n  use(Context) as AuthContext<T>;\n"],"mappings":"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","ignoreList":[]}