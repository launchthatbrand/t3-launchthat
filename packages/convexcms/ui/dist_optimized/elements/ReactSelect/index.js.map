{"version":3,"file":"index.js","names":["React","useEffect","useId","getTranslation","arrayMove","Select","CreatableSelect","useTranslation","DraggableSortable","ShimmerEffect","ClearIndicator","Control","DropdownIndicator","Input","generateMultiValueDraggableID","MultiValue","MultiValueLabel","MultiValueRemove","SingleValue","ValueContainer","createOption","label","value","SelectAdapter","props","i18n","t","inputValue","setInputValue","useState","uuid","hasMounted","setHasMounted","className","components","customProps","disabled","filterOption","undefined","getOptionValue","isClearable","isCreatable","isLoading","isSearchable","noOptionsMessage","numberOnly","onChange","onMenuClose","onMenuOpen","options","placeholder","showError","loadingMessage","classes","filter","Boolean","join","styles","menu","rsStyles","zIndex","_jsx","height","captureMenuScroll","classNamePrefix","instanceId","isDisabled","menuPlacement","unstyled","handleKeyDown","event","acceptableKeys","isNumber","test","key","isActionKey","includes","preventDefault","trim","onInputChange","newValue","onKeyDown","SortableSelect","draggableIDs","Array","isArray","map","optionValue","ids","onDragEnd","moveFromIndex","moveToIndex","sorted","ReactSelect","isMulti","isSortable"],"sources":["../../../src/elements/ReactSelect/index.tsx"],"sourcesContent":["\"use client\";\n\nimport type { KeyboardEventHandler } from \"react\";\nimport type { StylesConfig } from \"react-select\";\nimport React, { useEffect, useId } from \"react\";\nimport { getTranslation } from \"@convexcms/translations\";\nimport { arrayMove } from \"@dnd-kit/sortable\";\nimport Select from \"react-select\";\nimport CreatableSelect from \"react-select/creatable\";\n\nimport type { Option, ReactSelectAdapterProps } from \"./types.js\";\nimport { useTranslation } from \"../../providers/Translation/index.js\";\nimport { DraggableSortable } from \"../DraggableSortable/index.js\";\nimport { ShimmerEffect } from \"../ShimmerEffect/index.js\";\nimport { ClearIndicator } from \"./ClearIndicator/index.js\";\nimport { Control } from \"./Control/index.js\";\nimport { DropdownIndicator } from \"./DropdownIndicator/index.js\";\n\nimport \"./index.scss\";\n\nimport { Input } from \"./Input/index.js\";\nimport {\n  generateMultiValueDraggableID,\n  MultiValue,\n} from \"./MultiValue/index.js\";\nimport { MultiValueLabel } from \"./MultiValueLabel/index.js\";\nimport { MultiValueRemove } from \"./MultiValueRemove/index.js\";\nimport { SingleValue } from \"./SingleValue/index.js\";\nimport { ValueContainer } from \"./ValueContainer/index.js\";\n\nexport type { Option } from \"./types.js\";\n\nconst createOption = (label: string) => ({\n  label,\n  value: label,\n});\n\nconst SelectAdapter: React.FC<ReactSelectAdapterProps> = (props) => {\n  const { i18n, t } = useTranslation();\n  const [inputValue, setInputValue] = React.useState(\"\"); // for creatable select\n  const uuid = useId();\n  const [hasMounted, setHasMounted] = React.useState(false);\n\n  useEffect(() => {\n    setHasMounted(true);\n  }, []);\n\n  const {\n    className,\n    components,\n    customProps,\n    disabled = false,\n    filterOption = undefined,\n    getOptionValue,\n    isClearable = true,\n    isCreatable,\n    isLoading,\n    isSearchable = true,\n    noOptionsMessage = () => t(\"general:noOptions\"),\n    numberOnly = false,\n    onChange,\n    onMenuClose,\n    onMenuOpen,\n    options,\n    placeholder = t(\"general:selectValue\"),\n    showError,\n    value,\n  } = props;\n\n  const loadingMessage = () => t(\"general:loading\") + \"...\";\n\n  const classes = [\n    className,\n    \"react-select\",\n    showError && \"react-select--error\",\n  ]\n    .filter(Boolean)\n    .join(\" \");\n\n  const styles: StylesConfig<Option> = {\n    // Remove the default react-select z-index from the menu so that our custom\n    // z-index in the \"payload-default\" css layer can take effect, in such a way\n    // that end users can easily override it as with other styles.\n    menu: (rsStyles) => ({ ...rsStyles, zIndex: undefined }),\n  };\n\n  if (!hasMounted) {\n    return <ShimmerEffect height=\"calc(var(--base) * 2 + 2px)\" />;\n  }\n\n  if (!isCreatable) {\n    return (\n      <Select\n        captureMenuScroll\n        customProps={customProps}\n        isLoading={isLoading}\n        placeholder={getTranslation(placeholder, i18n)}\n        {...props}\n        className={classes}\n        classNamePrefix=\"rs\"\n        components={{\n          ClearIndicator,\n          Control,\n          DropdownIndicator,\n          Input,\n          MultiValue,\n          MultiValueLabel,\n          MultiValueRemove,\n          SingleValue,\n          ValueContainer,\n          ...components,\n        }}\n        filterOption={filterOption}\n        getOptionValue={getOptionValue}\n        instanceId={uuid}\n        isClearable={isClearable}\n        isDisabled={disabled}\n        isSearchable={isSearchable}\n        loadingMessage={loadingMessage}\n        menuPlacement=\"auto\"\n        noOptionsMessage={noOptionsMessage}\n        onChange={onChange}\n        onMenuClose={onMenuClose}\n        onMenuOpen={onMenuOpen}\n        options={options}\n        styles={styles}\n        unstyled={true}\n        value={value}\n      />\n    );\n  }\n  const handleKeyDown: KeyboardEventHandler = (event) => {\n    if (numberOnly === true) {\n      const acceptableKeys = [\n        \"Tab\",\n        \"Escape\",\n        \"Backspace\",\n        \"Enter\",\n        \"ArrowRight\",\n        \"ArrowLeft\",\n        \"ArrowUp\",\n        \"ArrowDown\",\n      ];\n      const isNumber = !/\\D/.test(event.key);\n      const isActionKey = acceptableKeys.includes(event.key);\n      if (!isNumber && !isActionKey) {\n        event.preventDefault();\n        return;\n      }\n    }\n    if (!value || !inputValue || inputValue.trim() === \"\") {\n      return;\n    }\n    if (filterOption && !filterOption(null, inputValue)) {\n      return;\n    }\n    switch (event.key) {\n      case \"Enter\":\n      case \"Tab\":\n        onChange([...(value as Option[]), createOption(inputValue)]);\n        setInputValue(\"\");\n        event.preventDefault();\n        break;\n      default:\n        break;\n    }\n  };\n\n  return (\n    <CreatableSelect\n      captureMenuScroll\n      isLoading={isLoading}\n      placeholder={getTranslation(placeholder, i18n)}\n      {...props}\n      className={classes}\n      classNamePrefix=\"rs\"\n      components={{\n        ClearIndicator,\n        Control,\n        DropdownIndicator,\n        Input,\n        MultiValue,\n        MultiValueLabel,\n        MultiValueRemove,\n        SingleValue,\n        ValueContainer,\n        ...components,\n      }}\n      filterOption={filterOption}\n      inputValue={inputValue}\n      instanceId={uuid}\n      isClearable={isClearable}\n      isDisabled={disabled}\n      isSearchable={isSearchable}\n      loadingMessage={loadingMessage}\n      menuPlacement=\"auto\"\n      noOptionsMessage={noOptionsMessage}\n      onChange={onChange}\n      onInputChange={(newValue) => setInputValue(newValue)}\n      onKeyDown={handleKeyDown}\n      onMenuClose={onMenuClose}\n      onMenuOpen={onMenuOpen}\n      options={options}\n      styles={styles}\n      unstyled={true}\n      value={value}\n    />\n  );\n};\n\nconst SortableSelect: React.FC<ReactSelectAdapterProps> = (props) => {\n  const { getOptionValue, onChange, value } = props;\n\n  let draggableIDs: string[] = [];\n  if (value) {\n    draggableIDs = (Array.isArray(value) ? value : [value]).map(\n      (optionValue) => {\n        return generateMultiValueDraggableID(optionValue, getOptionValue);\n      },\n    );\n  }\n\n  return (\n    <DraggableSortable\n      className=\"react-select-container\"\n      ids={draggableIDs}\n      onDragEnd={({ moveFromIndex, moveToIndex }) => {\n        let sorted = value;\n        if (value && Array.isArray(value)) {\n          sorted = arrayMove(value, moveFromIndex, moveToIndex);\n        }\n        onChange(sorted);\n      }}\n    >\n      <SelectAdapter {...props} />\n    </DraggableSortable>\n  );\n};\n\nexport const ReactSelect: React.FC<ReactSelectAdapterProps> = (props) => {\n  const { isMulti, isSortable } = props;\n\n  if (isMulti && isSortable) {\n    return <SortableSelect {...props} />;\n  }\n\n  return <SelectAdapter {...props} />;\n};\n"],"mappings":"AAAA;;;AAIA,OAAOA,KAAA,IAASC,SAAS,EAAEC,KAAK,QAAQ;AACxC,SAASC,cAAc,QAAQ;AAC/B,SAASC,SAAS,QAAQ;AAC1B,OAAOC,MAAA,MAAY;AACnB,OAAOC,eAAA,MAAqB;AAG5B,SAASC,cAAc,QAAQ;AAC/B,SAASC,iBAAiB,QAAQ;AAClC,SAASC,aAAa,QAAQ;AAC9B,SAASC,cAAc,QAAQ;AAC/B,SAASC,OAAO,QAAQ;AACxB,SAASC,iBAAiB,QAAQ;AAElC,OAAO;AAEP,SAASC,KAAK,QAAQ;AACtB,SACEC,6BAA6B,EAC7BC,UAAU,QACL;AACP,SAASC,eAAe,QAAQ;AAChC,SAASC,gBAAgB,QAAQ;AACjC,SAASC,WAAW,QAAQ;AAC5B,SAASC,cAAc,QAAQ;AAI/B,MAAMC,YAAA,GAAgBC,KAAA,KAAmB;EACvCA,KAAA;EACAC,KAAA,EAAOD;AACT;AAEA,MAAME,aAAA,GAAoDC,KAAA;EACxD,MAAM;IAAEC,IAAI;IAAEC;EAAC,CAAE,GAAGnB,cAAA;EACpB,MAAM,CAACoB,UAAA,EAAYC,aAAA,CAAc,GAAG5B,KAAA,CAAM6B,QAAQ,CAAC,KAAK;EACxD,MAAMC,IAAA,GAAO5B,KAAA;EACb,MAAM,CAAC6B,UAAA,EAAYC,aAAA,CAAc,GAAGhC,KAAA,CAAM6B,QAAQ,CAAC;EAEnD5B,SAAA,CAAU;IACR+B,aAAA,CAAc;EAChB,GAAG,EAAE;EAEL,MAAM;IACJC,SAAS;IACTC,UAAU;IACVC,WAAW;IACXC,QAAA,GAAW,KAAK;IAChBC,YAAA,GAAeC,SAAS;IACxBC,cAAc;IACdC,WAAA,GAAc,IAAI;IAClBC,WAAW;IACXC,SAAS;IACTC,YAAA,GAAe,IAAI;IACnBC,gBAAA,GAAmBA,CAAA,KAAMlB,CAAA,CAAE,oBAAoB;IAC/CmB,UAAA,GAAa,KAAK;IAClBC,QAAQ;IACRC,WAAW;IACXC,UAAU;IACVC,OAAO;IACPC,WAAA,GAAcxB,CAAA,CAAE,sBAAsB;IACtCyB,SAAS;IACT7B;EAAK,CACN,GAAGE,KAAA;EAEJ,MAAM4B,cAAA,GAAiBA,CAAA,KAAM1B,CAAA,CAAE,qBAAqB;EAEpD,MAAM2B,OAAA,GAAU,CACdpB,SAAA,EACA,gBACAkB,SAAA,IAAa,sBACd,CACEG,MAAM,CAACC,OAAA,EACPC,IAAI,CAAC;EAER,MAAMC,MAAA,GAA+B;IACnC;IACA;IACA;IACAC,IAAA,EAAOC,QAAA,KAAc;MAAE,GAAGA,QAAQ;MAAEC,MAAA,EAAQtB;IAAU;EACxD;EAEA,IAAI,CAACP,UAAA,EAAY;IACf,oBAAO8B,IAAA,CAACpD,aAAA;MAAcqD,MAAA,EAAO;;EAC/B;EAEA,IAAI,CAACrB,WAAA,EAAa;IAChB,oBACEoB,IAAA,CAACxD,MAAA;MACC0D,iBAAiB;MACjB5B,WAAA,EAAaA,WAAA;MACbO,SAAA,EAAWA,SAAA;MACXQ,WAAA,EAAa/C,cAAA,CAAe+C,WAAA,EAAazB,IAAA;MACxC,GAAGD,KAAK;MACTS,SAAA,EAAWoB,OAAA;MACXW,eAAA,EAAgB;MAChB9B,UAAA,EAAY;QACVxB,cAAA;QACAC,OAAA;QACAC,iBAAA;QACAC,KAAA;QACAE,UAAA;QACAC,eAAA;QACAC,gBAAA;QACAC,WAAA;QACAC,cAAA;QACA,GAAGe;MACL;MACAG,YAAA,EAAcA,YAAA;MACdE,cAAA,EAAgBA,cAAA;MAChB0B,UAAA,EAAYnC,IAAA;MACZU,WAAA,EAAaA,WAAA;MACb0B,UAAA,EAAY9B,QAAA;MACZO,YAAA,EAAcA,YAAA;MACdS,cAAA,EAAgBA,cAAA;MAChBe,aAAA,EAAc;MACdvB,gBAAA,EAAkBA,gBAAA;MAClBE,QAAA,EAAUA,QAAA;MACVC,WAAA,EAAaA,WAAA;MACbC,UAAA,EAAYA,UAAA;MACZC,OAAA,EAASA,OAAA;MACTQ,MAAA,EAAQA,MAAA;MACRW,QAAA,EAAU;MACV9C,KAAA,EAAOA;;EAGb;EACA,MAAM+C,aAAA,GAAuCC,KAAA;IAC3C,IAAIzB,UAAA,KAAe,MAAM;MACvB,MAAM0B,cAAA,GAAiB,CACrB,OACA,UACA,aACA,SACA,cACA,aACA,WACA,YACD;MACD,MAAMC,QAAA,GAAW,CAAC,KAAKC,IAAI,CAACH,KAAA,CAAMI,GAAG;MACrC,MAAMC,WAAA,GAAcJ,cAAA,CAAeK,QAAQ,CAACN,KAAA,CAAMI,GAAG;MACrD,IAAI,CAACF,QAAA,IAAY,CAACG,WAAA,EAAa;QAC7BL,KAAA,CAAMO,cAAc;QACpB;MACF;IACF;IACA,IAAI,CAACvD,KAAA,IAAS,CAACK,UAAA,IAAcA,UAAA,CAAWmD,IAAI,OAAO,IAAI;MACrD;IACF;IACA,IAAIzC,YAAA,IAAgB,CAACA,YAAA,CAAa,MAAMV,UAAA,GAAa;MACnD;IACF;IACA,QAAQ2C,KAAA,CAAMI,GAAG;MACf,KAAK;MACL,KAAK;QACH5B,QAAA,CAAS,C,GAAKxB,KAAA,EAAoBF,YAAA,CAAaO,UAAA,EAAY;QAC3DC,aAAA,CAAc;QACd0C,KAAA,CAAMO,cAAc;QACpB;MACF;QACE;IACJ;EACF;EAEA,oBACEhB,IAAA,CAACvD,eAAA;IACCyD,iBAAiB;IACjBrB,SAAA,EAAWA,SAAA;IACXQ,WAAA,EAAa/C,cAAA,CAAe+C,WAAA,EAAazB,IAAA;IACxC,GAAGD,KAAK;IACTS,SAAA,EAAWoB,OAAA;IACXW,eAAA,EAAgB;IAChB9B,UAAA,EAAY;MACVxB,cAAA;MACAC,OAAA;MACAC,iBAAA;MACAC,KAAA;MACAE,UAAA;MACAC,eAAA;MACAC,gBAAA;MACAC,WAAA;MACAC,cAAA;MACA,GAAGe;IACL;IACAG,YAAA,EAAcA,YAAA;IACdV,UAAA,EAAYA,UAAA;IACZsC,UAAA,EAAYnC,IAAA;IACZU,WAAA,EAAaA,WAAA;IACb0B,UAAA,EAAY9B,QAAA;IACZO,YAAA,EAAcA,YAAA;IACdS,cAAA,EAAgBA,cAAA;IAChBe,aAAA,EAAc;IACdvB,gBAAA,EAAkBA,gBAAA;IAClBE,QAAA,EAAUA,QAAA;IACViC,aAAA,EAAgBC,QAAA,IAAapD,aAAA,CAAcoD,QAAA;IAC3CC,SAAA,EAAWZ,aAAA;IACXtB,WAAA,EAAaA,WAAA;IACbC,UAAA,EAAYA,UAAA;IACZC,OAAA,EAASA,OAAA;IACTQ,MAAA,EAAQA,MAAA;IACRW,QAAA,EAAU;IACV9C,KAAA,EAAOA;;AAGb;AAEA,MAAM4D,cAAA,GAAqD1D,KAAA;EACzD,MAAM;IAAEe,cAAc;IAAEO,QAAQ;IAAExB;EAAK,CAAE,GAAGE,KAAA;EAE5C,IAAI2D,YAAA,GAAyB,EAAE;EAC/B,IAAI7D,KAAA,EAAO;IACT6D,YAAA,GAAe,CAACC,KAAA,CAAMC,OAAO,CAAC/D,KAAA,IAASA,KAAA,GAAQ,CAACA,KAAA,CAAM,EAAEgE,GAAG,CACxDC,WAAA;MACC,OAAOzE,6BAAA,CAA8ByE,WAAA,EAAahD,cAAA;IACpD;EAEJ;EAEA,oBACEsB,IAAA,CAACrD,iBAAA;IACCyB,SAAA,EAAU;IACVuD,GAAA,EAAKL,YAAA;IACLM,SAAA,EAAWA,CAAC;MAAEC,aAAa;MAAEC;IAAW,CAAE;MACxC,IAAIC,MAAA,GAAStE,KAAA;MACb,IAAIA,KAAA,IAAS8D,KAAA,CAAMC,OAAO,CAAC/D,KAAA,GAAQ;QACjCsE,MAAA,GAASxF,SAAA,CAAUkB,KAAA,EAAOoE,aAAA,EAAeC,WAAA;MAC3C;MACA7C,QAAA,CAAS8C,MAAA;IACX;cAEA,aAAA/B,IAAA,CAACtC,aAAA;MAAe,GAAGC;;;AAGzB;AAEA,OAAO,MAAMqE,WAAA,GAAkDrE,KAAA;EAC7D,MAAM;IAAEsE,OAAO;IAAEC;EAAU,CAAE,GAAGvE,KAAA;EAEhC,IAAIsE,OAAA,IAAWC,UAAA,EAAY;IACzB,oBAAOlC,IAAA,CAACqB,cAAA;MAAgB,GAAG1D;;EAC7B;EAEA,oBAAOqC,IAAA,CAACtC,aAAA;IAAe,GAAGC;;AAC5B","ignoreList":[]}