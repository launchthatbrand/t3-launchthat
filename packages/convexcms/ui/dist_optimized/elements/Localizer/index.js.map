{"version":3,"file":"index.js","names":["React","Fragment","useRouter","getTranslation","qs","useConfig","useLocale","useLocaleLoading","useRouteTransition","useTranslation","Popup","PopupList","LocalizerLabel","baseClass","Localizer","props","className","config","localization","router","startRouteTransition","setLocaleIsLoading","i18n","locale","locales","_jsx","filter","Boolean","join","button","horizontalAlign","render","close","ButtonGroup","map","localeOption","localeOptionLabel","label","Button","active","code","disabled","onClick","searchParams","URLSearchParams","window","location","search","url","stringify","parse","toString","depth","ignoreQueryPrefix","addQueryPrefix","push","_jsxs","showScrollbar","size"],"sources":["../../../src/elements/Localizer/index.tsx"],"sourcesContent":["\"use client\";\n\nimport \"./index.scss\";\n\nimport React, { Fragment } from \"react\";\nimport { useRouter } from \"next/navigation.js\";\nimport { getTranslation } from \"@convexcms/translations\";\nimport * as qs from \"qs-esm\";\n\nimport { useConfig } from \"../../providers/Config/index.js\";\nimport { useLocale, useLocaleLoading } from \"../../providers/Locale/index.js\";\nimport { useRouteTransition } from \"../../providers/RouteTransition/index.js\";\nimport { useTranslation } from \"../../providers/Translation/index.js\";\nimport { Popup, PopupList } from \"../Popup/index.js\";\nimport { LocalizerLabel } from \"./LocalizerLabel/index.js\";\n\nconst baseClass = \"localizer\";\n\nexport const Localizer: React.FC<{\n  className?: string;\n}> = (props) => {\n  const { className } = props;\n  const {\n    config: { localization },\n  } = useConfig();\n\n  const router = useRouter();\n  const { startRouteTransition } = useRouteTransition();\n\n  const { setLocaleIsLoading } = useLocaleLoading();\n\n  const { i18n } = useTranslation();\n  const locale = useLocale();\n\n  if (localization) {\n    const { locales } = localization;\n\n    return (\n      <div className={[baseClass, className].filter(Boolean).join(\" \")}>\n        <Popup\n          button={<LocalizerLabel />}\n          horizontalAlign=\"right\"\n          render={({ close }) => (\n            <PopupList.ButtonGroup>\n              {locales.map((localeOption) => {\n                const localeOptionLabel = getTranslation(\n                  localeOption.label,\n                  i18n,\n                );\n\n                return (\n                  <PopupList.Button\n                    active={locale.code === localeOption.code}\n                    disabled={locale.code === localeOption.code}\n                    key={localeOption.code}\n                    onClick={() => {\n                      setLocaleIsLoading(true);\n                      close();\n\n                      // can't use `useSearchParams` here because it is stale due to `window.history.pushState` in `ListQueryProvider`\n                      const searchParams = new URLSearchParams(\n                        window.location.search,\n                      );\n\n                      const url = qs.stringify(\n                        {\n                          ...qs.parse(searchParams.toString(), {\n                            depth: 10,\n                            ignoreQueryPrefix: true,\n                          }),\n                          locale: localeOption.code,\n                        },\n                        { addQueryPrefix: true },\n                      );\n\n                      startRouteTransition(() => {\n                        router.push(url);\n                      });\n                    }}\n                  >\n                    {localeOptionLabel !== localeOption.code ? (\n                      <Fragment>\n                        {localeOptionLabel}\n                        &nbsp;\n                        <span\n                          className={`${baseClass}__locale-code`}\n                          data-locale={localeOption.code}\n                        >\n                          {`(${localeOption.code})`}\n                        </span>\n                      </Fragment>\n                    ) : (\n                      <span\n                        className={`${baseClass}__locale-code`}\n                        data-locale={localeOption.code}\n                      >\n                        {localeOptionLabel}\n                      </span>\n                    )}\n                  </PopupList.Button>\n                );\n              })}\n            </PopupList.ButtonGroup>\n          )}\n          showScrollbar\n          size=\"large\"\n        />\n      </div>\n    );\n  }\n\n  return null;\n};\n"],"mappings":"AAAA;;;AAEA,OAAO;AAEP,OAAOA,KAAA,IAASC,QAAQ,QAAQ;AAChC,SAASC,SAAS,QAAQ;AAC1B,SAASC,cAAc,QAAQ;AAC/B,YAAYC,EAAA,MAAQ;AAEpB,SAASC,SAAS,QAAQ;AAC1B,SAASC,SAAS,EAAEC,gBAAgB,QAAQ;AAC5C,SAASC,kBAAkB,QAAQ;AACnC,SAASC,cAAc,QAAQ;AAC/B,SAASC,KAAK,EAAEC,SAAS,QAAQ;AACjC,SAASC,cAAc,QAAQ;AAE/B,MAAMC,SAAA,GAAY;AAElB,OAAO,MAAMC,SAAA,GAEPC,KAAA;EACJ,MAAM;IAAEC;EAAS,CAAE,GAAGD,KAAA;EACtB,MAAM;IACJE,MAAA,EAAQ;MAAEC;IAAY;EAAE,CACzB,GAAGb,SAAA;EAEJ,MAAMc,MAAA,GAASjB,SAAA;EACf,MAAM;IAAEkB;EAAoB,CAAE,GAAGZ,kBAAA;EAEjC,MAAM;IAAEa;EAAkB,CAAE,GAAGd,gBAAA;EAE/B,MAAM;IAAEe;EAAI,CAAE,GAAGb,cAAA;EACjB,MAAMc,MAAA,GAASjB,SAAA;EAEf,IAAIY,YAAA,EAAc;IAChB,MAAM;MAAEM;IAAO,CAAE,GAAGN,YAAA;IAEpB,oBACEO,IAAA,CAAC;MAAIT,SAAA,EAAW,CAACH,SAAA,EAAWG,SAAA,CAAU,CAACU,MAAM,CAACC,OAAA,EAASC,IAAI,CAAC;gBAC1D,aAAAH,IAAA,CAACf,KAAA;QACCmB,MAAA,eAAQJ,IAAA,CAACb,cAAA;QACTkB,eAAA,EAAgB;QAChBC,MAAA,EAAQA,CAAC;UAAEC;QAAK,CAAE,kBAChBP,IAAA,CAACd,SAAA,CAAUsB,WAAW;oBACnBT,OAAA,CAAQU,GAAG,CAAEC,YAAA;YACZ,MAAMC,iBAAA,GAAoBjC,cAAA,CACxBgC,YAAA,CAAaE,KAAK,EAClBf,IAAA;YAGF,oBACEG,IAAA,CAACd,SAAA,CAAU2B,MAAM;cACfC,MAAA,EAAQhB,MAAA,CAAOiB,IAAI,KAAKL,YAAA,CAAaK,IAAI;cACzCC,QAAA,EAAUlB,MAAA,CAAOiB,IAAI,KAAKL,YAAA,CAAaK,IAAI;cAE3CE,OAAA,EAASA,CAAA;gBACPrB,kBAAA,CAAmB;gBACnBW,KAAA;gBAEA;gBACA,MAAMW,YAAA,GAAe,IAAIC,eAAA,CACvBC,MAAA,CAAOC,QAAQ,CAACC,MAAM;gBAGxB,MAAMC,GAAA,GAAM5C,EAAA,CAAG6C,SAAS,CACtB;kBACE,GAAG7C,EAAA,CAAG8C,KAAK,CAACP,YAAA,CAAaQ,QAAQ,IAAI;oBACnCC,KAAA,EAAO;oBACPC,iBAAA,EAAmB;kBACrB,EAAE;kBACF9B,MAAA,EAAQY,YAAA,CAAaK;gBACvB,GACA;kBAAEc,cAAA,EAAgB;gBAAK;gBAGzBlC,oBAAA,CAAqB;kBACnBD,MAAA,CAAOoC,IAAI,CAACP,GAAA;gBACd;cACF;wBAECZ,iBAAA,KAAsBD,YAAA,CAAaK,IAAI,gBACtCgB,KAAA,CAACvD,QAAA;2BACEmC,iBAAA,EAAkB,K,aAEnBX,IAAA,CAAC;kBACCT,SAAA,EAAW,GAAGH,SAAA,eAAwB;kBACtC,eAAasB,YAAA,CAAaK,IAAI;4BAE7B,IAAIL,YAAA,CAAaK,IAAI;;gCAI1Bf,IAAA,CAAC;gBACCT,SAAA,EAAW,GAAGH,SAAA,eAAwB;gBACtC,eAAasB,YAAA,CAAaK,IAAI;0BAE7BJ;;eA1CAD,YAAA,CAAaK,IAAI;UA+C5B;;QAGJiB,aAAa;QACbC,IAAA,EAAK;;;EAIb;EAEA,OAAO;AACT","ignoreList":[]}