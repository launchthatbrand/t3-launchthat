{"version":3,"file":"index.js","names":["React","Fragment","useCallback","useEffect","useState","hoistQueryParamsToAnd","transformColumnsToPreferences","getTranslation","Button","Pill","useEffectEvent","ChevronIcon","PlusIcon","useAuth","useConfig","ListQueryProvider","useServerFunctions","TableColumnsProvider","useTranslation","AnimateHeight","ColumnSelector","useDocumentDrawer","Popup","PopupList","RelationshipProvider","DrawerLink","RelationshipTablePagination","baseClass","RelationshipTable","props","AfterInput","allowCreate","BeforeInput","disableTable","field","filterOptions","initialData","initialDataFromProps","initialDrawerData","Label","parent","relationTo","Table","setTable","config","getEntityConfig","permissions","docs","Array","isArray","reduce","acc","doc","id","i18n","t","query","setQuery","openColumnSelector","setOpenColumnSelector","collectionConfig","collectionSlug","selectedCollection","setSelectedCollection","undefined","isLoadingTable","setIsLoadingTable","data","setData","columnState","setColumnState","getTableState","renderTable","newQuery","limit","String","defaultLimit","admin","pagination","sort","defaultSort","where","defaultColumns","map","accessor","active","newData","state","newColumnState","NewTable","columns","enableRowSelections","orderableFieldName","orderable","collection","name","renderRowTypes","tableAppearance","handleTableRender","DocumentDrawer","DocumentDrawerToggler","closeDrawer","isDrawerOpen","openDrawer","onDrawerSave","args","foundDocIndex","findIndex","withNewOrUpdatedDoc","newDocs","onDrawerCreate","onDrawerDelete","filter","canCreate","collections","create","_jsxs","className","_jsx","button","buttonStyle","buttonType","horizontalAlign","render","close","closePopup","ButtonGroup","relatedCollection","onClick","find","each","slug","labels","singular","size","icon","direction","pillStyle","length","label","plural","modifySearchParams","onQueryChange","LinkedCellOverride","height","onSave"],"sources":["../../../src/elements/RelationshipTable/index.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { Fragment, useCallback, useEffect, useState } from \"react\";\nimport {\n  type CollectionSlug,\n  type Column,\n  type JoinFieldClient,\n  type ListQuery,\n  type PaginatedDocs,\n  type Where,\n} from \"@convexcms/core\";\nimport {\n  hoistQueryParamsToAnd,\n  transformColumnsToPreferences,\n} from \"@convexcms/core/shared\";\nimport { getTranslation } from \"@convexcms/translations\";\n\nimport type { DocumentDrawerProps } from \"../DocumentDrawer/types.js\";\nimport { Button } from \"../../elements/Button/index.js\";\nimport { Pill } from \"../../elements/Pill/index.js\";\nimport { useEffectEvent } from \"../../hooks/useEffectEvent.js\";\nimport { ChevronIcon } from \"../../icons/Chevron/index.js\";\nimport { PlusIcon } from \"../../icons/Plus/index.js\";\nimport { useAuth } from \"../../providers/Auth/index.js\";\nimport { useConfig } from \"../../providers/Config/index.js\";\nimport { ListQueryProvider } from \"../../providers/ListQuery/index.js\";\nimport { useServerFunctions } from \"../../providers/ServerFunctions/index.js\";\nimport { TableColumnsProvider } from \"../../providers/TableColumns/index.js\";\nimport { useTranslation } from \"../../providers/Translation/index.js\";\nimport { AnimateHeight } from \"../AnimateHeight/index.js\";\nimport { ColumnSelector } from \"../ColumnSelector/index.js\";\nimport { useDocumentDrawer } from \"../DocumentDrawer/index.js\";\nimport { Popup, PopupList } from \"../Popup/index.js\";\nimport { RelationshipProvider } from \"../Table/RelationshipProvider/index.js\";\nimport { DrawerLink } from \"./cells/DrawerLink/index.js\";\nimport { RelationshipTablePagination } from \"./Pagination.js\";\n\nimport \"./index.scss\";\n\nconst baseClass = \"relationship-table\";\n\ntype RelationshipTableComponentProps = {\n  readonly AfterInput?: React.ReactNode;\n  readonly allowCreate?: boolean;\n  readonly BeforeInput?: React.ReactNode;\n  readonly disableTable?: boolean;\n  readonly field: JoinFieldClient;\n  readonly filterOptions?: Where;\n  readonly initialData?: PaginatedDocs;\n  readonly initialDrawerData?: DocumentDrawerProps[\"initialData\"];\n  readonly Label?: React.ReactNode;\n  readonly parent?: {\n    collectionSlug: CollectionSlug;\n    id: number | string;\n    joinPath: string;\n  };\n  readonly relationTo: string | string[];\n};\n\nexport const RelationshipTable: React.FC<RelationshipTableComponentProps> = (\n  props,\n) => {\n  const {\n    AfterInput,\n    allowCreate = true,\n    BeforeInput,\n    disableTable = false,\n    field,\n    filterOptions,\n    initialData: initialDataFromProps,\n    initialDrawerData,\n    Label,\n    parent,\n    relationTo,\n  } = props;\n  const [Table, setTable] = useState<React.ReactNode>(null);\n  const { config, getEntityConfig } = useConfig();\n\n  const { permissions } = useAuth();\n\n  const [initialData] = useState<PaginatedDocs>(() => {\n    if (initialDataFromProps) {\n      return {\n        ...initialDataFromProps,\n        docs: Array.isArray(initialDataFromProps.docs)\n          ? initialDataFromProps.docs.reduce((acc, doc) => {\n              if (typeof doc === \"string\") {\n                return [\n                  ...acc,\n                  {\n                    id: doc,\n                  },\n                ];\n              }\n              return [...acc, doc];\n            }, [])\n          : [],\n      };\n    }\n  });\n\n  const { i18n, t } = useTranslation();\n\n  const [query, setQuery] = useState<ListQuery>();\n  const [openColumnSelector, setOpenColumnSelector] = useState(false);\n\n  const [collectionConfig] = useState(() =>\n    getEntityConfig({ collectionSlug: relationTo }),\n  );\n\n  const [selectedCollection, setSelectedCollection] = useState(\n    Array.isArray(relationTo) ? undefined : relationTo,\n  );\n  const [isLoadingTable, setIsLoadingTable] = useState(!disableTable);\n  const [data, setData] = useState<PaginatedDocs>(initialData);\n  const [columnState, setColumnState] = useState<Column[]>();\n\n  const { getTableState } = useServerFunctions();\n\n  const renderTable = useCallback(\n    async (docs?: PaginatedDocs[\"docs\"]) => {\n      const newQuery: ListQuery = {\n        limit: String(\n          field?.defaultLimit ||\n            collectionConfig?.admin?.pagination?.defaultLimit,\n        ),\n        sort: field.defaultSort || collectionConfig?.defaultSort,\n        ...(query || {}),\n        where: { ...(query?.where || {}) },\n      };\n\n      if (filterOptions) {\n        newQuery.where = hoistQueryParamsToAnd(newQuery.where, filterOptions);\n      }\n\n      // map columns from string[] to ListPreferences['columns']\n      const defaultColumns = field.admin.defaultColumns\n        ? field.admin.defaultColumns.map((accessor) => ({\n            accessor,\n            active: true,\n          }))\n        : undefined;\n\n      const {\n        data: newData,\n        state: newColumnState,\n        Table: NewTable,\n      } = await getTableState({\n        collectionSlug: relationTo,\n        columns:\n          transformColumnsToPreferences(query?.columns) || defaultColumns,\n        docs,\n        enableRowSelections: false,\n        orderableFieldName:\n          !field.orderable || Array.isArray(field.collection)\n            ? undefined\n            : `_${field.collection}_${field.name}_order`,\n        parent,\n        query: newQuery,\n        renderRowTypes: true,\n        tableAppearance: \"condensed\",\n      });\n\n      setData(newData);\n      setTable(NewTable);\n      setColumnState(newColumnState);\n      setIsLoadingTable(false);\n    },\n    [\n      field.defaultLimit,\n      field.defaultSort,\n      field.admin.defaultColumns,\n      field.collection,\n      field.name,\n      field.orderable,\n      collectionConfig?.admin?.pagination?.defaultLimit,\n      collectionConfig?.defaultSort,\n      query,\n      filterOptions,\n      getTableState,\n      relationTo,\n      parent,\n    ],\n  );\n\n  const handleTableRender = useEffectEvent(\n    (query: ListQuery, disableTable: boolean) => {\n      if (!disableTable && (!Table || query)) {\n        void renderTable();\n      }\n    },\n  );\n\n  useEffect(() => {\n    handleTableRender(query, disableTable);\n  }, [query, disableTable]);\n\n  const [\n    DocumentDrawer,\n    DocumentDrawerToggler,\n    { closeDrawer, isDrawerOpen, openDrawer },\n  ] = useDocumentDrawer({\n    collectionSlug: selectedCollection,\n  });\n\n  const onDrawerSave = useCallback<DocumentDrawerProps[\"onSave\"]>(\n    (args) => {\n      const foundDocIndex = data?.docs?.findIndex(\n        (doc) => doc.id === args.doc.id,\n      );\n      let withNewOrUpdatedDoc: PaginatedDocs[\"docs\"] = undefined;\n\n      if (foundDocIndex !== -1) {\n        const newDocs = [...data.docs];\n        newDocs[foundDocIndex] = args.doc;\n        withNewOrUpdatedDoc = newDocs;\n      } else {\n        withNewOrUpdatedDoc = [args.doc, ...data.docs];\n      }\n\n      void renderTable(withNewOrUpdatedDoc);\n    },\n    [data?.docs, renderTable],\n  );\n\n  const onDrawerCreate = useCallback<DocumentDrawerProps[\"onSave\"]>(\n    (args) => {\n      closeDrawer();\n\n      void onDrawerSave(args);\n    },\n    [closeDrawer, onDrawerSave],\n  );\n\n  const onDrawerDelete = useCallback<DocumentDrawerProps[\"onDelete\"]>(\n    (args) => {\n      const newDocs = data.docs.filter((doc) => doc.id !== args.id);\n      void renderTable(newDocs);\n    },\n    [data?.docs, renderTable],\n  );\n\n  const canCreate =\n    allowCreate !== false &&\n    permissions?.collections?.[\n      Array.isArray(relationTo) ? relationTo[0] : relationTo\n    ]?.create;\n\n  useEffect(() => {\n    if (Array.isArray(relationTo) && selectedCollection) {\n      openDrawer();\n    }\n  }, [selectedCollection, openDrawer, relationTo]);\n\n  useEffect(() => {\n    if (Array.isArray(relationTo) && !isDrawerOpen && selectedCollection) {\n      setSelectedCollection(undefined);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isDrawerOpen]);\n\n  return (\n    <div className={baseClass}>\n      <div className={`${baseClass}__header`}>\n        {Label}\n        <div className={`${baseClass}__actions`}>\n          {!Array.isArray(relationTo) && canCreate && (\n            <DocumentDrawerToggler className={`${baseClass}__add-new`}>\n              {i18n.t(\"fields:addNew\")}\n            </DocumentDrawerToggler>\n          )}\n\n          {Array.isArray(relationTo) && (\n            <Fragment>\n              <Popup\n                button={\n                  <Button\n                    buttonStyle=\"none\"\n                    className={`${baseClass}__add-new-polymorphic`}\n                  >\n                    {i18n.t(\"fields:addNew\")}\n                    <PlusIcon />\n                  </Button>\n                }\n                buttonType=\"custom\"\n                horizontalAlign=\"center\"\n                render={({ close: closePopup }) => (\n                  <PopupList.ButtonGroup>\n                    {relationTo.map((relatedCollection) => {\n                      if (permissions.collections[relatedCollection].create) {\n                        return (\n                          <PopupList.Button\n                            className={`${baseClass}__relation-button--${relatedCollection}`}\n                            key={relatedCollection}\n                            onClick={() => {\n                              closePopup();\n                              setSelectedCollection(relatedCollection);\n                            }}\n                          >\n                            {getTranslation(\n                              config.collections.find(\n                                (each) => each.slug === relatedCollection,\n                              ).labels.singular,\n                              i18n,\n                            )}\n                          </PopupList.Button>\n                        );\n                      }\n\n                      return null;\n                    })}\n                  </PopupList.ButtonGroup>\n                )}\n                size=\"medium\"\n              />\n            </Fragment>\n          )}\n          <Pill\n            aria-controls={`${baseClass}-columns`}\n            aria-expanded={openColumnSelector}\n            className={`${baseClass}__toggle-columns ${\n              openColumnSelector ? `${baseClass}__buttons-active` : \"\"\n            }`}\n            icon={\n              <ChevronIcon direction={openColumnSelector ? \"up\" : \"down\"} />\n            }\n            onClick={() => setOpenColumnSelector(!openColumnSelector)}\n            pillStyle=\"light\"\n          >\n            {t(\"general:columns\")}\n          </Pill>\n        </div>\n      </div>\n      {BeforeInput}\n      {isLoadingTable ? (\n        <p>{t(\"general:loading\")}</p>\n      ) : (\n        <Fragment>\n          {data?.docs && data.docs.length === 0 && (\n            <div className={`${baseClass}__no-results`}>\n              <p>\n                {i18n.t(\"general:noResults\", {\n                  label: Array.isArray(relationTo)\n                    ? i18n.t(\"general:documents\")\n                    : getTranslation(collectionConfig?.labels?.plural, i18n),\n                })}\n              </p>\n              {canCreate && (\n                <Button onClick={openDrawer}>\n                  {i18n.t(\"general:createNewLabel\", {\n                    label: getTranslation(\n                      collectionConfig?.labels?.singular,\n                      i18n,\n                    ),\n                  })}\n                </Button>\n              )}\n            </div>\n          )}\n          {data?.docs && data.docs.length > 0 && (\n            <RelationshipProvider>\n              <ListQueryProvider\n                columns={transformColumnsToPreferences(columnState)}\n                data={data}\n                defaultLimit={\n                  field.defaultLimit ??\n                  collectionConfig?.admin?.pagination?.defaultLimit\n                }\n                modifySearchParams={false}\n                onQueryChange={setQuery}\n                orderableFieldName={\n                  !field.orderable || Array.isArray(field.collection)\n                    ? undefined\n                    : `_${field.collection}_${field.name}_order`\n                }\n              >\n                <TableColumnsProvider\n                  collectionSlug={\n                    Array.isArray(relationTo) ? relationTo[0] : relationTo\n                  }\n                  columnState={columnState}\n                  LinkedCellOverride={\n                    <DrawerLink\n                      onDrawerDelete={onDrawerDelete}\n                      onDrawerSave={onDrawerSave}\n                    />\n                  }\n                >\n                  <AnimateHeight\n                    className={`${baseClass}__columns`}\n                    height={openColumnSelector ? \"auto\" : 0}\n                    id={`${baseClass}-columns`}\n                  >\n                    <div className={`${baseClass}__columns-inner`}>\n                      {collectionConfig && (\n                        <ColumnSelector\n                          collectionSlug={collectionConfig.slug}\n                        />\n                      )}\n                    </div>\n                  </AnimateHeight>\n                  {Table}\n                  <RelationshipTablePagination />\n                </TableColumnsProvider>\n              </ListQueryProvider>\n            </RelationshipProvider>\n          )}\n        </Fragment>\n      )}\n      {AfterInput}\n      <DocumentDrawer initialData={initialDrawerData} onSave={onDrawerCreate} />\n    </div>\n  );\n};\n"],"mappings":"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","ignoreList":[]}