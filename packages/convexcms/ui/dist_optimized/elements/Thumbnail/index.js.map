{"version":3,"file":"index.js","names":["React","File","ShimmerEffect","baseClass","Thumbnail","props","className","doc","filename","mimeType","fileSrc","imageCacheTag","size","fileExists","setFileExists","useState","undefined","classNames","join","useEffect","startsWith","img","Image","src","onload","onerror","queryChar","includes","encodeURIComponent","_jsxs","_jsx","height","alt","ThumbnailComponent"],"sources":["../../../src/elements/Thumbnail/index.tsx"],"sourcesContent":["\"use client\";\n\nimport \"./index.scss\";\n\nimport type { SanitizedCollectionConfig } from \"@convexcms/core\";\nimport React from \"react\";\n\nimport { File } from \"../../graphics/File/index.js\";\nimport { ShimmerEffect } from \"../ShimmerEffect/index.js\";\n\nconst baseClass = \"thumbnail\";\n\nexport type ThumbnailProps = {\n  className?: string;\n  collectionSlug?: string;\n  doc?: Record<string, unknown>;\n  fileSrc?: string;\n  imageCacheTag?: string;\n  size?: \"expand\" | \"large\" | \"medium\" | \"small\";\n  uploadConfig?: SanitizedCollectionConfig[\"upload\"];\n};\n\nexport const Thumbnail: React.FC<ThumbnailProps> = (props) => {\n  const {\n    className = \"\",\n    doc: { filename, mimeType } = {},\n    fileSrc,\n    imageCacheTag,\n    size,\n  } = props;\n  const [fileExists, setFileExists] = React.useState(undefined);\n\n  const classNames = [\n    baseClass,\n    `${baseClass}--size-${size || \"medium\"}`,\n    className,\n  ].join(\" \");\n\n  React.useEffect(() => {\n    if (\n      !fileSrc ||\n      (typeof mimeType === \"string\" && !mimeType.startsWith(\"image\"))\n    ) {\n      setFileExists(false);\n      return;\n    }\n    setFileExists(undefined);\n\n    const img = new Image();\n    img.src = fileSrc;\n    img.onload = () => {\n      setFileExists(true);\n    };\n    img.onerror = () => {\n      setFileExists(false);\n    };\n  }, [fileSrc, mimeType]);\n\n  let src: null | string = null;\n\n  /**\n   * If an imageCacheTag is provided, append it to the fileSrc\n   * Check if the fileSrc already has a query string, if it does, append the imageCacheTag with an ampersand\n   */\n  if (fileSrc) {\n    const queryChar = fileSrc?.includes(\"?\") ? \"&\" : \"?\";\n    src = imageCacheTag\n      ? `${fileSrc}${queryChar}${encodeURIComponent(imageCacheTag)}`\n      : fileSrc;\n  }\n\n  return (\n    <div className={classNames}>\n      {fileExists === undefined && <ShimmerEffect height=\"100%\" />}\n      {fileExists && <img alt={filename as string} src={src} />}\n      {fileExists === false && <File />}\n    </div>\n  );\n};\n\ntype ThumbnailComponentProps = {\n  readonly alt?: string;\n  readonly className?: string;\n  readonly filename: string;\n  readonly fileSrc: string;\n  readonly imageCacheTag?: string;\n  readonly size?: \"expand\" | \"large\" | \"medium\" | \"small\";\n};\nexport function ThumbnailComponent(props: ThumbnailComponentProps) {\n  const { alt, className = \"\", filename, fileSrc, imageCacheTag, size } = props;\n  const [fileExists, setFileExists] = React.useState(undefined);\n\n  const classNames = [\n    baseClass,\n    `${baseClass}--size-${size || \"medium\"}`,\n    className,\n  ].join(\" \");\n\n  React.useEffect(() => {\n    if (!fileSrc) {\n      setFileExists(false);\n      return;\n    }\n    setFileExists(undefined);\n\n    const img = new Image();\n    img.src = fileSrc;\n    img.onload = () => {\n      setFileExists(true);\n    };\n    img.onerror = () => {\n      setFileExists(false);\n    };\n  }, [fileSrc]);\n\n  let src: string = \"\";\n\n  /**\n   * If an imageCacheTag is provided, append it to the fileSrc\n   * Check if the fileSrc already has a query string, if it does, append the imageCacheTag with an ampersand\n   */\n  if (fileSrc) {\n    const queryChar = fileSrc?.includes(\"?\") ? \"&\" : \"?\";\n    src = imageCacheTag\n      ? `${fileSrc}${queryChar}${encodeURIComponent(imageCacheTag)}`\n      : fileSrc;\n  }\n\n  return (\n    <div className={classNames}>\n      {fileExists === undefined && <ShimmerEffect height=\"100%\" />}\n      {fileExists && <img alt={alt || filename} src={src} />}\n      {fileExists === false && <File />}\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]}