{"version":3,"file":"reduceFields.js","names":["fieldIsHiddenOrDisabled","fieldIsID","tabHasName","getTranslation","createNestedClientFieldPath","combineFieldLabel","fieldTypes","reduceFields","fields","i18n","labelPrefix","pathPrefix","reduce","reduced","field","type","tabs","forEach","tab","label","localizedTabLabel","labelWithPrefix","tabPathPrefix","name","push","translatedLabel","pathWithPrefix","operatorKeys","Set","operators","acc","operator","has","value","add","operatorKey","t","localizedLabel","formattedLabel","prefix","fieldPath","formattedField"],"sources":["../../../src/elements/WhereBuilder/reduceFields.tsx"],"sourcesContent":["\"use client\";\n\nimport type { ClientField } from \"@convexcms/core\";\nimport type {\n  ClientTranslationKeys,\n  I18nClient,\n} from \"@convexcms/translations\";\nimport {\n  fieldIsHiddenOrDisabled,\n  fieldIsID,\n  tabHasName,\n} from \"@convexcms/core/shared\";\nimport { getTranslation } from \"@convexcms/translations\";\n\nimport type { ReducedField } from \"./types.js\";\nimport { createNestedClientFieldPath } from \"../../forms/Form/createNestedClientFieldPath.js\";\nimport { combineFieldLabel } from \"../../utilities/combineFieldLabel.js\";\nimport fieldTypes from \"./field-types.js\";\n\ntype ReduceFieldOptionsArgs = {\n  fields: ClientField[];\n  i18n: I18nClient;\n  labelPrefix?: string;\n  pathPrefix?: string;\n};\n\n/**\n * Reduces a field map to a flat array of fields with labels and values.\n * Used in the WhereBuilder component to render the fields in the dropdown.\n */\nexport const reduceFields = ({\n  fields,\n  i18n,\n  labelPrefix,\n  pathPrefix,\n}: ReduceFieldOptionsArgs): ReducedField[] => {\n  return fields.reduce((reduced, field) => {\n    // Do not filter out `field.admin.disableListFilter` fields here, as these should still render as disabled if they appear in the URL query\n    if (fieldIsHiddenOrDisabled(field) && !fieldIsID(field)) {\n      return reduced;\n    }\n\n    if (field.type === \"tabs\" && \"tabs\" in field) {\n      const tabs = field.tabs;\n\n      tabs.forEach((tab) => {\n        if (typeof tab.label !== \"boolean\") {\n          const localizedTabLabel = getTranslation(tab.label, i18n);\n\n          const labelWithPrefix = labelPrefix\n            ? labelPrefix + \" > \" + localizedTabLabel\n            : localizedTabLabel;\n\n          // Make sure we handle nested tabs\n          const tabPathPrefix =\n            tabHasName(tab) && tab.name\n              ? pathPrefix\n                ? pathPrefix + \".\" + tab.name\n                : tab.name\n              : pathPrefix;\n\n          if (typeof localizedTabLabel === \"string\") {\n            reduced.push(\n              ...reduceFields({\n                fields: tab.fields,\n                i18n,\n                labelPrefix: labelWithPrefix,\n                pathPrefix: tabPathPrefix,\n              }),\n            );\n          }\n        }\n      });\n      return reduced;\n    }\n\n    // Rows cant have labels, so we need to handle them differently\n    if (field.type === \"row\" && \"fields\" in field) {\n      reduced.push(\n        ...reduceFields({\n          fields: field.fields,\n          i18n,\n          labelPrefix,\n          pathPrefix,\n        }),\n      );\n      return reduced;\n    }\n\n    if (field.type === \"collapsible\" && \"fields\" in field) {\n      const localizedTabLabel = getTranslation(field.label || \"\", i18n);\n\n      const labelWithPrefix = labelPrefix\n        ? labelPrefix + \" > \" + localizedTabLabel\n        : localizedTabLabel;\n\n      reduced.push(\n        ...reduceFields({\n          fields: field.fields,\n          i18n,\n          labelPrefix: labelWithPrefix,\n          pathPrefix,\n        }),\n      );\n      return reduced;\n    }\n\n    if (field.type === \"group\" && \"fields\" in field) {\n      const translatedLabel = getTranslation(field.label || \"\", i18n);\n\n      const labelWithPrefix = labelPrefix\n        ? translatedLabel\n          ? labelPrefix + \" > \" + translatedLabel\n          : labelPrefix\n        : translatedLabel;\n\n      // Make sure we handle deeply nested groups\n      const pathWithPrefix = field.name\n        ? pathPrefix\n          ? pathPrefix + \".\" + field.name\n          : field.name\n        : pathPrefix;\n\n      reduced.push(\n        ...reduceFields({\n          fields: field.fields,\n          i18n,\n          labelPrefix: labelWithPrefix,\n          pathPrefix: pathWithPrefix,\n        }),\n      );\n\n      return reduced;\n    }\n\n    if (typeof fieldTypes[field.type] === \"object\") {\n      const operatorKeys = new Set();\n\n      const operators = fieldTypes[field.type].operators.reduce(\n        (acc, operator) => {\n          if (!operatorKeys.has(operator.value)) {\n            operatorKeys.add(operator.value);\n            const operatorKey =\n              `operators:${operator.label}` as ClientTranslationKeys;\n            acc.push({\n              ...operator,\n              label: i18n.t(operatorKey),\n            });\n          }\n\n          return acc;\n        },\n        [],\n      );\n\n      const localizedLabel = getTranslation(field.label || \"\", i18n);\n\n      const formattedLabel = labelPrefix\n        ? combineFieldLabel({\n            field,\n            prefix: labelPrefix,\n          })\n        : localizedLabel;\n\n      const fieldPath = pathPrefix\n        ? createNestedClientFieldPath(pathPrefix, field)\n        : field.name;\n\n      const formattedField: ReducedField = {\n        label: formattedLabel,\n        value: fieldPath,\n        ...fieldTypes[field.type],\n        field,\n        operators,\n      };\n\n      reduced.push(formattedField);\n      return reduced;\n    }\n    return reduced;\n  }, []);\n};\n"],"mappings":"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","ignoreList":[]}