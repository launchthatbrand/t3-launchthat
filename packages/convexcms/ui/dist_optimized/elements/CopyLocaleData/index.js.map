{"version":3,"file":"index.js","names":["React","useCallback","useRouter","getTranslation","useModal","toast","CheckboxField","SelectInput","useFormModified","useConfig","useDocumentInfo","useLocale","useRouteTransition","useServerFunctions","useTranslation","DrawerHeader","Button","Drawer","PopupList","baseClass","drawerSlug","CopyLocaleData","config","localization","routes","admin","serverURL","code","id","collectionSlug","globalSlug","i18n","t","modified","toggleModal","copyDataFromLocale","router","startRouteTransition","localeOptions","locales","map","locale","label","value","localeOptionsWithoutCurrent","filter","getLocaleLabel","find","l","copying","setCopying","useState","toLocale","setToLocale","fromLocale","setFromLocale","overwriteExisting","setOverwriteExisting","useEffect","copyLocaleData","from","to","docID","overrideData","push","error","message","_jsxs","Fragment","_jsx","onClick","info","className","gutter","Header","onClose","title","slug","buttonStyle","disabled","iconPosition","size","name","onChange","selectedOption","options","path","readOnly","checked","field"],"sources":["../../../src/elements/CopyLocaleData/index.tsx"],"sourcesContent":["\"use client\";\n\nimport \"./index.scss\";\n\nimport React, { useCallback } from \"react\";\nimport { useRouter } from \"next/navigation.js\";\nimport { getTranslation } from \"@convexcms/translations\";\nimport { useModal } from \"@faceless-ui/modal\";\nimport { toast } from \"sonner\";\n\nimport { CheckboxField } from \"../../fields/Checkbox/index.js\";\nimport { SelectInput } from \"../../fields/Select/index.js\";\nimport { useFormModified } from \"../../forms/Form/context.js\";\nimport { useConfig } from \"../../providers/Config/index.js\";\nimport { useDocumentInfo } from \"../../providers/DocumentInfo/index.js\";\nimport { useLocale } from \"../../providers/Locale/index.js\";\nimport { useRouteTransition } from \"../../providers/RouteTransition/index.js\";\nimport { useServerFunctions } from \"../../providers/ServerFunctions/index.js\";\nimport { useTranslation } from \"../../providers/Translation/index.js\";\nimport { DrawerHeader } from \"../BulkUpload/Header/index.js\";\nimport { Button } from \"../Button/index.js\";\nimport { Drawer } from \"../Drawer/index.js\";\nimport { PopupList } from \"../Popup/index.js\";\n\nconst baseClass = \"copy-locale-data\";\n\nconst drawerSlug = \"copy-locale\";\nexport const CopyLocaleData: React.FC = () => {\n  const {\n    config: {\n      localization,\n      routes: { admin },\n      serverURL,\n    },\n  } = useConfig();\n  const { code } = useLocale();\n  const { id, collectionSlug, globalSlug } = useDocumentInfo();\n  const { i18n, t } = useTranslation();\n  const modified = useFormModified();\n  const { toggleModal } = useModal();\n  const { copyDataFromLocale } = useServerFunctions();\n  const router = useRouter();\n  const { startRouteTransition } = useRouteTransition();\n\n  const localeOptions =\n    (localization &&\n      localization.locales.map((locale) => ({\n        label: locale.label,\n        value: locale.code,\n      }))) ||\n    [];\n\n  const localeOptionsWithoutCurrent = localeOptions.filter(\n    (locale) => locale.value !== code,\n  );\n\n  const getLocaleLabel = (code: string) => {\n    const locale =\n      localization && localization.locales.find((l) => l.code === code);\n    return locale && locale.label ? getTranslation(locale.label, i18n) : code;\n  };\n\n  const [copying, setCopying] = React.useState(false);\n  const [toLocale, setToLocale] = React.useState<null | string>(null);\n  const [fromLocale, setFromLocale] = React.useState<null | string>(code);\n  const [overwriteExisting, setOverwriteExisting] = React.useState(false);\n\n  React.useEffect(() => {\n    if (fromLocale !== code) {\n      setFromLocale(code);\n    }\n  }, [code, fromLocale]);\n\n  const copyLocaleData = useCallback(\n    async ({ from, to }) => {\n      setCopying(true);\n\n      try {\n        await copyDataFromLocale({\n          collectionSlug,\n          docID: id,\n          fromLocale: from,\n          globalSlug,\n          overrideData: overwriteExisting,\n          toLocale: to,\n        });\n\n        setCopying(false);\n\n        startRouteTransition(() =>\n          router.push(\n            `${serverURL}${admin}/${collectionSlug ? `collections/${collectionSlug}/${id}` : `globals/${globalSlug}`}?locale=${to}`,\n          ),\n        );\n\n        toggleModal(drawerSlug);\n      } catch (error) {\n        toast.error(error.message);\n      }\n    },\n    [\n      copyDataFromLocale,\n      collectionSlug,\n      id,\n      globalSlug,\n      overwriteExisting,\n      toggleModal,\n      router,\n      serverURL,\n      admin,\n      startRouteTransition,\n    ],\n  );\n\n  if (!id && !globalSlug) {\n    return null;\n  }\n\n  return (\n    <React.Fragment>\n      <PopupList.Button\n        id={`${baseClass}__button`}\n        onClick={() => {\n          if (modified) {\n            toast.info(t(\"general:unsavedChanges\"));\n          } else {\n            toggleModal(drawerSlug);\n          }\n        }}\n      >\n        {t(\"localization:copyToLocale\")}\n      </PopupList.Button>\n      <Drawer\n        className={baseClass}\n        gutter={false}\n        Header={\n          <DrawerHeader\n            onClose={() => {\n              toggleModal(drawerSlug);\n            }}\n            title={t(\"localization:copyToLocale\")}\n          />\n        }\n        slug={drawerSlug}\n      >\n        <div className={`${baseClass}__sub-header`}>\n          <span>\n            {fromLocale && toLocale ? (\n              <div>\n                {t(\"localization:copyFromTo\", {\n                  from: getLocaleLabel(fromLocale),\n                  to: getLocaleLabel(toLocale),\n                })}\n              </div>\n            ) : (\n              t(\"localization:selectLocaleToCopy\")\n            )}\n          </span>\n          <Button\n            buttonStyle=\"primary\"\n            disabled={!fromLocale || !toLocale}\n            iconPosition=\"left\"\n            onClick={async () => {\n              if (fromLocale === toLocale) {\n                toast.error(t(\"localization:cannotCopySameLocale\"));\n                return;\n              }\n              if (!copying) {\n                await copyLocaleData({\n                  from: fromLocale,\n                  to: toLocale,\n                });\n              }\n            }}\n            size=\"medium\"\n          >\n            {copying ? t(\"general:copying\") + \"...\" : t(\"general:copy\")}\n          </Button>\n        </div>\n\n        <div className={`${baseClass}__content`}>\n          <SelectInput\n            label={t(\"localization:copyFrom\")}\n            name={\"fromLocale\"}\n            onChange={(selectedOption: { value: string }) => {\n              if (selectedOption?.value) {\n                setFromLocale(selectedOption.value);\n              }\n            }}\n            options={localeOptions}\n            path=\"fromLocale\"\n            readOnly\n            value={fromLocale}\n          />\n          <SelectInput\n            label={t(\"localization:copyTo\")}\n            name=\"toLocale\"\n            onChange={(selectedOption: { value: string }) => {\n              if (selectedOption?.value) {\n                setToLocale(selectedOption.value);\n              }\n            }}\n            options={localeOptionsWithoutCurrent}\n            path=\"toLocale\"\n            value={toLocale}\n          />\n          <CheckboxField\n            checked={overwriteExisting}\n            field={{\n              name: \"overwriteExisting\",\n              label: t(\"general:overwriteExistingData\"),\n            }}\n            onChange={() => setOverwriteExisting(!overwriteExisting)}\n            path={\"overwriteExisting\"}\n          />\n        </div>\n      </Drawer>\n    </React.Fragment>\n  );\n};\n"],"mappings":"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","ignoreList":[]}