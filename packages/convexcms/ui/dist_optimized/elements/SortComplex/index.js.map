{"version":3,"file":"index.js","names":["React","useEffect","useState","usePathname","useRouter","useSearchParams","sortableFieldTypes","fieldAffectsData","getTranslation","qs","useTranslation","ReactSelect","baseClass","SortComplex","props","collection","handleChange","modifySearchQuery","router","pathname","searchParams","i18n","t","sortOptions","setSortOptions","sortFields","fields","reduce","field","indexOf","type","label","name","value","sortField","setSortField","initialSort","sortOrder","setSortOrder","newSortValue","get","search","stringify","sort","addQueryPrefix","replace","_jsx","className","Fragment","_jsxs","onChange","options","incomingSort"],"sources":["../../../src/elements/SortComplex/index.tsx"],"sourcesContent":["\"use client\";\n\nimport \"./index.scss\";\n\nimport type { OptionObject, SanitizedCollectionConfig } from \"@convexcms/core\";\nimport React, { useEffect, useState } from \"react\";\n// TODO: abstract the `next/navigation` dependency out from this component\nimport { usePathname, useRouter, useSearchParams } from \"next/navigation.js\";\nimport { sortableFieldTypes } from \"@convexcms/core\";\nimport { fieldAffectsData } from \"@convexcms/core/shared\";\nimport { getTranslation } from \"@convexcms/translations\";\nimport * as qs from \"qs-esm\";\n\nimport type { Option } from \"../ReactSelect/index.js\";\nimport { useTranslation } from \"../../providers/Translation/index.js\";\nimport { ReactSelect } from \"../ReactSelect/index.js\";\n\nexport type SortComplexProps = {\n  collection: SanitizedCollectionConfig;\n  handleChange?: (sort: string) => void;\n  modifySearchQuery?: boolean;\n  sort?: string;\n};\n\nconst baseClass = \"sort-complex\";\n\nexport const SortComplex: React.FC<SortComplexProps> = (props) => {\n  const { collection, handleChange, modifySearchQuery = true } = props;\n\n  const router = useRouter();\n  const pathname = usePathname();\n  const searchParams = useSearchParams();\n  const { i18n, t } = useTranslation();\n  const [sortOptions, setSortOptions] = useState<OptionObject[]>();\n\n  const [sortFields] = useState(() =>\n    collection.fields.reduce((fields, field) => {\n      if (\n        fieldAffectsData(field) &&\n        sortableFieldTypes.indexOf(field.type) > -1\n      ) {\n        return [\n          ...fields,\n          {\n            label: getTranslation(field.label || field.name, i18n),\n            value: field.name,\n          },\n        ];\n      }\n      return fields;\n    }, []),\n  );\n\n  const [sortField, setSortField] = useState(sortFields[0]);\n  const [initialSort] = useState<Option>(() => ({\n    label: t(\"general:descending\"),\n    value: \"-\",\n  }));\n  const [sortOrder, setSortOrder] = useState(initialSort);\n\n  useEffect(() => {\n    if (sortField?.value) {\n      const newSortValue = `${sortOrder.value}${sortField.value}`;\n\n      if (handleChange) {\n        handleChange(newSortValue);\n      }\n\n      if (searchParams.get(\"sort\") !== newSortValue && modifySearchQuery) {\n        const search = qs.stringify(\n          {\n            ...searchParams,\n            sort: newSortValue,\n          },\n          { addQueryPrefix: true },\n        );\n\n        router.replace(`${pathname}${search}`);\n      }\n    }\n  }, [\n    pathname,\n    router,\n    searchParams,\n    sortField,\n    sortOrder,\n    modifySearchQuery,\n    handleChange,\n  ]);\n\n  useEffect(() => {\n    setSortOptions([\n      { label: t(\"general:ascending\"), value: \"\" },\n      { label: t(\"general:descending\"), value: \"-\" },\n    ]);\n  }, [i18n, t]);\n\n  return (\n    <div className={baseClass}>\n      <React.Fragment>\n        <div className={`${baseClass}__wrap`}>\n          <div className={`${baseClass}__select`}>\n            <div className={`${baseClass}__label`}>\n              {t(\"general:columnToSort\")}\n            </div>\n            <ReactSelect\n              onChange={setSortField}\n              options={sortFields}\n              value={sortField}\n            />\n          </div>\n          <div className={`${baseClass}__select`}>\n            <div className={`${baseClass}__label`}>{t(\"general:order\")}</div>\n            <ReactSelect\n              onChange={(incomingSort: Option) => {\n                setSortOrder(incomingSort || initialSort);\n              }}\n              options={sortOptions}\n              value={sortOrder}\n            />\n          </div>\n        </div>\n      </React.Fragment>\n    </div>\n  );\n};\n"],"mappings":"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","ignoreList":[]}