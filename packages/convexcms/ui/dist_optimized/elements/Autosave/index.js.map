{"version":3,"file":"index.js","names":["React","useDeferredValue","useEffect","useRef","useState","reduceFieldsToValues","versionDefaults","dequal","toast","useAllFormFields","useForm","useFormModified","useFormSubmitted","useDebounce","useEffectEvent","useQueues","useConfig","useDocumentEvents","useDocumentInfo","useLocale","useTranslation","formatTimeToNow","reduceFieldsToValuesWithValidation","LeaveWithoutSaving","baseClass","minimumAnimationTime","Autosave","id","collection","global","globalDoc","config","routes","api","serverURL","docConfig","incrementVersionCount","lastUpdateTime","mostRecentVersionIsAutosaved","setLastUpdateTime","setMostRecentVersionIsAutosaved","setUnpublishedVersionCount","updateSavedDocumentData","reportUpdate","dispatchFields","isValid","setBackgroundProcessing","setIsValid","setSubmitted","fields","modified","submitted","code","locale","i18n","t","versionsConfig","versions","interval","autosaveInterval","drafts","autosave","validateOnDraft","Boolean","validate","_saving","setSaving","saving","debouncedFields","fieldRef","modifiedRef","localeRef","isValidRef","current","queueTask","autosaveTimeoutRef","handleAutosave","undefined","startTimestamp","endTimestamp","hideIndicator","setTimeout","stopAutoSaveIndicator","Date","getTime","url","method","entitySlug","slug","data","valid","_status","skipSubmission","res","fetch","body","JSON","stringify","credentials","headers","language","_err","newDate","status","updatedAt","toISOString","prev","json","errors","Array","isArray","fieldErrors","nonFieldErrors","reduce","fieldErrs","nonFieldErrs","err","newFieldErrs","newNonFieldErrs","message","push","forEach","dataError","field","type","error","document","doc","result","afterProcess","beforeProcess","didMount","previousDebouncedFieldValues","debouncedFieldValues","clearTimeout","_jsxs","className","_jsx","Fragment","distance","date"],"sources":["../../../src/elements/Autosave/index.tsx"],"sourcesContent":["\"use client\";\n\nimport \"./index.scss\";\n\n// TODO: abstract the `next/navigation` dependency out from this component\nimport type {\n  ClientCollectionConfig,\n  ClientGlobalConfig,\n} from \"@convexcms/core\";\nimport React, { useDeferredValue, useEffect, useRef, useState } from \"react\";\nimport { reduceFieldsToValues, versionDefaults } from \"@convexcms/core/shared\";\nimport { dequal } from \"dequal/lite\";\nimport { toast } from \"sonner\";\n\nimport {\n  useAllFormFields,\n  useForm,\n  useFormModified,\n  useFormSubmitted,\n} from \"../../forms/Form/context.js\";\nimport { useDebounce } from \"../../hooks/useDebounce.js\";\nimport { useEffectEvent } from \"../../hooks/useEffectEvent.js\";\nimport { useQueues } from \"../../hooks/useQueues.js\";\nimport { useConfig } from \"../../providers/Config/index.js\";\nimport { useDocumentEvents } from \"../../providers/DocumentEvents/index.js\";\nimport { useDocumentInfo } from \"../../providers/DocumentInfo/index.js\";\nimport { useLocale } from \"../../providers/Locale/index.js\";\nimport { useTranslation } from \"../../providers/Translation/index.js\";\nimport { formatTimeToNow } from \"../../utilities/formatDocTitle/formatDateTitle.js\";\nimport { reduceFieldsToValuesWithValidation } from \"../../utilities/reduceFieldsToValuesWithValidation.js\";\nimport { LeaveWithoutSaving } from \"../LeaveWithoutSaving/index.js\";\n\nconst baseClass = \"autosave\";\n// The minimum time the saving state should be shown\nconst minimumAnimationTime = 1000;\n\nexport type Props = {\n  collection?: ClientCollectionConfig;\n  global?: ClientGlobalConfig;\n  id?: number | string;\n  publishedDocUpdatedAt: string;\n};\n\nexport const Autosave: React.FC<Props> = ({\n  id,\n  collection,\n  global: globalDoc,\n}) => {\n  const {\n    config: {\n      routes: { api },\n      serverURL,\n    },\n  } = useConfig();\n  const {\n    docConfig,\n    incrementVersionCount,\n    lastUpdateTime,\n    mostRecentVersionIsAutosaved,\n    setLastUpdateTime,\n    setMostRecentVersionIsAutosaved,\n    setUnpublishedVersionCount,\n    updateSavedDocumentData,\n  } = useDocumentInfo();\n\n  const { reportUpdate } = useDocumentEvents();\n  const {\n    dispatchFields,\n    isValid,\n    setBackgroundProcessing,\n    setIsValid,\n    setSubmitted,\n  } = useForm();\n\n  const [fields] = useAllFormFields();\n  const modified = useFormModified();\n  const submitted = useFormSubmitted();\n\n  const { code: locale } = useLocale();\n  const { i18n, t } = useTranslation();\n\n  const versionsConfig = docConfig?.versions;\n  let interval = versionDefaults.autosaveInterval;\n\n  if (versionsConfig.drafts && versionsConfig.drafts.autosave) {\n    interval = versionsConfig.drafts.autosave.interval;\n  }\n\n  const validateOnDraft = Boolean(\n    docConfig?.versions?.drafts && docConfig?.versions?.drafts.validate,\n  );\n\n  const [_saving, setSaving] = useState(false);\n  const saving = useDeferredValue(_saving);\n  const debouncedFields = useDebounce(fields, interval);\n  const fieldRef = useRef(fields);\n  const modifiedRef = useRef(modified);\n  const localeRef = useRef(locale);\n  /**\n   * Track the validation internally so Autosave can determine when to run queue processing again\n   * Helps us prevent infinite loops when the queue is processing and the form is invalid\n   */\n  const isValidRef = useRef(isValid);\n\n  // Store fields in ref so the autosave func\n  // can always retrieve the most to date copies\n  // after the timeout has executed\n  fieldRef.current = fields;\n\n  // Store modified in ref so the autosave func\n  // can bail out if modified becomes false while\n  // timing out during autosave\n  modifiedRef.current = modified;\n\n  // Store locale in ref so the autosave func\n  // can always retrieve the most to date locale\n  localeRef.current = locale;\n\n  const { queueTask } = useQueues();\n\n  const autosaveTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n\n  const handleAutosave = useEffectEvent(() => {\n    autosaveTimeoutRef.current = undefined;\n    // We need to log the time in order to figure out if we need to trigger the state off later\n    let startTimestamp = undefined;\n    let endTimestamp = undefined;\n\n    const hideIndicator = () => {\n      // If request was faster than minimum animation time, animate the difference\n      if (endTimestamp - startTimestamp < minimumAnimationTime) {\n        autosaveTimeoutRef.current = setTimeout(\n          () => {\n            setSaving(false);\n          },\n          minimumAnimationTime - (endTimestamp - startTimestamp),\n        );\n      } else {\n        stopAutoSaveIndicator();\n      }\n    };\n\n    queueTask(\n      async () => {\n        if (modified) {\n          startTimestamp = new Date().getTime();\n\n          setSaving(true);\n\n          let url: string;\n          let method: string;\n          let entitySlug: string;\n\n          if (collection && id) {\n            entitySlug = collection.slug;\n            url = `${serverURL}${api}/${entitySlug}/${id}?draft=true&autosave=true&locale=${localeRef.current}`;\n            method = \"PATCH\";\n          }\n\n          if (globalDoc) {\n            entitySlug = globalDoc.slug;\n            url = `${serverURL}${api}/globals/${entitySlug}?draft=true&autosave=true&locale=${localeRef.current}`;\n            method = \"POST\";\n          }\n\n          if (url) {\n            if (modifiedRef.current) {\n              const { data, valid } = reduceFieldsToValuesWithValidation(\n                fieldRef.current,\n                true,\n              );\n\n              data._status = \"draft\";\n\n              const skipSubmission =\n                submitted &&\n                !valid &&\n                versionsConfig?.drafts &&\n                versionsConfig?.drafts?.validate;\n\n              if (!skipSubmission && isValidRef.current) {\n                let res;\n\n                try {\n                  res = await fetch(url, {\n                    body: JSON.stringify(data),\n                    credentials: \"include\",\n                    headers: {\n                      \"Accept-Language\": i18n.language,\n                      \"Content-Type\": \"application/json\",\n                    },\n                    method,\n                  });\n                } catch (_err) {\n                  // Swallow Error\n                }\n\n                const newDate = new Date();\n                // We need to log the time in order to figure out if we need to trigger the state off later\n                endTimestamp = newDate.getTime();\n\n                if (res.status === 200) {\n                  setLastUpdateTime(newDate.getTime());\n\n                  reportUpdate({\n                    id,\n                    entitySlug,\n                    updatedAt: newDate.toISOString(),\n                  });\n\n                  if (!mostRecentVersionIsAutosaved) {\n                    incrementVersionCount();\n                    setMostRecentVersionIsAutosaved(true);\n                    setUnpublishedVersionCount((prev) => prev + 1);\n                  }\n                }\n                const json = await res.json();\n\n                if (\n                  versionsConfig?.drafts &&\n                  versionsConfig?.drafts?.validate &&\n                  json?.errors\n                ) {\n                  if (Array.isArray(json.errors)) {\n                    const [fieldErrors, nonFieldErrors] = json.errors.reduce(\n                      ([fieldErrs, nonFieldErrs], err) => {\n                        const newFieldErrs = [];\n                        const newNonFieldErrs = [];\n\n                        if (err?.message) {\n                          newNonFieldErrs.push(err);\n                        }\n\n                        if (Array.isArray(err?.data)) {\n                          err.data.forEach((dataError) => {\n                            if (dataError?.field) {\n                              newFieldErrs.push(dataError);\n                            } else {\n                              newNonFieldErrs.push(dataError);\n                            }\n                          });\n                        }\n\n                        return [\n                          [...fieldErrs, ...newFieldErrs],\n                          [...nonFieldErrs, ...newNonFieldErrs],\n                        ];\n                      },\n                      [[], []],\n                    );\n\n                    dispatchFields({\n                      type: \"ADD_SERVER_ERRORS\",\n                      errors: fieldErrors,\n                    });\n\n                    nonFieldErrors.forEach((err) => {\n                      toast.error(err.message || i18n.t(\"error:unknown\"));\n                    });\n\n                    // Set valid to false internally so the queue doesn't process\n                    isValidRef.current = false;\n                    setIsValid(false);\n                    setSubmitted(true);\n                    hideIndicator();\n                    return;\n                  }\n                } else {\n                  // If it's not an error then we can update the document data inside the context\n                  const document = json?.doc || json?.result;\n\n                  // Manually update the data since this function doesn't fire the `submit` function from useForm\n                  if (document) {\n                    setIsValid(true);\n\n                    // Reset internal state allowing the queue to process\n                    isValidRef.current = true;\n                    updateSavedDocumentData(document);\n                  }\n                }\n\n                hideIndicator();\n              }\n            }\n          }\n        }\n      },\n      {\n        afterProcess: () => {\n          setBackgroundProcessing(false);\n        },\n        beforeProcess: () => {\n          if (!isValidRef.current) {\n            isValidRef.current = true;\n            return false;\n          }\n\n          setBackgroundProcessing(true);\n        },\n      },\n    );\n  });\n\n  const didMount = useRef(false);\n  const previousDebouncedFieldValues = useRef(\n    reduceFieldsToValues(debouncedFields),\n  );\n  // When debounced fields change, autosave\n  useEffect(() => {\n    /**\n     * Ensure autosave doesn't run on mount\n     */\n    if (!didMount.current) {\n      didMount.current = true;\n      return;\n    }\n\n    /**\n     * Ensure autosave only runs if the form data changes, not every time the entire form state changes\n     */\n    const debouncedFieldValues = reduceFieldsToValues(debouncedFields);\n    if (dequal(debouncedFieldValues, previousDebouncedFieldValues)) {\n      return;\n    }\n\n    previousDebouncedFieldValues.current = debouncedFieldValues;\n\n    handleAutosave();\n  }, [debouncedFields]);\n\n  /**\n   * If component unmounts, clear the autosave timeout\n   */\n  useEffect(() => {\n    return () => {\n      stopAutoSaveIndicator();\n    };\n  }, []);\n\n  const stopAutoSaveIndicator = useEffectEvent(() => {\n    if (autosaveTimeoutRef.current) {\n      clearTimeout(autosaveTimeoutRef.current);\n    }\n\n    setSaving(false);\n  });\n\n  return (\n    <div className={baseClass}>\n      {validateOnDraft && !isValid && <LeaveWithoutSaving />}\n      {saving && t(\"general:saving\")}\n      {!saving && Boolean(lastUpdateTime) && (\n        <React.Fragment>\n          {t(\"version:lastSavedAgo\", {\n            distance: formatTimeToNow({ date: lastUpdateTime, i18n }),\n          })}\n        </React.Fragment>\n      )}\n    </div>\n  );\n};\n"],"mappings":"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","ignoreList":[]}