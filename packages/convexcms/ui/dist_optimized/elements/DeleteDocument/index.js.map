{"version":3,"file":"index.js","names":["React","useCallback","useRouter","formatAdminURL","getTranslation","useModal","toast","useForm","useConfig","useDocumentInfo","useRouteTransition","useTranslation","requests","ConfirmationModal","PopupList","Translation","DeleteDocument","props","id","buttonId","collectionSlug","onDelete","redirectAfterDelete","singularLabel","title","titleFromProps","config","routes","admin","adminRoute","api","serverURL","getEntityConfig","collectionConfig","setModified","router","i18n","t","startRouteTransition","openModal","modalSlug","addDefaultError","error","handleDelete","delete","headers","language","then","res","json","status","success","label","message","push","path","errors","forEach","_err","_jsxs","Fragment","_jsx","Button","onClick","body","elements","1","children","i18nKey","variables","confirmingLabel","heading","onConfirm"],"sources":["../../../src/elements/DeleteDocument/index.tsx"],"sourcesContent":["\"use client\";\n\nimport \"./index.scss\";\n\nimport type { SanitizedCollectionConfig } from \"@convexcms/core\";\nimport React, { useCallback } from \"react\";\nimport { useRouter } from \"next/navigation.js\";\nimport { formatAdminURL } from \"@convexcms/core/shared\";\nimport { getTranslation } from \"@convexcms/translations\";\nimport { useModal } from \"@faceless-ui/modal\";\nimport { toast } from \"sonner\";\n\nimport type { DocumentDrawerContextType } from \"../DocumentDrawer/Provider.js\";\nimport { useForm } from \"../../forms/Form/context.js\";\nimport { useConfig } from \"../../providers/Config/index.js\";\nimport { useDocumentInfo } from \"../../providers/DocumentInfo/index.js\";\nimport { useRouteTransition } from \"../../providers/RouteTransition/index.js\";\nimport { useTranslation } from \"../../providers/Translation/index.js\";\nimport { requests } from \"../../utilities/api.js\";\nimport { ConfirmationModal } from \"../ConfirmationModal/index.js\";\nimport { PopupList } from \"../Popup/index.js\";\nimport { Translation } from \"../Translation/index.js\";\n\nexport type Props = {\n  readonly buttonId?: string;\n  readonly collectionSlug: SanitizedCollectionConfig[\"slug\"];\n  readonly id?: string;\n  readonly onDelete?: DocumentDrawerContextType[\"onDelete\"];\n  readonly redirectAfterDelete?: boolean;\n  readonly singularLabel: SanitizedCollectionConfig[\"labels\"][\"singular\"];\n  readonly title?: string;\n  readonly useAsTitle: SanitizedCollectionConfig[\"admin\"][\"useAsTitle\"];\n};\n\nexport const DeleteDocument: React.FC<Props> = (props) => {\n  const {\n    id,\n    buttonId,\n    collectionSlug,\n    onDelete,\n    redirectAfterDelete = true,\n    singularLabel,\n    title: titleFromProps,\n  } = props;\n\n  const {\n    config: {\n      routes: { admin: adminRoute, api },\n      serverURL,\n    },\n    getEntityConfig,\n  } = useConfig();\n\n  const collectionConfig = getEntityConfig({ collectionSlug });\n\n  const { setModified } = useForm();\n  const router = useRouter();\n  const { i18n, t } = useTranslation();\n  const { title } = useDocumentInfo();\n  const { startRouteTransition } = useRouteTransition();\n  const { openModal } = useModal();\n\n  const modalSlug = `delete-${id}`;\n\n  const addDefaultError = useCallback(() => {\n    toast.error(t(\"error:deletingTitle\", { title }));\n  }, [t, title]);\n\n  const handleDelete = useCallback(async () => {\n    setModified(false);\n\n    try {\n      await requests\n        .delete(`${serverURL}${api}/${collectionSlug}/${id}`, {\n          headers: {\n            \"Accept-Language\": i18n.language,\n            \"Content-Type\": \"application/json\",\n          },\n        })\n        .then(async (res) => {\n          try {\n            const json = await res.json();\n\n            if (res.status < 400) {\n              toast.success(\n                t(\"general:titleDeleted\", {\n                  label: getTranslation(singularLabel, i18n),\n                  title,\n                }) || json.message,\n              );\n\n              if (redirectAfterDelete) {\n                return startRouteTransition(() =>\n                  router.push(\n                    formatAdminURL({\n                      adminRoute,\n                      path: `/collections/${collectionSlug}`,\n                    }),\n                  ),\n                );\n              }\n\n              if (typeof onDelete === \"function\") {\n                await onDelete({ id, collectionConfig });\n              }\n\n              return;\n            }\n\n            if (json.errors) {\n              json.errors.forEach((error) => toast.error(error.message));\n            } else {\n              addDefaultError();\n            }\n\n            return false;\n          } catch (_err) {\n            return addDefaultError();\n          }\n        });\n    } catch (_err) {\n      return addDefaultError();\n    }\n  }, [\n    setModified,\n    serverURL,\n    api,\n    collectionSlug,\n    id,\n    t,\n    singularLabel,\n    addDefaultError,\n    i18n,\n    title,\n    router,\n    adminRoute,\n    redirectAfterDelete,\n    onDelete,\n    collectionConfig,\n    startRouteTransition,\n  ]);\n\n  if (id) {\n    return (\n      <React.Fragment>\n        <PopupList.Button\n          id={buttonId}\n          onClick={() => {\n            openModal(modalSlug);\n          }}\n        >\n          {t(\"general:delete\")}\n        </PopupList.Button>\n        <ConfirmationModal\n          body={\n            <Translation\n              elements={{\n                \"1\": ({ children }) => <strong>{children}</strong>,\n              }}\n              i18nKey=\"general:aboutToDelete\"\n              t={t}\n              variables={{\n                label: getTranslation(singularLabel, i18n),\n                title: titleFromProps || title || id,\n              }}\n            />\n          }\n          confirmingLabel={t(\"general:deleting\")}\n          heading={t(\"general:confirmDeletion\")}\n          modalSlug={modalSlug}\n          onConfirm={handleDelete}\n        />\n      </React.Fragment>\n    );\n  }\n\n  return null;\n};\n"],"mappings":"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","ignoreList":[]}