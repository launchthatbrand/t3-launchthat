{"version":3,"file":"index.js","names":["React","isImage","useModal","useWindowInfo","ChevronIcon","XIcon","useTranslation","AnimateHeight","Button","Drawer","ErrorPill","Pill","ShimmerEffect","Thumbnail","Actions","AddFilesView","useFormsManager","useBulkUpload","addMoreFilesDrawerSlug","baseClass","FileSidebar","activeIndex","addFiles","forms","isInitializing","removeFile","setActiveIndex","thumbnailUrls","totalErrorCount","initialFiles","maxFiles","i18n","t","closeModal","openModal","showFiles","setShowFiles","useState","breakpoints","handleRemoveFile","useCallback","indexToRemove","handleAddFiles","filelist","getFileSize","file","size","i","Math","floor","log","decimals","formattedSize","pow","toFixed","totalFileCount","length","_jsxs","className","filter","Boolean","join","m","_jsx","count","withMessage","title","onClick","buttonStyle","prev","direction","gutter","Header","slug","onCancel","onDrop","height","Array","from","map","index","animationDelay","errorCount","formState","currentFile","value","type","fileSrc","name","File"],"sources":["../../../../src/elements/BulkUpload/FileSidebar/index.tsx"],"sourcesContent":["\"use client\";\n\nimport \"./index.scss\";\n\nimport React from \"react\";\nimport { isImage } from \"@convexcms/core/shared\";\nimport { useModal } from \"@faceless-ui/modal\";\nimport { useWindowInfo } from \"@faceless-ui/window-info\";\n\nimport { ChevronIcon } from \"../../../icons/Chevron/index.js\";\nimport { XIcon } from \"../../../icons/X/index.js\";\nimport { useTranslation } from \"../../../providers/Translation/index.js\";\nimport { AnimateHeight } from \"../../AnimateHeight/index.js\";\nimport { Button } from \"../../Button/index.js\";\nimport { Drawer } from \"../../Drawer/index.js\";\nimport { ErrorPill } from \"../../ErrorPill/index.js\";\nimport { Pill } from \"../../Pill/index.js\";\nimport { ShimmerEffect } from \"../../ShimmerEffect/index.js\";\nimport { Thumbnail } from \"../../Thumbnail/index.js\";\nimport { Actions } from \"../ActionsBar/index.js\";\nimport { AddFilesView } from \"../AddFilesView/index.js\";\nimport { useFormsManager } from \"../FormsManager/index.js\";\nimport { useBulkUpload } from \"../index.js\";\n\nconst addMoreFilesDrawerSlug = \"bulk-upload-drawer--add-more-files\";\n\nconst baseClass = \"file-selections\";\n\nexport function FileSidebar() {\n  const {\n    activeIndex,\n    addFiles,\n    forms,\n    isInitializing,\n    removeFile,\n    setActiveIndex,\n    thumbnailUrls,\n    totalErrorCount,\n  } = useFormsManager();\n  const { initialFiles, maxFiles } = useBulkUpload();\n  const { i18n, t } = useTranslation();\n  const { closeModal, openModal } = useModal();\n  const [showFiles, setShowFiles] = React.useState(false);\n  const { breakpoints } = useWindowInfo();\n\n  const handleRemoveFile = React.useCallback(\n    (indexToRemove: number) => {\n      removeFile(indexToRemove);\n    },\n    [removeFile],\n  );\n\n  const handleAddFiles = React.useCallback(\n    (filelist: FileList) => {\n      void addFiles(filelist);\n      closeModal(addMoreFilesDrawerSlug);\n    },\n    [addFiles, closeModal],\n  );\n\n  const getFileSize = React.useCallback((file: File) => {\n    const size = file.size;\n    const i = size === 0 ? 0 : Math.floor(Math.log(size) / Math.log(1024));\n    const decimals = i > 1 ? 1 : 0;\n    const formattedSize =\n      (size / Math.pow(1024, i)).toFixed(decimals) +\n      \" \" +\n      [\"B\", \"kB\", \"MB\", \"GB\", \"TB\"][i];\n    return formattedSize;\n  }, []);\n\n  const totalFileCount = isInitializing ? initialFiles.length : forms.length;\n\n  return (\n    <div\n      className={[baseClass, showFiles && `${baseClass}__showingFiles`]\n        .filter(Boolean)\n        .join(\" \")}\n    >\n      {breakpoints.m && showFiles ? (\n        <div className={`${baseClass}__mobileBlur`} />\n      ) : null}\n      <div className={`${baseClass}__header`}>\n        <div className={`${baseClass}__headerTopRow`}>\n          <div className={`${baseClass}__header__text`}>\n            <ErrorPill count={totalErrorCount} i18n={i18n} withMessage />\n            <p>\n              <strong\n                title={`${totalFileCount} ${t(totalFileCount > 1 ? \"upload:filesToUpload\" : \"upload:fileToUpload\")}`}\n              >\n                {totalFileCount}{\" \"}\n                {t(\n                  totalFileCount > 1\n                    ? \"upload:filesToUpload\"\n                    : \"upload:fileToUpload\",\n                )}\n              </strong>\n            </p>\n          </div>\n\n          <div className={`${baseClass}__header__actions`}>\n            {(\n              typeof maxFiles === \"number\" ? totalFileCount < maxFiles : true\n            ) ? (\n              <Pill\n                className={`${baseClass}__header__addFile`}\n                onClick={() => openModal(addMoreFilesDrawerSlug)}\n              >\n                {t(\"upload:addFile\")}\n              </Pill>\n            ) : null}\n            <Button\n              buttonStyle=\"transparent\"\n              className={`${baseClass}__toggler`}\n              onClick={() => setShowFiles((prev) => !prev)}\n            >\n              <span className={`${baseClass}__toggler__label`}>\n                <strong\n                  title={`${totalFileCount} ${t(totalFileCount > 1 ? \"upload:filesToUpload\" : \"upload:fileToUpload\")}`}\n                >\n                  {totalFileCount}{\" \"}\n                  {t(\n                    totalFileCount > 1\n                      ? \"upload:filesToUpload\"\n                      : \"upload:fileToUpload\",\n                  )}\n                </strong>\n              </span>\n              <ChevronIcon direction={showFiles ? \"down\" : \"up\"} />\n            </Button>\n\n            <Drawer gutter={false} Header={null} slug={addMoreFilesDrawerSlug}>\n              <AddFilesView\n                onCancel={() => closeModal(addMoreFilesDrawerSlug)}\n                onDrop={handleAddFiles}\n              />\n            </Drawer>\n          </div>\n        </div>\n\n        <div className={`${baseClass}__header__mobileDocActions`}>\n          <Actions />\n        </div>\n      </div>\n\n      <div className={`${baseClass}__animateWrapper`}>\n        <AnimateHeight height={!breakpoints.m || showFiles ? \"auto\" : 0}>\n          <div className={`${baseClass}__filesContainer`}>\n            {isInitializing && forms.length === 0 && initialFiles.length > 0\n              ? Array.from(initialFiles).map((file, index) => (\n                  <ShimmerEffect\n                    animationDelay={`calc(${index} * ${60}ms)`}\n                    height=\"35px\"\n                    key={index}\n                  />\n                ))\n              : null}\n            {forms.map(({ errorCount, formState }, index) => {\n              const currentFile =\n                (formState?.file?.value as File) || ({} as File);\n\n              return (\n                <div\n                  className={[\n                    `${baseClass}__fileRowContainer`,\n                    index === activeIndex &&\n                      `${baseClass}__fileRowContainer--active`,\n                    errorCount &&\n                      errorCount > 0 &&\n                      `${baseClass}__fileRowContainer--error`,\n                  ]\n                    .filter(Boolean)\n                    .join(\" \")}\n                  key={index}\n                >\n                  <button\n                    className={`${baseClass}__fileRow`}\n                    onClick={() => setActiveIndex(index)}\n                    type=\"button\"\n                  >\n                    <Thumbnail\n                      className={`${baseClass}__thumbnail`}\n                      fileSrc={\n                        isImage(currentFile.type) ? thumbnailUrls[index] : null\n                      }\n                    />\n                    <div className={`${baseClass}__fileDetails`}>\n                      <p\n                        className={`${baseClass}__fileName`}\n                        title={currentFile.name}\n                      >\n                        {currentFile.name || t(\"upload:noFile\")}\n                      </p>\n                    </div>\n                    {currentFile instanceof File ? (\n                      <p className={`${baseClass}__fileSize`}>\n                        {getFileSize(currentFile)}\n                      </p>\n                    ) : null}\n                    <div\n                      className={`${baseClass}__remove ${baseClass}__remove--underlay`}\n                    >\n                      <XIcon />\n                    </div>\n\n                    {errorCount ? (\n                      <ErrorPill\n                        className={`${baseClass}__errorCount`}\n                        count={errorCount}\n                        i18n={i18n}\n                      />\n                    ) : null}\n                  </button>\n\n                  <button\n                    aria-label={t(\"general:remove\")}\n                    className={`${baseClass}__remove ${baseClass}__remove--overlay`}\n                    onClick={() => handleRemoveFile(index)}\n                    type=\"button\"\n                  >\n                    <XIcon />\n                  </button>\n                </div>\n              );\n            })}\n          </div>\n        </AnimateHeight>\n      </div>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]}