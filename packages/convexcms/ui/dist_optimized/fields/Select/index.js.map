{"version":3,"file":"index.js","names":["React","useCallback","useMemo","useField","withCondition","mergeFieldStyles","SelectInput","formatOptions","options","map","option","value","label","SelectFieldComponent","props","field","name","admin","className","description","isClearable","isSortable","hasMany","localized","optionsFromProps","required","onChange","onChangeFromProps","path","readOnly","validate","memoizedValidate","validationOptions","customComponents","AfterInput","BeforeInput","Description","Error","Label","disabled","setValue","showError","selectedOption","newValue","Array","isArray","styles","_jsx","style","SelectField"],"sources":["../../../src/fields/Select/index.tsx"],"sourcesContent":["\"use client\";\n\nimport type {\n  Option,\n  OptionObject,\n  SelectFieldClientComponent,\n  SelectFieldClientProps,\n} from \"@convexcms/core\";\nimport React, { useCallback, useMemo } from \"react\";\n\nimport type { ReactSelectAdapterProps } from \"../../elements/ReactSelect/types.js\";\nimport type { SelectInputProps } from \"./Input.js\";\nimport { useField } from \"../../forms/useField/index.js\";\nimport { withCondition } from \"../../forms/withCondition/index.js\";\nimport { mergeFieldStyles } from \"../mergeFieldStyles.js\";\nimport { SelectInput } from \"./Input.js\";\n\nconst formatOptions = (options: Option[]): OptionObject[] =>\n  options.map((option) => {\n    if (typeof option === \"object\" && (option.value || option.value === \"\")) {\n      return option;\n    }\n\n    return {\n      label: option,\n      value: option,\n    } as OptionObject;\n  });\n\nconst SelectFieldComponent: SelectFieldClientComponent = (props) => {\n  const {\n    field,\n    field: {\n      name,\n      admin: {\n        className,\n        description,\n        isClearable = true,\n        isSortable = true,\n      } = {} as SelectFieldClientProps[\"field\"][\"admin\"],\n      hasMany = false,\n      label,\n      localized,\n      options: optionsFromProps = [],\n      required,\n    },\n    onChange: onChangeFromProps,\n    path,\n    readOnly,\n    validate,\n  } = props;\n\n  const options = React.useMemo(\n    () => formatOptions(optionsFromProps),\n    [optionsFromProps],\n  );\n\n  const memoizedValidate = useCallback(\n    (value, validationOptions) => {\n      if (typeof validate === \"function\") {\n        return validate(value, {\n          ...validationOptions,\n          hasMany,\n          options,\n          required,\n        });\n      }\n    },\n    [validate, required, hasMany, options],\n  );\n\n  const {\n    customComponents: {\n      AfterInput,\n      BeforeInput,\n      Description,\n      Error,\n      Label,\n    } = {},\n    disabled,\n    setValue,\n    showError,\n    value,\n  } = useField({\n    path,\n    validate: memoizedValidate,\n  });\n\n  const onChange: ReactSelectAdapterProps[\"onChange\"] = useCallback(\n    (selectedOption: OptionObject | OptionObject[]) => {\n      if (!readOnly || disabled) {\n        let newValue: string | string[] = null;\n        if (selectedOption && hasMany) {\n          if (Array.isArray(selectedOption)) {\n            newValue = selectedOption.map((option) => option.value);\n          } else {\n            newValue = [];\n          }\n        } else if (selectedOption && !Array.isArray(selectedOption)) {\n          newValue = selectedOption.value;\n        }\n\n        if (typeof onChangeFromProps === \"function\") {\n          onChangeFromProps(newValue);\n        }\n\n        setValue(newValue);\n      }\n    },\n    [readOnly, disabled, hasMany, setValue, onChangeFromProps],\n  );\n\n  const styles = useMemo(() => mergeFieldStyles(field), [field]);\n\n  return (\n    <SelectInput\n      AfterInput={AfterInput}\n      BeforeInput={BeforeInput}\n      className={className}\n      Description={Description}\n      description={description}\n      Error={Error}\n      hasMany={hasMany}\n      isClearable={isClearable}\n      isSortable={isSortable}\n      Label={Label}\n      label={label}\n      localized={localized}\n      name={name}\n      onChange={onChange}\n      options={options}\n      path={path}\n      readOnly={readOnly || disabled}\n      required={required}\n      showError={showError}\n      style={styles}\n      value={value as string | string[]}\n    />\n  );\n};\n\nexport const SelectField = withCondition(SelectFieldComponent);\n\nexport { SelectInput, type SelectInputProps };\n"],"mappings":"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","ignoreList":[]}