{"version":3,"file":"index.js","names":["React","formatFilesize","isImage","Button","useDocumentDrawer","ThumbnailComponent","useConfig","baseClass","RelationshipContent","props","id","allowEdit","allowRemove","alt","byteSize","className","collectionSlug","displayPreview","filename","mimeType","onRemove","reloadDoc","src","thumbnailSrc","withMeta","x","y","config","collectionConfig","collections","find","collection","slug","undefined","DocumentDrawer","_","openDrawer","onSave","useCallback","doc","generateMetaText","size","sections","push","join","metaText","previewAllowed","upload","_jsxs","filter","Boolean","_jsx","fileSrc","href","target","buttonStyle","icon","iconStyle","onClick"],"sources":["../../../../src/fields/Upload/RelationshipContent/index.tsx"],"sourcesContent":["\"use client\";\n\nimport \"./index.scss\";\n\nimport type { TypeWithID } from \"@convexcms/core\";\nimport React from \"react\";\nimport { formatFilesize, isImage } from \"@convexcms/core/shared\";\n\nimport type { ReloadDoc } from \"../types.js\";\nimport { Button } from \"../../../elements/Button/index.js\";\nimport { useDocumentDrawer } from \"../../../elements/DocumentDrawer/index.js\";\nimport { ThumbnailComponent } from \"../../../elements/Thumbnail/index.js\";\nimport { useConfig } from \"../../../providers/Config/index.js\";\n\nconst baseClass = \"upload-relationship-details\";\n\ntype Props = {\n  readonly allowEdit?: boolean;\n  readonly allowRemove?: boolean;\n  readonly alt: string;\n  readonly byteSize: number;\n  readonly className?: string;\n  readonly collectionSlug: string;\n  readonly displayPreview?: boolean;\n  readonly filename: string;\n  readonly id?: number | string;\n  readonly mimeType: string;\n  readonly onRemove: () => void;\n  readonly reloadDoc: ReloadDoc;\n  readonly src: string;\n  readonly thumbnailSrc: string;\n  readonly withMeta?: boolean;\n  readonly x?: number;\n  readonly y?: number;\n};\nexport function RelationshipContent(props: Props) {\n  const {\n    id,\n    allowEdit,\n    allowRemove,\n    alt,\n    byteSize,\n    className,\n    collectionSlug,\n    displayPreview,\n    filename,\n    mimeType,\n    onRemove,\n    reloadDoc,\n    src,\n    thumbnailSrc,\n    withMeta = true,\n    x,\n    y,\n  } = props;\n\n  const { config } = useConfig();\n  const collectionConfig =\n    \"collections\" in config\n      ? config.collections.find(\n          (collection) => collection.slug === collectionSlug,\n        )\n      : undefined;\n\n  const [DocumentDrawer, _, { openDrawer }] = useDocumentDrawer({\n    id: src ? id : undefined,\n    collectionSlug,\n  });\n\n  const onSave = React.useCallback(\n    async ({ doc }: { doc: TypeWithID }) => reloadDoc(doc.id, collectionSlug),\n    [reloadDoc, collectionSlug],\n  );\n\n  function generateMetaText(mimeType: string, size: number): string {\n    const sections: string[] = [];\n    if (size) {\n      sections.push(formatFilesize(size));\n    }\n\n    if (x && y) {\n      sections.push(`${x}x${y}`);\n    }\n\n    if (mimeType) {\n      sections.push(mimeType);\n    }\n\n    return sections.join(\" â€” \");\n  }\n\n  const metaText = withMeta ? generateMetaText(mimeType, byteSize) : \"\";\n  const previewAllowed =\n    displayPreview ?? collectionConfig.upload?.displayPreview ?? true;\n\n  return (\n    <div className={[baseClass, className].filter(Boolean).join(\" \")}>\n      <div className={`${baseClass}__imageAndDetails`}>\n        {previewAllowed && (\n          <ThumbnailComponent\n            alt={alt}\n            className={`${baseClass}__thumbnail`}\n            filename={filename}\n            fileSrc={isImage(mimeType) && thumbnailSrc}\n            size=\"small\"\n          />\n        )}\n        <div className={`${baseClass}__details`}>\n          <p className={`${baseClass}__filename`}>\n            {src ? (\n              <a href={src} target=\"_blank\">\n                {filename}\n              </a>\n            ) : (\n              filename\n            )}\n          </p>\n          {withMeta ? <p className={`${baseClass}__meta`}>{metaText}</p> : null}\n        </div>\n      </div>\n\n      {allowEdit !== false || allowRemove !== false ? (\n        <div className={`${baseClass}__actions`}>\n          {allowEdit !== false ? (\n            <Button\n              buttonStyle=\"icon-label\"\n              className={`${baseClass}__edit`}\n              icon=\"edit\"\n              iconStyle=\"none\"\n              onClick={openDrawer}\n            />\n          ) : null}\n          {allowRemove !== false ? (\n            <Button\n              buttonStyle=\"icon-label\"\n              className={`${baseClass}__remove`}\n              icon=\"x\"\n              iconStyle=\"none\"\n              onClick={() => onRemove()}\n            />\n          ) : null}\n          <DocumentDrawer onSave={onSave} />\n        </div>\n      ) : null}\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]}