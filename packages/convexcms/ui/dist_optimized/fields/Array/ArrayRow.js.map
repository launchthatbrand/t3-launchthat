{"version":3,"file":"ArrayRow.js","names":["React","getTranslation","ArrayAction","Collapsible","ErrorPill","ShimmerEffect","useFormSubmitted","RenderFields","RowLabel","useThrottledValue","useTranslation","baseClass","ArrayRow","addRow","attributes","CustomRowLabel","duplicateRow","errorCount","fields","forceRender","hasMaxRows","isDragging","isLoading","isLoadingFromProps","isSortable","labels","listeners","moveRow","parentPath","path","permissions","readOnly","removeRow","row","rowCount","rowIndex","schemaPath","setCollapse","setNodeRef","transform","transition","i18n","hasSubmitted","fallbackLabel","singular","String","padStart","fieldHasErrors","classNames","filter","Boolean","join","_jsx","id","split","ref","style","zIndex","undefined","actions","index","className","collapsibleStyle","dragHandleProps","header","_jsxs","height","width","CustomComponent","label","rowNumber","count","withMessage","isCollapsed","collapsed","onToggle","margins","parentIndexPath","parentSchemaPath"],"sources":["../../../src/fields/Array/ArrayRow.tsx"],"sourcesContent":["\"use client\";\n\nimport \"./index.scss\";\n\nimport type {\n  ArrayField,\n  ClientField,\n  Row,\n  SanitizedFieldPermissions,\n} from \"@convexcms/core\";\nimport React from \"react\";\nimport { getTranslation } from \"@convexcms/translations\";\n\nimport type { UseDraggableSortableReturn } from \"../../elements/DraggableSortable/useDraggableSortable/types.js\";\nimport { ArrayAction } from \"../../elements/ArrayAction/index.js\";\nimport { Collapsible } from \"../../elements/Collapsible/index.js\";\nimport { ErrorPill } from \"../../elements/ErrorPill/index.js\";\nimport { ShimmerEffect } from \"../../elements/ShimmerEffect/index.js\";\nimport { useFormSubmitted } from \"../../forms/Form/context.js\";\nimport { RenderFields } from \"../../forms/RenderFields/index.js\";\nimport { RowLabel } from \"../../forms/RowLabel/index.js\";\nimport { useThrottledValue } from \"../../hooks/useThrottledValue.js\";\nimport { useTranslation } from \"../../providers/Translation/index.js\";\n\nconst baseClass = \"array-field\";\n\ntype ArrayRowProps = {\n  readonly addRow: (rowIndex: number) => Promise<void> | void;\n  readonly CustomRowLabel?: React.ReactNode;\n  readonly duplicateRow: (rowIndex: number) => void;\n  readonly errorCount: number;\n  readonly fields: ClientField[];\n  readonly forceRender?: boolean;\n  readonly hasMaxRows?: boolean;\n  readonly isLoading?: boolean;\n  readonly isSortable?: boolean;\n  readonly labels: Partial<ArrayField[\"labels\"]>;\n  readonly moveRow: (fromIndex: number, toIndex: number) => void;\n  readonly parentPath: string;\n  readonly path: string;\n  readonly permissions: SanitizedFieldPermissions;\n  readonly readOnly?: boolean;\n  readonly removeRow: (rowIndex: number) => void;\n  readonly row: Row;\n  readonly rowCount: number;\n  readonly rowIndex: number;\n  readonly schemaPath: string;\n  readonly setCollapse: (rowID: string, collapsed: boolean) => void;\n} & UseDraggableSortableReturn;\n\nexport const ArrayRow: React.FC<ArrayRowProps> = ({\n  addRow,\n  attributes,\n  CustomRowLabel,\n  duplicateRow,\n  errorCount,\n  fields,\n  forceRender = false,\n  hasMaxRows,\n  isDragging,\n  isLoading: isLoadingFromProps,\n  isSortable,\n  labels,\n  listeners,\n  moveRow,\n  parentPath,\n  path,\n  permissions,\n  readOnly,\n  removeRow,\n  row,\n  rowCount,\n  rowIndex,\n  schemaPath,\n  setCollapse,\n  setNodeRef,\n  transform,\n  transition,\n}) => {\n  const isLoading = useThrottledValue(isLoadingFromProps, 500);\n\n  const { i18n } = useTranslation();\n  const hasSubmitted = useFormSubmitted();\n\n  const fallbackLabel = `${getTranslation(labels.singular, i18n)} ${String(\n    rowIndex + 1,\n  ).padStart(2, \"0\")}`;\n\n  const fieldHasErrors = errorCount > 0 && hasSubmitted;\n\n  const classNames = [\n    `${baseClass}__row`,\n    fieldHasErrors\n      ? `${baseClass}__row--has-errors`\n      : `${baseClass}__row--no-errors`,\n  ]\n    .filter(Boolean)\n    .join(\" \");\n\n  return (\n    <div\n      id={`${parentPath.split(\".\").join(\"-\")}-row-${rowIndex}`}\n      key={`${parentPath}-row-${row.id}`}\n      ref={setNodeRef}\n      style={{\n        transform,\n        transition,\n        zIndex: isDragging ? 1 : undefined,\n      }}\n    >\n      <Collapsible\n        actions={\n          !readOnly ? (\n            <ArrayAction\n              addRow={addRow}\n              duplicateRow={duplicateRow}\n              hasMaxRows={hasMaxRows}\n              index={rowIndex}\n              isSortable={isSortable}\n              moveRow={moveRow}\n              removeRow={removeRow}\n              rowCount={rowCount}\n            />\n          ) : undefined\n        }\n        className={classNames}\n        collapsibleStyle={fieldHasErrors ? \"error\" : \"default\"}\n        dragHandleProps={\n          isSortable\n            ? {\n                id: row.id,\n                attributes,\n                listeners,\n              }\n            : undefined\n        }\n        header={\n          <div className={`${baseClass}__row-header`}>\n            {isLoading ? (\n              <ShimmerEffect height=\"1rem\" width=\"8rem\" />\n            ) : (\n              <RowLabel\n                CustomComponent={CustomRowLabel}\n                label={fallbackLabel}\n                path={path}\n                rowNumber={rowIndex}\n              />\n            )}\n            {fieldHasErrors && (\n              <ErrorPill count={errorCount} i18n={i18n} withMessage />\n            )}\n          </div>\n        }\n        isCollapsed={row.collapsed}\n        onToggle={(collapsed) => setCollapse(row.id, collapsed)}\n      >\n        {isLoading ? (\n          <ShimmerEffect />\n        ) : (\n          <RenderFields\n            className={`${baseClass}__fields`}\n            fields={fields}\n            forceRender={forceRender}\n            margins=\"small\"\n            parentIndexPath=\"\"\n            parentPath={path}\n            parentSchemaPath={schemaPath}\n            permissions={\n              permissions === true ? permissions : permissions?.fields\n            }\n            readOnly={readOnly}\n          />\n        )}\n      </Collapsible>\n    </div>\n  );\n};\n"],"mappings":"AAAA;;;AAEA,OAAO;AAQP,OAAOA,KAAA,MAAW;AAClB,SAASC,cAAc,QAAQ;AAG/B,SAASC,WAAW,QAAQ;AAC5B,SAASC,WAAW,QAAQ;AAC5B,SAASC,SAAS,QAAQ;AAC1B,SAASC,aAAa,QAAQ;AAC9B,SAASC,gBAAgB,QAAQ;AACjC,SAASC,YAAY,QAAQ;AAC7B,SAASC,QAAQ,QAAQ;AACzB,SAASC,iBAAiB,QAAQ;AAClC,SAASC,cAAc,QAAQ;AAE/B,MAAMC,SAAA,GAAY;AA0BlB,OAAO,MAAMC,QAAA,GAAoCA,CAAC;EAChDC,MAAM;EACNC,UAAU;EACVC,cAAc;EACdC,YAAY;EACZC,UAAU;EACVC,MAAM;EACNC,WAAA,GAAc,KAAK;EACnBC,UAAU;EACVC,UAAU;EACVC,SAAA,EAAWC,kBAAkB;EAC7BC,UAAU;EACVC,MAAM;EACNC,SAAS;EACTC,OAAO;EACPC,UAAU;EACVC,IAAI;EACJC,WAAW;EACXC,QAAQ;EACRC,SAAS;EACTC,GAAG;EACHC,QAAQ;EACRC,QAAQ;EACRC,UAAU;EACVC,WAAW;EACXC,UAAU;EACVC,SAAS;EACTC;AAAU,CACX;EACC,MAAMlB,SAAA,GAAYb,iBAAA,CAAkBc,kBAAA,EAAoB;EAExD,MAAM;IAAEkB;EAAI,CAAE,GAAG/B,cAAA;EACjB,MAAMgC,YAAA,GAAepC,gBAAA;EAErB,MAAMqC,aAAA,GAAgB,GAAG1C,cAAA,CAAewB,MAAA,CAAOmB,QAAQ,EAAEH,IAAA,KAASI,MAAA,CAChEV,QAAA,GAAW,GACXW,QAAQ,CAAC,GAAG,MAAM;EAEpB,MAAMC,cAAA,GAAiB9B,UAAA,GAAa,KAAKyB,YAAA;EAEzC,MAAMM,UAAA,GAAa,CACjB,GAAGrC,SAAA,OAAgB,EACnBoC,cAAA,GACI,GAAGpC,SAAA,mBAA4B,GAC/B,GAAGA,SAAA,kBAA2B,CACnC,CACEsC,MAAM,CAACC,OAAA,EACPC,IAAI,CAAC;EAER,oBACEC,IAAA,CAAC;IACCC,EAAA,EAAI,GAAGzB,UAAA,CAAW0B,KAAK,CAAC,KAAKH,IAAI,CAAC,YAAYhB,QAAA,EAAU;IAExDoB,GAAA,EAAKjB,UAAA;IACLkB,KAAA,EAAO;MACLjB,SAAA;MACAC,UAAA;MACAiB,MAAA,EAAQpC,UAAA,GAAa,IAAIqC;IAC3B;cAEA,aAAAN,IAAA,CAACjD,WAAA;MACCwD,OAAA,EACE,CAAC5B,QAAA,gBACCqB,IAAA,CAAClD,WAAA;QACCW,MAAA,EAAQA,MAAA;QACRG,YAAA,EAAcA,YAAA;QACdI,UAAA,EAAYA,UAAA;QACZwC,KAAA,EAAOzB,QAAA;QACPX,UAAA,EAAYA,UAAA;QACZG,OAAA,EAASA,OAAA;QACTK,SAAA,EAAWA,SAAA;QACXE,QAAA,EAAUA;WAEVwB,SAAA;MAENG,SAAA,EAAWb,UAAA;MACXc,gBAAA,EAAkBf,cAAA,GAAiB,UAAU;MAC7CgB,eAAA,EACEvC,UAAA,GACI;QACE6B,EAAA,EAAIpB,GAAA,CAAIoB,EAAE;QACVvC,UAAA;QACAY;MACF,IACAgC,SAAA;MAENM,MAAA,eACEC,KAAA,CAAC;QAAIJ,SAAA,EAAW,GAAGlD,SAAA,cAAuB;mBACvCW,SAAA,gBACC8B,IAAA,CAAC/C,aAAA;UAAc6D,MAAA,EAAO;UAAOC,KAAA,EAAM;0BAEnCf,IAAA,CAAC5C,QAAA;UACC4D,eAAA,EAAiBrD,cAAA;UACjBsD,KAAA,EAAO1B,aAAA;UACPd,IAAA,EAAMA,IAAA;UACNyC,SAAA,EAAWnC;YAGdY,cAAA,iBACCK,IAAA,CAAChD,SAAA;UAAUmE,KAAA,EAAOtD,UAAA;UAAYwB,IAAA,EAAMA,IAAA;UAAM+B,WAAW;;;MAI3DC,WAAA,EAAaxC,GAAA,CAAIyC,SAAS;MAC1BC,QAAA,EAAWD,SAAA,IAAcrC,WAAA,CAAYJ,GAAA,CAAIoB,EAAE,EAAEqB,SAAA;gBAE5CpD,SAAA,gBACC8B,IAAA,CAAC/C,aAAA,qBAED+C,IAAA,CAAC7C,YAAA;QACCsD,SAAA,EAAW,GAAGlD,SAAA,UAAmB;QACjCO,MAAA,EAAQA,MAAA;QACRC,WAAA,EAAaA,WAAA;QACbyD,OAAA,EAAQ;QACRC,eAAA,EAAgB;QAChBjD,UAAA,EAAYC,IAAA;QACZiD,gBAAA,EAAkB1C,UAAA;QAClBN,WAAA,EACEA,WAAA,KAAgB,OAAOA,WAAA,GAAcA,WAAA,EAAaZ,MAAA;QAEpDa,QAAA,EAAUA;;;KApEX,GAAGH,UAAA,QAAkBK,GAAA,CAAIoB,EAAE,EAAE;AA0ExC","ignoreList":[]}