{"version":3,"file":"BlockRow.js","names":["React","getTranslation","Collapsible","ErrorPill","Pill","ShimmerEffect","useFormSubmitted","RenderFields","RowLabel","useThrottledValue","useTranslation","RowActions","SectionTitle","baseClass","BlockRow","addRow","attributes","block","blocks","duplicateRow","errorCount","fields","hasMaxRows","isLoading","isLoadingFromProps","isSortable","Label","labels","listeners","moveRow","parentPath","path","permissions","readOnly","removeRow","row","rowCount","rowIndex","schemaPath","setCollapse","setNodeRef","transform","i18n","hasSubmitted","fieldHasErrors","showBlockName","admin","disableBlockName","classNames","filter","Boolean","join","blockPermissions","undefined","permissionsBlockSpecific","slug","_jsx","id","split","ref","style","actions","blockType","className","collapsibleStyle","dragHandleProps","header","height","width","_jsxs","CustomComponent","label","_Fragment","String","padStart","pillStyle","singular","rowNumber","count","withMessage","isCollapsed","collapsed","onToggle","margins","parentIndexPath","parentSchemaPath"],"sources":["../../../src/fields/Blocks/BlockRow.tsx"],"sourcesContent":["\"use client\";\n\nimport type {\n  ClientBlock,\n  ClientField,\n  Labels,\n  Row,\n  SanitizedFieldPermissions,\n} from \"@convexcms/core\";\nimport React from \"react\";\nimport { getTranslation } from \"@convexcms/translations\";\n\nimport type { UseDraggableSortableReturn } from \"../../elements/DraggableSortable/useDraggableSortable/types.js\";\nimport type { RenderFieldsProps } from \"../../forms/RenderFields/types.js\";\nimport { Collapsible } from \"../../elements/Collapsible/index.js\";\nimport { ErrorPill } from \"../../elements/ErrorPill/index.js\";\nimport { Pill } from \"../../elements/Pill/index.js\";\nimport { ShimmerEffect } from \"../../elements/ShimmerEffect/index.js\";\nimport { useFormSubmitted } from \"../../forms/Form/context.js\";\nimport { RenderFields } from \"../../forms/RenderFields/index.js\";\nimport { RowLabel } from \"../../forms/RowLabel/index.js\";\nimport { useThrottledValue } from \"../../hooks/useThrottledValue.js\";\nimport { useTranslation } from \"../../providers/Translation/index.js\";\nimport { RowActions } from \"./RowActions.js\";\nimport { SectionTitle } from \"./SectionTitle/index.js\";\n\nconst baseClass = \"blocks-field\";\n\ntype BlocksFieldProps = {\n  addRow: (rowIndex: number, blockType: string) => Promise<void> | void;\n  block: ClientBlock;\n  blocks: (ClientBlock | string)[] | ClientBlock[];\n  duplicateRow: (rowIndex: number) => void;\n  errorCount: number;\n  fields: ClientField[];\n  hasMaxRows?: boolean;\n  isLoading?: boolean;\n  isSortable?: boolean;\n  Label?: React.ReactNode;\n  labels: Labels;\n  moveRow: (fromIndex: number, toIndex: number) => void;\n  parentPath: string;\n  path: string;\n  permissions: SanitizedFieldPermissions;\n  readOnly: boolean;\n  removeRow: (rowIndex: number) => void;\n  row: Row;\n  rowCount: number;\n  rowIndex: number;\n  schemaPath: string;\n  setCollapse: (id: string, collapsed: boolean) => void;\n} & UseDraggableSortableReturn;\n\nexport const BlockRow: React.FC<BlocksFieldProps> = ({\n  addRow,\n  attributes,\n  block,\n  blocks,\n  duplicateRow,\n  errorCount,\n  fields,\n  hasMaxRows,\n  isLoading: isLoadingFromProps,\n  isSortable,\n  Label,\n  labels,\n  listeners,\n  moveRow,\n  parentPath,\n  path,\n  permissions,\n  readOnly,\n  removeRow,\n  row,\n  rowCount,\n  rowIndex,\n  schemaPath,\n  setCollapse,\n  setNodeRef,\n  transform,\n}) => {\n  const isLoading = useThrottledValue(isLoadingFromProps, 500);\n\n  const { i18n } = useTranslation();\n  const hasSubmitted = useFormSubmitted();\n\n  const fieldHasErrors = hasSubmitted && errorCount > 0;\n\n  const showBlockName = !block.admin?.disableBlockName;\n\n  const classNames = [\n    `${baseClass}__row`,\n    fieldHasErrors\n      ? `${baseClass}__row--has-errors`\n      : `${baseClass}__row--no-errors`,\n  ]\n    .filter(Boolean)\n    .join(\" \");\n\n  let blockPermissions: RenderFieldsProps[\"permissions\"] = undefined;\n\n  if (permissions === true) {\n    blockPermissions = true;\n  } else {\n    const permissionsBlockSpecific = permissions?.blocks?.[block.slug];\n    if (permissionsBlockSpecific === true) {\n      blockPermissions = true;\n    } else {\n      blockPermissions = permissionsBlockSpecific?.fields;\n    }\n  }\n\n  return (\n    <div\n      id={`${parentPath?.split(\".\").join(\"-\")}-row-${rowIndex}`}\n      key={`${parentPath}-row-${rowIndex}`}\n      ref={setNodeRef}\n      style={{\n        transform,\n      }}\n    >\n      <Collapsible\n        actions={\n          !readOnly ? (\n            <RowActions\n              addRow={addRow}\n              blocks={blocks}\n              blockType={row.blockType}\n              duplicateRow={duplicateRow}\n              fields={block.fields}\n              hasMaxRows={hasMaxRows}\n              isSortable={isSortable}\n              labels={labels}\n              moveRow={moveRow}\n              removeRow={removeRow}\n              rowCount={rowCount}\n              rowIndex={rowIndex}\n            />\n          ) : undefined\n        }\n        className={classNames}\n        collapsibleStyle={fieldHasErrors ? \"error\" : \"default\"}\n        dragHandleProps={\n          isSortable\n            ? {\n                id: row.id,\n                attributes,\n                listeners,\n              }\n            : undefined\n        }\n        header={\n          isLoading ? (\n            <ShimmerEffect height=\"1rem\" width=\"8rem\" />\n          ) : (\n            <div className={`${baseClass}__block-header`}>\n              <RowLabel\n                CustomComponent={Label}\n                label={\n                  <>\n                    <span className={`${baseClass}__block-number`}>\n                      {String(rowIndex + 1).padStart(2, \"0\")}\n                    </span>\n                    <Pill\n                      className={`${baseClass}__block-pill ${baseClass}__block-pill-${row.blockType}`}\n                      pillStyle=\"white\"\n                    >\n                      {getTranslation(block.labels.singular, i18n)}\n                    </Pill>\n                    {showBlockName && (\n                      <SectionTitle\n                        path={`${path}.blockName`}\n                        readOnly={readOnly}\n                      />\n                    )}\n                  </>\n                }\n                path={path}\n                rowNumber={rowIndex}\n              />\n              {fieldHasErrors && (\n                <ErrorPill count={errorCount} i18n={i18n} withMessage />\n              )}\n            </div>\n          )\n        }\n        isCollapsed={row.collapsed}\n        key={row.id}\n        onToggle={(collapsed) => setCollapse(row.id, collapsed)}\n      >\n        {isLoading ? (\n          <ShimmerEffect />\n        ) : (\n          <RenderFields\n            className={`${baseClass}__fields`}\n            fields={fields}\n            margins=\"small\"\n            parentIndexPath=\"\"\n            parentPath={path}\n            parentSchemaPath={schemaPath}\n            permissions={blockPermissions}\n            readOnly={readOnly}\n          />\n        )}\n      </Collapsible>\n    </div>\n  );\n};\n"],"mappings":"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","ignoreList":[]}