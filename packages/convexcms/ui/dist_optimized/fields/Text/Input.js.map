{"version":3,"file":"Input.js","names":["React","getTranslation","ReactSelect","RenderCustomComponent","FieldDescription","FieldError","FieldLabel","useTranslation","fieldBaseClass","TextInput","props","AfterInput","BeforeInput","className","Description","description","Error","hasMany","inputRef","Label","label","localized","maxRows","onChange","onKeyDown","path","placeholder","readOnly","required","rtl","showError","style","value","valueToRender","i18n","t","editableProps","data","selectProps","editableClassName","onBlur","event","currentTarget","contentEditable","onClick","classList","add","focus","key","remove","innerText","replaceAll","action","option","Array","isArray","newValues","filter","v","id","removedValue","preventDefault","stopPropagation","_jsxs","Boolean","join","_jsx","CustomComponent","Fallback","replace","components","DropdownIndicator","customProps","disabled","filterOption","length","isClearable","isCreatable","isMulti","isSortable","menuIsOpen","noOptionsMessage","isOverHasMany","max","options","name","ref","type"],"sources":["../../../src/fields/Text/Input.tsx"],"sourcesContent":["\"use client\";\n\nimport \"./index.scss\";\n\nimport type { ChangeEvent } from \"react\";\nimport React from \"react\";\nimport { getTranslation } from \"@convexcms/translations\";\n\nimport type { ReactSelectAdapterProps } from \"../../elements/ReactSelect/types.js\";\nimport type { TextInputProps } from \"./types.js\";\nimport { ReactSelect } from \"../../elements/ReactSelect/index.js\";\nimport { RenderCustomComponent } from \"../../elements/RenderCustomComponent/index.js\";\nimport { FieldDescription } from \"../../fields/FieldDescription/index.js\";\nimport { FieldError } from \"../../fields/FieldError/index.js\";\nimport { FieldLabel } from \"../../fields/FieldLabel/index.js\";\nimport { useTranslation } from \"../../providers/Translation/index.js\";\nimport { fieldBaseClass } from \"../shared/index.js\";\n\nexport const TextInput: React.FC<TextInputProps> = (props) => {\n  const {\n    AfterInput,\n    BeforeInput,\n    className,\n    Description,\n    description,\n    Error,\n    hasMany,\n    inputRef,\n    Label,\n    label,\n    localized,\n    maxRows,\n    onChange,\n    onKeyDown,\n    path,\n    placeholder,\n    readOnly,\n    required,\n    rtl,\n    showError,\n    style,\n    value,\n    valueToRender,\n  } = props;\n\n  const { i18n, t } = useTranslation();\n\n  const editableProps: ReactSelectAdapterProps[\"customProps\"][\"editableProps\"] =\n    (data, className, selectProps) => {\n      const editableClassName = `${className}--editable`;\n\n      return {\n        onBlur: (event: React.FocusEvent<HTMLDivElement>) => {\n          event.currentTarget.contentEditable = \"false\";\n        },\n        onClick: (event: React.MouseEvent<HTMLDivElement>) => {\n          event.currentTarget.contentEditable = \"true\";\n          event.currentTarget.classList.add(editableClassName);\n          event.currentTarget.focus();\n        },\n        onKeyDown: (event: React.KeyboardEvent<HTMLDivElement>) => {\n          if (\n            event.key === \"Enter\" ||\n            event.key === \"Tab\" ||\n            event.key === \"Escape\"\n          ) {\n            event.currentTarget.contentEditable = \"false\";\n            event.currentTarget.classList.remove(editableClassName);\n            data.value.value = event.currentTarget.innerText;\n            data.label = event.currentTarget.innerText;\n\n            if (data.value.value.replaceAll(\"\\n\", \"\")) {\n              selectProps.onChange(selectProps.value, {\n                action: \"create-option\",\n                option: data,\n              });\n            } else {\n              if (Array.isArray(selectProps.value)) {\n                const newValues = selectProps.value.filter(\n                  (v) => v.id !== data.id,\n                );\n                selectProps.onChange(newValues, {\n                  action: \"pop-value\",\n                  removedValue: data,\n                });\n              }\n            }\n\n            event.preventDefault();\n          }\n          event.stopPropagation();\n        },\n      };\n    };\n\n  return (\n    <div\n      className={[\n        fieldBaseClass,\n        \"text\",\n        className,\n        showError && \"error\",\n        readOnly && \"read-only\",\n        hasMany && \"has-many\",\n      ]\n        .filter(Boolean)\n        .join(\" \")}\n      style={style}\n    >\n      <RenderCustomComponent\n        CustomComponent={Label}\n        Fallback={\n          <FieldLabel\n            label={label}\n            localized={localized}\n            path={path}\n            required={required}\n          />\n        }\n      />\n      <div className={`${fieldBaseClass}__wrap`}>\n        <RenderCustomComponent\n          CustomComponent={Error}\n          Fallback={<FieldError path={path} showError={showError} />}\n        />\n        {BeforeInput}\n        {hasMany ? (\n          <ReactSelect\n            className={`field-${path.replace(/\\./g, \"__\")}`}\n            components={{ DropdownIndicator: null }}\n            customProps={{\n              editableProps,\n            }}\n            disabled={readOnly}\n            // prevent adding additional options if maxRows is reached\n            filterOption={() =>\n              !maxRows\n                ? true\n                : !(Array.isArray(value) && maxRows && value.length >= maxRows)\n            }\n            isClearable={false}\n            isCreatable\n            isMulti\n            isSortable\n            menuIsOpen={false}\n            noOptionsMessage={() => {\n              const isOverHasMany =\n                Array.isArray(value) && value.length >= maxRows;\n              if (isOverHasMany) {\n                return t(\"validation:limitReached\", {\n                  max: maxRows,\n                  value: value.length + 1,\n                });\n              }\n              return null;\n            }}\n            onChange={onChange}\n            options={[]}\n            placeholder={t(\"general:enterAValue\")}\n            showError={showError}\n            value={valueToRender}\n          />\n        ) : (\n          <input\n            data-rtl={rtl}\n            disabled={readOnly}\n            id={`field-${path?.replace(/\\./g, \"__\")}`}\n            name={path}\n            onChange={onChange as (e: ChangeEvent<HTMLInputElement>) => void}\n            onKeyDown={onKeyDown}\n            placeholder={getTranslation(placeholder, i18n)}\n            ref={inputRef}\n            type=\"text\"\n            value={value || \"\"}\n          />\n        )}\n        {AfterInput}\n        <RenderCustomComponent\n          CustomComponent={Description}\n          Fallback={<FieldDescription description={description} path={path} />}\n        />\n      </div>\n    </div>\n  );\n};\n"],"mappings":"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","ignoreList":[]}